<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Securing Exchange 2010 with Forefront Threat Management Gateway (TMG) 2010, Part 6 - Publishing Outlook Web App | Chris&#39;s Blog &mdash; It&#39;s called thinking...  go with it! </title>
    <meta property="og:title" content="Securing Exchange 2010 with Forefront Threat Management Gateway (TMG) 2010, Part 6 - Publishing Outlook Web App | Chris&#39;s Blog &mdash; It&#39;s called thinking...  go with it! " />
    <meta name="twitter:title" content="Securing Exchange 2010 with Forefront Threat Management Gateway (TMG) 2010, Part 6 - Publishing Outlook Web App | Chris&#39;s Blog &mdash; It&#39;s called thinking...  go with it! " />

    <meta name="description" content="">
    <meta name="description" property="og:description" content="" />
    <meta name="twitter:description" content="" />

    <meta name="twitter:card" content="summary_large_image" />
    
    <meta name="twitter:site" content="@chrisgoosen" />
    
    <meta property="og:url" content="http://172.16.7.177:4000/2010/06/securing-exchange-2010-with-forefront-threat-management-gateway-tmg-2010-part-6-publishing-outlook-web-app" />

    <meta property="og:image" content="" />
    <meta name="twitter:image" content="" />

    <meta name="author" content="Chris's Blog" />

    <meta name="copyright" content="Copyright by Chris's Blog. All Rights Reserved." />

    <style>
        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 300;
            src: local('Roboto Light'), local('Roboto-Light'), url(https://fonts.gstatic.com/s/roboto/v15/Hgo13k-tfSpn0qi1SFdUfVtXRa8TVwTICgirnJhmVJw.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 400;
            src: local('Roboto'), local('Roboto-Regular'), url(https://fonts.gstatic.com/s/roboto/v15/CWB0XYA8bzo0kSThX0UTuA.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 700;
            src: local('Roboto Bold'), local('Roboto-Bold'), url(https://fonts.gstatic.com/s/roboto/v15/d-6IYplOFocCacKzxwXSOFtXRa8TVwTICgirnJhmVJw.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 900;
            src: local('Roboto Black'), local('Roboto-Black'), url(https://fonts.gstatic.com/s/roboto/v15/mnpfi9pxYH-Go5UiibESIltXRa8TVwTICgirnJhmVJw.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 300;
            src: local('Roboto Light Italic'), local('Roboto-LightItalic'), url(https://fonts.gstatic.com/s/roboto/v15/7m8l7TlFO-S3VkhHuR0at44P5ICox8Kq3LLUNMylGO4.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 400;
            src: local('Roboto Italic'), local('Roboto-Italic'), url(https://fonts.gstatic.com/s/roboto/v15/vPcynSL0qHq_6dX7lKVByfesZW2xOQ-xsNqO47m55DA.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 700;
            src: local('Roboto Bold Italic'), local('Roboto-BoldItalic'), url(https://fonts.gstatic.com/s/roboto/v15/t6Nd4cfPRhZP44Q5QAjcC44P5ICox8Kq3LLUNMylGO4.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 900;
            src: local('Roboto Black Italic'), local('Roboto-BlackItalic'), url(https://fonts.gstatic.com/s/roboto/v15/bmC0pGMXrhphrZJmniIZpY4P5ICox8Kq3LLUNMylGO4.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }
    </style>
    
    <link href="/favicon.ico" rel="shortcut icon" type="image/x-icon" />
    
    <link rel="stylesheet" href="http://172.16.7.177:4000/assets/css/main.css">

    <link rel="canonical" href="http://172.16.7.177:4000/2010/06/securing-exchange-2010-with-forefront-threat-management-gateway-tmg-2010-part-6-publishing-outlook-web-app">

    <link rel="alternate" type="application/rss+xml" title="" href="http://172.16.7.177:4000/feed.xml">
</head>

    <body>
        <div class="wrapper">
            <aside class="user-profile fixed" role="complementary">
    <div class="burger">
        <input class="trigger hidden" id="toggleBurger" type="checkbox" />
        <label for="toggleBurger">
            <span>Navigation</span>
        </label>
    </div>

    <div class="compact-header">
        <a class="avatar" href="http://172.16.7.177:4000"><img alt="Avatar" src="/assets/img/headshot.jpg" /></a>
        <div class="my-info">
            <strong class="my-name">Chris's Blog</strong>
            <span class="my-job-title">It's called thinking...  go with it!</span>
        </div>
    </div>

    
        
        <div class="mainmenu">
            <a href="http://172.16.7.177:4000" >Home</a>
            
                
            
                
            
                
                    <a href="http://172.16.7.177:4000/contact/" >Contact</a>
                
            
                
                    <a href="http://172.16.7.177:4000/about/" >About</a>
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
        </div>
        
    
    
    <div>
    	<img src="/assets/img/mvp.png" style="width:181px;height:74px;">
    </div>

    <p class="about-me"> </p>
    
    <ul class="socials">
        <li><a href="https://twitter.com/chrisgoosen" target="_blank"><svg title="twitter" width="16" height="16" ><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li><li><a href="https://www.linkedin.com/in/ctgoosen/" target="_blank"><svg title="linkedin" width="16" height="16" ><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#linkedin-icon"></use></svg></a></li><li><a href="https://github.com/cgoosen" target="_blank"><svg title="github" width="16" height="16" ><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#github-icon"></use></svg></a></li>

        
            <li><a href="/contact" target="_blank"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#email-icon"></use></svg></a></li>
        

        
         <li><a href="http://feeds.cgoosen.com/cgoosen"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#rss-icon"></use></svg></a></li>
        
    </ul>
</aside>


            <main class="the-content" role="main">
                <div class="search" role="search">
    <div>
        <div class="show-results-count">0 Results</div>
        <div class="search-holder">
            <input type="text" id="search-input" placeholder="search for..." />
        </div>
    </div>
    <ul id="results-container" class="results-container"></ul>
</div>


                <article class="post single" role="article" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="post-header">
        <ul>
            <li><time datetime="2010-06-02T08:00:00-05:00" itemprop="datePublished">2 Jun, 2010</time></li>
            
        </ul>
        <h2 itemprop="name headline">Securing Exchange 2010 with Forefront Threat Management Gateway (TMG) 2010, Part 6 - Publishing Outlook Web App</h2>
    </header>

    <div class="post-content">
        <p>In the first 5 parts of this series, I went through all the steps required to successfully install Forefront Protection 2010 for Exchange Server and Forefront Threat Management Gateway (TMG) 2010 on the same server as your Exchange Server Edge Transport role. I also looked at some basic configuration so we should now be able to send and receive email.</p>
<p>What about external access? TMG 2010 can also securely publish all your Exchange Server related services such as Outlook Web App (OWA), Outlook Anywhere and ActiveSync (EAS).</p>
<p>In this final part of the series I&rsquo;ll look at publishing OWA to the internet. While my focus is mainly on OWA, Outlook Anywhere and EAS should also work after very little or no additional configuration. I&rsquo;ll start by creating a new certificate request and then submitting it to certificate authority and then install the issued certificate. I&rsquo;ll then go over how to correctly export the issued certificate and import it on the TMG server. I&rsquo;ll then conclude the series by creating a new &ldquo;Exchange Web Client Access Publishing Rule&rdquo;.</p>
<p>A few notes before I begin.. When working with certificates, there are two options, I have opted to use my own Enterprise Root CA which has been installed on my domain controller. You are of course welcome to purchase a certificate from a third-party CA, if you decide that this is a better option for you, the basic configuration steps below will not differ all that much, the only difference will be in how you submit the request to the CA. I highly recommend purchasing a UC Certificate for this, please see the following <a href="http://support.microsoft.com/kb/929395" target="_blank">Microsoft TechNet</a> article for more information.</p>
<p>This post also assumes that your domain controllers already accept LDAP connections over SSL. To enable this, you need to install a server certificate on each of your domain controllers. The following <a href="http://support.microsoft.com/kb/321051" target="_blank">Microsoft TechNet</a> article may provide some guidance if you need further assistance with this.</p>
<p>The first step is to confirm out OWA configuration, this is done by opening the Exchange Management Console, expand &ldquo;Server Configuration&rdquo;, click &ldquo;Client Access&rdquo; and then right-click &ldquo;owa (Default Web Site)&rdquo; and select &ldquo;Properties&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image37.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image3_thumb.png" border="0" alt="image" width="504" height="584" /></a></p>
<p>It is also important to change the authentication settings by clicking on the &ldquo;Authentication&rdquo; tab. We need to disable forms based authentication as TMG will be providing this feature. If you keep Exchange forms based authentication enabled your users will be prompted to log into OWA twice.</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image61.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image6_thumb1.png" border="0" alt="image" width="504" height="581" /></a></p>
<p>We now need to create a certificate request for the certificate that will be used to OWA. This can of course be done from the Exchange Management Shell by making use of the <em>New-ExchangeCertifate </em>cmdlet or by making use of the new wizard included in the Exchange Management Console. To access the wizard, click &ldquo;Server Configuration&rdquo;, select your CAS server and click &ldquo;New Exchange Certificate&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image91.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image9_thumb.png" border="0" alt="image" width="204" height="215" /></a></p>
<p>&ldquo;Enter a friendly name for the certificate&rdquo;, I usually use the external FQDN here. Click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image121.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image12_thumb1.png" border="0" alt="image" width="504" height="442" /></a></p>
<p>If you are using a wildcard certificate, you can enter the root domain name here, I have elected not to use a wildcard certificate. Click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image151.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image15_thumb1.png" border="0" alt="image" width="504" height="437" /></a></p>
<p>Next, select your required configuration. Enter your configuration and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image181.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image18_thumb1.png" border="0" alt="image" width="504" height="442" /></a></p>
<p>Review your certificate domains, I usually enter the server name without a suffix as well, but this is not necessarily required. Ensure that you have your internal, external and both autodiscover names listed and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image211.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image21_thumb.png" border="0" alt="image" width="504" height="442" /></a></p>
<p>Enter your organization and location details and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image241.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image24_thumb1.png" border="0" alt="image" width="504" height="439" /></a></p>
<p>Review your certificate configuration summary and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image272.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image27_thumb2.png" border="0" alt="image" width="504" height="439" /></a></p>
<p>Once complete, click &ldquo;Finish&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image301.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image30_thumb1.png" border="0" alt="image" width="504" height="439" /></a></p>
<p>For those looking to use the Exchange Management Shell to complete this request, the command would look something like this:</p>
<p><em>New-ExchangeCertificate -FriendlyName 'dogfood.cgoosen.com' &ndash;GenerateRequest -PrivateKeyExportable $true -KeySize '2048' -SubjectName 'C=AU,S="NSW",L="Sydney",O="cgoosen.com",OU="test lab",CN=dogfood.cgoosen.com' &ndash;DomainName 'tlex01.testlab.local','dogfood.cgoosen.com','autodiscover.testlab.local','autodiscover.dogfood.cgoosen.com','tlex01' -Server 'TLEX01'</em></p>
<p>Now that we have completed out certificate request, it is time to submit this request to a CA. I&rsquo;ll be using my Enterprise Root CA which is installed on my domain controller, so I&rsquo;ll just submit the request opening <a href="https://tldc01.testlab.local/CertSrv">https://tldc01.testlab.local/CertSrv</a> Click &ldquo;Request a certificate&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image40.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image_thumb15.png" border="0" alt="image" width="504" height="237" /></a></p>
<p>Then click on &ldquo;advanced certificate request&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image333.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image33_thumb3.png" border="0" alt="image" width="504" height="229" /></a></p>
<p>Since we have already created the certificate request, select &ldquo;Submit a certificate request by using a base-64-encoded CMC or PKCS#10 file, or submit a renewal request by using a base-64-encoded PKCS#7 file&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image362.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image36_thumb2.png" border="0" alt="image" width="504" height="112" /></a></p>
<p>Paste the certificate request in the box provided, select the &ldquo;Web Server&rdquo; template and click &ldquo;Submit&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image391.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image39_thumb1.png" border="0" alt="image" width="504" height="279" /></a></p>
<p>Click &ldquo;Yes&rdquo; to acknowledge the &ldquo;Web Access Confirmation&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image42.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image42_thumb.png" border="0" alt="image" width="354" height="205" /></a></p>
<p>Next download only the &ldquo;DER encoded&rdquo; certificate.</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image451.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image45_thumb1.png" border="0" alt="image" width="354" height="172" /></a></p>
<p>Now that we have our new certificate, it&rsquo;s time to install it. Once again, click &ldquo;Server Configuration&rdquo; and select your new certificate. Click &ldquo;Complete Pending Request&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image511.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image51_thumb1.png" border="0" alt="image" width="504" height="96" /></a></p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image481.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image48_thumb1.png" border="0" alt="image" width="204" height="109" /></a></p>
<p>Select your new certificate and click &ldquo;Complete&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image541.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image54_thumb1.png" border="0" alt="image" width="504" height="444" /></a></p>
<p>Once completed, click &ldquo;Finish&rdquo;. You have now installed your new certificate.</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image571.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image57_thumb1.png" border="0" alt="image" width="504" height="439" /></a></p>
<p>We now need to assign services to the certificate, click &ldquo;Server Configuration&rdquo; and select your new certificate. Click &ldquo;Assign Services to Certificate&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image60.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image60_thumb.png" border="0" alt="image" width="204" height="164" /></a></p>
<p>Select your CAS server and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image631.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image63_thumb1.png" border="0" alt="image" width="504" height="439" /></a></p>
<p>Ensure that you have selected &ldquo;Internet Information Services&rdquo; and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image661.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image66_thumb1.png" border="0" alt="image" width="504" height="442" /></a></p>
<p>Review the configuration summary and click &ldquo;Assign&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image691.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image69_thumb1.png" border="0" alt="image" width="504" height="442" /></a></p>
<p>Once completed, click &ldquo;Finish&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image72.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image72_thumb.png" border="0" alt="image" width="504" height="442" /></a></p>
<p>Now that we&rsquo;ve installed the new certificate and assigned services to it, lets give it a quick test internally. My internal URL is <a href="https://tlex01.testlab.local/owa">https://tlex01.testlab.local/owa</a></p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image751.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image75_thumb1.png" border="0" alt="image" width="504" height="206" /></a></p>
<p>Before we can import the certificate on the TMG server, you need to export the certificate along with its private key from the CAS server. Open the &ldquo;Certificates&rdquo; MMC and make sure you are viewing the &ldquo;Local Computer&rdquo;. We need to export 2 certificates. The first is the Enterprise Root CA certificate located in the &ldquo;Trusted Root Certificate Authorities&rdquo; store.</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image781.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image78_thumb1.png" border="0" alt="image" width="504" height="152" /></a></p>
<p>The second certificate is the new exchange certificate we just installed, it should be located in the &ldquo;Personal&rdquo; store.</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image811.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image81_thumb1.png" border="0" alt="image" width="504" height="146" /></a></p>
<p>Lets start with the Enterprise Root CA certificate, right-click the certificate and click &ldquo;Export&rdquo;. Click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image84.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image84_thumb.png" border="0" alt="image" width="504" height="454" /></a></p>
<p>Select &ldquo;DER encoded binary X.509 (.CER)&rdquo; and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image87.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image87_thumb.png" border="0" alt="image" width="504" height="456" /></a></p>
<p>Give it a meaningful and name be sure to note down the location and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image901.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image90_thumb1.png" border="0" alt="image" width="504" height="454" /></a></p>
<p>Review the settings and click &ldquo;Finish&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image931.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image93_thumb1.png" border="0" alt="image" width="504" height="454" /></a></p>
<p>Once completed successfully, click &ldquo;Ok&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image96.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image96_thumb.png" border="0" alt="image" width="204" height="141" /></a></p>
<p>Next we export the exchange certificate along with its private key. right-click the certificate and click &ldquo;Export&rdquo;. Click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image841.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image84_thumb1.png" border="0" alt="image" width="504" height="454" /></a></p>
<p>Ensure that you have selected &ldquo;Yes, export the private key&rdquo; and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image99.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image99_thumb.png" border="0" alt="image" width="504" height="454" /></a></p>
<p>Ensure that you have selected &ldquo;Export all extended properties&rdquo; and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image105.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image105_thumb.png" border="0" alt="image" width="504" height="456" /></a></p>
<p>You need to protect the private key by using a password, be sure to remember what password you enter here and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image108.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image108_thumb.png" border="0" alt="image" width="504" height="454" /></a></p>
<p>Give it a meaningful and name be sure to note down the location and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image111.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image111_thumb.png" border="0" alt="image" width="504" height="458" /></a></p>
<p>Review the settings and click &ldquo;Finish&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image114.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image114_thumb.png" border="0" alt="image" width="504" height="454" /></a></p>
<p>Once completed successfully, click &ldquo;Ok&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image961.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image96_thumb1.png" border="0" alt="image" width="204" height="141" /></a></p>
<p>Once you have those 2 certificates, (ca_cert.cer and cas_cert.pfx if you followed my naming convention) copy them to your TMG server. The log onto the TMG server and open the &ldquo;Certificates&rdquo; MMC and make sure you are viewing the &ldquo;Local Computer&rdquo;. We now repeat the previous process in reverse.</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image117.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image117_thumb.png" border="0" alt="image" width="504" height="135" /></a></p>
<p>First we import the Enterprise Root CA certificate, expand the &ldquo;Trusted Root Certificate Authorities&rdquo; store, right-click &ldquo;Certificates&rdquo; and select &ldquo;Import&rdquo;. Click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image120.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image120_thumb.png" border="0" alt="image" width="504" height="454" /></a></p>
<p>Locate the certificate and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image123.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image123_thumb.png" border="0" alt="image" width="504" height="454" /></a></p>
<p>You will notice that it will already have the correct location specified, do not change this, just click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image126.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image126_thumb.png" border="0" alt="image" width="504" height="456" /></a></p>
<p>Review the settings and click &ldquo;Finish&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image129.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image129_thumb.png" border="0" alt="image" width="504" height="456" /></a></p>
<p>Once completed successfully, click &ldquo;Ok&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image132.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image132_thumb.png" border="0" alt="image" width="204" height="133" /></a></p>
<p>We then import the exchange certificate. Expand the &ldquo;Personal&rdquo; store right-click &ldquo;Certificates&rdquo; and select &ldquo;Import&rdquo;. Click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image1201.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image120_thumb1.png" border="0" alt="image" width="504" height="454" /></a></p>
<p>Locate the certificate and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image135.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image135_thumb.png" border="0" alt="image" width="504" height="456" /></a></p>
<p>Enter the private key password (you do remember it, right?) Ensure that you have selected &ldquo;Include all extended properties&rdquo; and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image138.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image138_thumb.png" border="0" alt="image" width="504" height="454" /></a></p>
<p>The correct location should already be specified, do not change this, just click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image141.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image141_thumb.png" border="0" alt="image" width="504" height="454" /></a></p>
<p>Review the settings and click &ldquo;Finish&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image144.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image144_thumb.png" border="0" alt="image" width="504" height="454" /></a></p>
<p>Once completed successfully, click &ldquo;Ok&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image1321.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image132_thumb1.png" border="0" alt="image" width="204" height="133" /></a></p>
<p>Once this is done, should should be able to double-click the exchange certificate and check the status. Both certificates should be &ldquo;Ok&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image147.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image147_thumb.png" border="0" alt="image" width="354" height="435" /></a></p>
<p>The final step in the process is to create a &ldquo;Exchange Web Client Access Publishing Rule&rdquo;. Open the TMG Management Console, right-click &ldquo;Firewall Policy&rdquo;, select &ldquo;New&rdquo; and then select &ldquo;Exchange Web Client Access Publishing Rule&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image150.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image150_thumb.png" border="0" alt="image" width="504" height="256" /></a></p>
<p>Give your rule a meaningful name and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image153.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image153_thumb.png" border="0" alt="image" width="504" height="475" /></a></p>
<p>Select your Exchange version and select &ldquo;Outlook Web Access&rdquo;, then click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image156.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image156_thumb.png" border="0" alt="image" width="504" height="475" /></a></p>
<p>Select your publishing type and then click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image159.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image159_thumb.png" border="0" alt="image" width="504" height="475" /></a></p>
<p>Since we will be using SSL, select that option and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image162.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image162_thumb.png" border="0" alt="image" width="504" height="477" /></a></p>
<p>Enter your internal site name, only enter the FQDN, there is no need to add HTTP/S or /OWA. Click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image165.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image165_thumb.png" border="0" alt="image" width="504" height="475" /></a></p>
<p>Enter your public name here, again only the FQDN. Click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image168.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image168_thumb.png" border="0" alt="image" width="504" height="475" /></a></p>
<p>Select your web listener, since I don&rsquo;t already have one, I am going to create a new one by clicking &ldquo;New&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image171.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image171_thumb.png" border="0" alt="image" width="504" height="475" /></a></p>
<p>Enter a meaningful name and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image174.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image174_thumb.png" border="0" alt="image" width="504" height="473" /></a></p>
<p>We will be using SSL and want to require SSL connections from all clients. Click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image177.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image177_thumb.png" border="0" alt="image" width="504" height="475" /></a></p>
<p>Select your listener IP address, this should be your external network address. Click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image180.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image180_thumb.png" border="0" alt="image" width="504" height="475" /></a></p>
<p>Click &ldquo;Select Certificate&rdquo; and then select the exchange certificate we installed in the previously. Click &ldquo;Select&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image183.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image183_thumb.png" border="0" alt="image" width="504" height="429" /></a></p>
<p>Click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image186.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image186_thumb.png" border="0" alt="image" width="504" height="474" /></a></p>
<p>Next we look at authentication settings, since our server is not a part of the domain, we are unable to use &ldquo;Windows&rdquo; authentication. Make sure &ldquo;HTML Form Authentication&rdquo; is selected, select &ldquo;LDAP (Active Directory)&rdquo; and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image189.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image189_thumb.png" border="0" alt="image" width="504" height="475" /></a></p>
<p>I won&rsquo;t be making use of SSO, make your selection and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image192.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image192_thumb.png" border="0" alt="image" width="504" height="473" /></a></p>
<p>We need to add at least one LDAP server for user authentication, add your domain controllers here, type your domain name and I highly recommend that you make use of LDAP over SSL. Click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image198.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image198_thumb.png" border="0" alt="image" width="504" height="473" /></a></p>
<p>Review your web listener configuration and click &ldquo;Finish&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image195.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image195_thumb.png" border="0" alt="image" width="504" height="477" /></a></p>
<p>Select the web listener you just created and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image201.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image201_thumb.png" border="0" alt="image" width="504" height="473" /></a></p>
<p>Select &ldquo;Basic Authentication&rdquo; and then click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image204.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image204_thumb.png" border="0" alt="image" width="504" height="474" /></a></p>
<p>This rule will apply to &ldquo;All Authenticated Users&rdquo;, click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image207.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image207_thumb.png" border="0" alt="image" width="504" height="475" /></a></p>
<p>Review your configuration and then click &ldquo;Finish&rdquo; to create the rule.</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image210.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image210_thumb.png" border="0" alt="image" width="504" height="475" /></a></p>
<p>Once the rule has been created, we need to apply it to TMG, click &ldquo;Apply&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image213.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image213_thumb.png" border="0" alt="image" width="504" height="123" /></a></p>
<p>You should now see your rule listed..</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image216.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image216_thumb.png" border="0" alt="image" width="504" height="108" /></a></p>
<p>Now for the fun part, lets test our configuration. If you visit your external URL, mine is <a href="https://dogfood.cgoosen.com/owa">https://dogfood.cgoosen.com/owa</a> you should be presented with a OWA login form. Notice the &ldquo;Secured by Microsoft Forefront Threat Management Gateway&rdquo; banner at the bottom.</p>
<p>Enter your user name in the format &ldquo;Domain\user name&rdquo; and your password and click &ldquo;Log On&rdquo; If you have any certificate alerts, you may need to install your Root CA certificate to the &ldquo;Trusted Root Certification Authorities&rdquo; store on your workstation. If you are using an Enterprise Root CA, it uses Group Policy to propagate its certificate to the &ldquo;Trusted Root Certification Authorities&rdquo; store for all users and computers in the domain.</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image219.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image219_thumb.png" border="0" alt="image" width="504" height="466" /></a></p>
<p>If everything has been correctly configured, you should be presented with your inbox.</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image2221.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image222_thumb.png" border="0" alt="image" width="504" height="145" /></a></p>
<p>To summarise, in this final part of the series I created a new certificate request and then submitted it to certificate authority. Once I had downloaded the issued certificate, I installed it on my exchange CAS server and assigned services to it. I then exported the issued certificate and imported it on the TMG server. To complete the process, I created a new &ldquo;Exchange Web Client Access Publishing Rule&rdquo;.</p>
<p>In this 6 part series, I went through the process of installing Exchange Server Edge, Forefront Protection 2010 for Exchange Server and TMG 2010 on the same server. Consolidating these services greatly reduces management complexity and overhead.</p>

    </div>

    <footer class="post-footer">
        <div class="share">Share
            <ul class="social-networks">
                <li class="share-facebook"><a href="https://www.facebook.com/sharer.php?s=100&p[title]=Securing Exchange 2010 with Forefront Threat Management Gateway (TMG) 2010, Part 6 - Publishing Outlook Web App&p[summary]=In the first 5 parts of this series, I went through all the steps required to successfully install Forefront Protection 2010 for Exchange...&p[url]=http://172.16.7.177:4000/2010/06/securing-exchange-2010-with-forefront-threat-management-gateway-tmg-2010-part-6-publishing-outlook-web-app" class="s_facebook" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#facebook-icon"></use></svg></a></li>
                <li class="share-twitter"><a href="http://twitter.com/share?url=http://172.16.7.177:4000/2010/06/securing-exchange-2010-with-forefront-threat-management-gateway-tmg-2010-part-6-publishing-outlook-web-app&text=In the first 5 parts of this series, I went through all the steps required to successfully install Forefront Protection 2010 for Exchange...&hashtags=" rel="noreferrer" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li>
            </ul>
        </div>
        
        <div class="tags">
            <ul>
                
            </ul>
        </div>
        
    </footer>
</article>


<aside class="comments" role="complementary">
    <div id="disqus_thread"></div>
    <script>
        var disqus_config = function () {
            this.page.url = 'http://172.16.7.177:4000/2010/06/securing-exchange-2010-with-forefront-threat-management-gateway-tmg-2010-part-6-publishing-outlook-web-app';
            this.page.identifier = '6/2/2010';
        };
        (function() {
            var d = document, s = d.createElement('script');

            s.src = '//cgoosen.disqus.com/embed.js';

            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();
    </script>
</aside>

            </main>
        </div>

        <script src="http://172.16.7.177:4000/assets/js/jquery-1.12.2.min.js"></script>
<script src="http://172.16.7.177:4000/assets/js/backtotop.js"></script>
<script src="http://172.16.7.177:4000/assets/js/lunr.min.js"></script>
<script src="http://172.16.7.177:4000/assets/js/lunr-feed.js"></script>
<script src="http://172.16.7.177:4000/assets/js/jquery.fitvids.js"></script>
<script src="http://172.16.7.177:4000/assets/js/svg4everybody.min.js"></script>
<script src="http://172.16.7.177:4000/assets/js/scripts.js"></script>


    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-XXXXXXX-2', 'auto');
        ga('send', 'pageview');
    </script>

        <style>
.lightbox {width: 100%; height: 100%; position: fixed; top: 0; left: 0; background: rgba(0,0,0,0.85); z-index: 9999999; line-height: 0; cursor: pointer;}
.lightbox .img {
	position: relative; 
	top: 50%;
	left: 50%;
	-ms-transform: translateX(-50%) translateY(-50%);
	-webkit-transform: translate(-50%,-50%);
	transform: translate(-50%,-50%);
	max-width: 100%;
	max-height: 100%;
}
.lightbox .img img {opacity: 0; pointer-events: none; width: auto;}
@media screen and (min-width: 1200px) {
    .lightbox .img {
		max-width: 1200px;
    }
}
@media screen and (min-height: 1200px) {
    .lightbox img {
		max-height: 1200px;
	}
}
.lightbox span {display: block; position: fixed; bottom: 13px; height: 1.5em; line-height: 1.4em; width: 100%; text-align: center; color: white; text-shadow:
    -1px -1px 0 #000,
    1px -1px 0 #000,
    -1px 1px 0 #000,
    1px 1px 0 #000;  
}






.lightbox .videoWrapperContainer {
	position: relative; 
	top: 50%;
	left: 50%;
	-ms-transform: translateX(-50%) translateY(-50%);
	-webkit-transform: translate(-50%,-50%);
	transform: translate(-50%,-50%);
	max-width: 900px;
	max-height: 100%;
}
.lightbox .videoWrapperContainer .videoWrapper {
	height: 0;
	line-height: 0;
	margin: 0;
	padding: 0;
	position: relative;
	padding-bottom: 56.333%; /* custom */
	background: black;
} 
.lightbox .videoWrapper iframe {
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	border: 0;
	display: block;
}   
.lightbox #prev, .lightbox #next {height: 50px; line-height: 36px; display: none; margin-top: -25px; position: fixed; top: 50%; padding: 0 15px; cursor: pointer; text-decoration: none; z-index: 99; color: white; font-size: 60px;}
.lightbox.gallery #prev, .lightbox.gallery #next {display: block;}
.lightbox #prev {left: 0;}
.lightbox #next {right: 0;}
.lightbox #close {height: 50px; width: 50px; position: fixed; cursor: pointer; text-decoration: none; z-index: 99; right: 0; top: 0;}
.lightbox #close:after, .lightbox #close:before {position: absolute; margin-top: 22px; margin-left: 14px; content: ""; height: 3px; background: white; width: 23px;
-webkit-transform-origin: 50% 50%;
-moz-transform-origin: 50% 50%;
-o-transform-origin: 50% 50%;
transform-origin: 50% 50%;
/* Safari */
-webkit-transform: rotate(-45deg);
/* Firefox */
-moz-transform: rotate(-45deg);
/* IE */
-ms-transform: rotate(-45deg);
/* Opera */
-o-transform: rotate(-45deg);
}
.lightbox #close:after {
/* Safari */
-webkit-transform: rotate(45deg);
/* Firefox */
-moz-transform: rotate(45deg);
/* IE */
-ms-transform: rotate(45deg);
/* Opera */
-o-transform: rotate(45deg);
}
.lightbox, .lightbox * {
    -webkit-user-select: none;  
    -moz-user-select: none;    
    -ms-user-select: none;      
    user-select: none;
}
</style>
		
<script>
function is_youtubelink(url) {
  var p = /^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/;
  return (url.match(p)) ? RegExp.$1 : false;
}
function is_imagelink(url) {
	var p = /([a-z\-_0-9\/\:\.]*\.(jpg|jpeg|png|gif))/i;
	return (url.match(p)) ? true : false;
}
function is_vimeolink(url,el) {
	var id = false;
	$.ajax({
	  url: 'https://vimeo.com/api/oembed.json?url='+url,
	  async: true,
	  success: function(response) {
		if(response.video_id) {
		  id = response.video_id;
		  $(el).addClass('lightbox-vimeo').attr('data-id',id);
		}
	  }
	});
}

$(document).ready(function() {
	//add classes to links to be able to initiate lightboxes
	$("a").each(function(){
		var url = $(this).attr('href');
		if(url) {
			if(url.indexOf('vimeo') !== -1 && !$(this).hasClass('no-lightbox')) is_vimeolink(url,$(this));
			if(is_youtubelink(url) && !$(this).hasClass('no-lightbox')) $(this).addClass('lightbox-youtube').attr('data-id',is_youtubelink(url));
			if(is_imagelink(url) && !$(this).hasClass('no-lightbox')) {
				$(this).addClass('lightbox-image');
				var href = $(this).attr('href');
				var filename = href.split('/').pop();
				var split = filename.split(".");
				var name = split[0];
				$(this).attr('title',name);
			}
		}
	});
	//remove the clicked lightbox
	$("body").on("click", ".lightbox", function(event){
		if($(this).hasClass('gallery')) {
			$(this).remove();
			if($(event.target).attr('id')=='next') {
				//next item
				if($("a.gallery.current").nextAll("a.gallery:first").length) $("a.gallery.current").nextAll("a.gallery:first").click();
				else $("a.gallery.current").parent().find("a.gallery").first().click();
			}
			else if ($(event.target).attr('id')=='prev') {
				//prev item
				if($("a.gallery.current").prevAll("a.gallery:first").length) $("a.gallery.current").prevAll("a.gallery:first").click();
				else $("a.gallery.current").parent().find("a.gallery").last().click();
			}
			else {
				$("a.gallery").removeClass('gallery');
			}
		}
		else $(this).remove();
	});
	//prevent image from being draggable (for swipe)
	$("body").on('dragstart', ".lightbox img", function(event) { event.preventDefault(); });
	//add the youtube lightbox on click
	$("a.lightbox-youtube").click(function(event){
		event.preventDefault();
		$('<div class="lightbox"><a id="close"></a><a id="next">&rsaquo;</a><a id="prev">&lsaquo;</a><div class="videoWrapperContainer"><div class="videoWrapper"><iframe src="https://www.youtube.com/embed/'+$(this).attr('data-id')+'?autoplay=1&showinfo=0&rel=0"></iframe></div></div></div>').appendTo('body');
	});
	//add the image lightbox on click
	$("a.lightbox-image").click(function(event){
		event.preventDefault();
		$('<div class="lightbox"><a id="close"></a><a id="next">&rsaquo;</a><a id="prev">&lsaquo;</a><div class="img" style="background: url('+$(this).attr('href')+') center center / contain no-repeat;" title="'+$(this).attr('title')+'" ><img src="'+$(this).attr('href')+'" alt="'+$(this).attr('title')+'" /></div><span>'+$(this).attr('title')+'</span></div>').appendTo('body');
	});
	//add the vimeo lightbox on click
	$("body").on("click", "a.lightbox-vimeo", function(event){
		event.preventDefault();
		$('<div class="lightbox"><a id="close"></a><a id="next">&rsaquo;</a><a id="prev">&lsaquo;</a><div class="videoWrapperContainer"><div class="videoWrapper"><iframe src="https://player.vimeo.com/video/'+$(this).attr('data-id')+'/?autoplay=1&byline=0&title=0&portrait=0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div></div></div>').appendTo('body');
	});

	$("body").on("click", "a[class*='lightbox-']", function(){
		var link_elements = $(this).parent().find("a[class*='lightbox-']");
		$(link_elements).removeClass('current');
		for (var i=0; i<link_elements.length; i++) {
			if($(this).attr('href') == $(link_elements[i]).attr('href')) {
				$(link_elements[i]).addClass('current');
			}
		}
		if(link_elements.length>1) {
			$('.lightbox').addClass('gallery');
			$(link_elements).addClass('gallery');
		}
	});

	
});

$(document).keydown(function(e) {
    switch(e.which) {
        case 37: // left
        $("#prev").click();
        break;
        case 39: // right
        $("#next").click();
        break;
	case 27: // esc
        $("#close").click();
        break;
        default: return; // exit this handler for other keys
    }
    e.preventDefault(); // prevent the default action (scroll / move caret)
});

  /*===========================
  Swipe-it v1.4.1
  An event listener for swiping gestures with vanilla js.
  https://github.com/tri613/swipe-it#readme
 
  @Create 2016/09/22
  @Update 2017/08/11
  @Author Trina Lu
  ===========================*/
  "use strict";var _slicedToArray=function(){function n(n,t){var e=[],i=!0,o=!1,r=void 0;try{for(var u,c=n[Symbol.iterator]();!(i=(u=c.next()).done)&&(e.push(u.value),!t||e.length!==t);i=!0);}catch(n){o=!0,r=n}finally{try{!i&&c.return&&c.return()}finally{if(o)throw r}}return e}return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return n(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();!function(n,t,e){function i(n){function e(){o("touchstart",m,w),o("touchmove",d,w),o("touchend",p,w),E.mouseEvent&&o("mousedown",s,w)}function i(){y=!1,D=!1,A=!1,b=!1,a=!1}function s(n){a=this,y=n.clientX,D=n.clientY,o("mousemove",l,v),o("mouseup",h,v)}function l(n){n.preventDefault(),y&&D&&(A=n.clientX,b=n.clientY)}function h(n){r("mousemove",l,v),r("mouseup",h,v),p(n)}function m(n){a=this,y=n.touches[0].clientX,D=n.touches[0].clientY}function d(n){A=n.touches[0].clientX,b=n.touches[0].clientY}function p(n){if(y&&D&&A&&b){var t=y-A,e=D-b,o=[t,e].map(Math.abs),r=_slicedToArray(o,2),c=r[0],s=r[1],v=E.minDistance;if(c>v){var f=y<A?"swipeRight":"swipeLeft";u(f,a,{distance:t,start:y,end:A})}if(s>v){var l=D>b?"swipeUp":"swipeDown";u(l,a,{distance:e,start:D,end:b})}(c>v||s>v)&&u("swipe",a)}i()}var E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},w=c(t.querySelectorAll(n)),y=void 0,D=void 0,A=void 0,b=void 0;E.mouseEvent=void 0===E.mouseEvent?f.mouseEvent:E.mouseEvent,E.minDistance=void 0===E.minDistance?f.minDistance:E.minDistance,i(),e(),this.on=function(n,t){return o(n,t,w),this}}function o(n,t,e){s(e).forEach(function(e){return e.addEventListener(n,t)})}function r(n,t,e){s(e).forEach(function(e){return e.removeEventListener(n,t)})}function u(n,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=t.createEvent("Event");o.initEvent(n,!0,!0),o.swipe=i,s(e).forEach(function(n){return n.dispatchEvent(o)})}function c(n){for(var t=[],e=0;e<n.length;e++)t.push(n[e]);return t}function s(n){return Array.isArray(n)?n:[n]}var a=!1,v=[n],f={mouseEvent:!0,minDistance:30};n[e]=i}(window,document,"SwipeIt");

var mySwipeIt = new SwipeIt('body');
mySwipeIt.on('swipeLeft',function(e){
	//check if lightbox is present
	if($('.lightbox').length >  0 ) {
		$("#next").click();
	}
}).on('swipeRight',function(e){
	//check if lightbox is present
	if($('.lightbox').length >  0 ) {
		$("#prev").click();
	}
});
</script>

    </body>
</html>