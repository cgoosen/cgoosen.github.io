<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Category: Forefront TMG | Chris&#39;s Blog &mdash; It&#39;s called thinking...  go with it! </title>
    <meta property="og:title" content="Category: Forefront TMG | Chris&#39;s Blog &mdash; It&#39;s called thinking...  go with it! " />
    <meta name="twitter:title" content="Category: Forefront TMG | Chris&#39;s Blog &mdash; It&#39;s called thinking...  go with it! " />

    <meta name="description" content="Category: Forefront TMG">
    <meta name="description" property="og:description" content="Category: Forefront TMG" />
    <meta name="twitter:description" content="Category: Forefront TMG" />

    <meta name="twitter:card" content="summary_large_image" />
    
    <meta name="twitter:site" content="@chrisgoosen" />
    
    <meta property="og:url" content="http://172.16.7.177:4000/categories/Forefront%20TMG/" />

    <meta property="og:image" content="" />
    <meta name="twitter:image" content="" />

    <meta name="author" content="Chris's Blog" />

    <meta name="copyright" content="Copyright by Chris's Blog. All Rights Reserved." />

    <style>
        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 300;
            src: local('Roboto Light'), local('Roboto-Light'), url(https://fonts.gstatic.com/s/roboto/v15/Hgo13k-tfSpn0qi1SFdUfVtXRa8TVwTICgirnJhmVJw.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 400;
            src: local('Roboto'), local('Roboto-Regular'), url(https://fonts.gstatic.com/s/roboto/v15/CWB0XYA8bzo0kSThX0UTuA.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 700;
            src: local('Roboto Bold'), local('Roboto-Bold'), url(https://fonts.gstatic.com/s/roboto/v15/d-6IYplOFocCacKzxwXSOFtXRa8TVwTICgirnJhmVJw.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 900;
            src: local('Roboto Black'), local('Roboto-Black'), url(https://fonts.gstatic.com/s/roboto/v15/mnpfi9pxYH-Go5UiibESIltXRa8TVwTICgirnJhmVJw.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 300;
            src: local('Roboto Light Italic'), local('Roboto-LightItalic'), url(https://fonts.gstatic.com/s/roboto/v15/7m8l7TlFO-S3VkhHuR0at44P5ICox8Kq3LLUNMylGO4.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 400;
            src: local('Roboto Italic'), local('Roboto-Italic'), url(https://fonts.gstatic.com/s/roboto/v15/vPcynSL0qHq_6dX7lKVByfesZW2xOQ-xsNqO47m55DA.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 700;
            src: local('Roboto Bold Italic'), local('Roboto-BoldItalic'), url(https://fonts.gstatic.com/s/roboto/v15/t6Nd4cfPRhZP44Q5QAjcC44P5ICox8Kq3LLUNMylGO4.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 900;
            src: local('Roboto Black Italic'), local('Roboto-BlackItalic'), url(https://fonts.gstatic.com/s/roboto/v15/bmC0pGMXrhphrZJmniIZpY4P5ICox8Kq3LLUNMylGO4.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }
    </style>
    
    <link href="/favicon.ico" rel="shortcut icon" type="image/x-icon" />
    
    <link rel="stylesheet" href="http://172.16.7.177:4000/assets/css/main.css">

    <link rel="canonical" href="http://172.16.7.177:4000/categories/Forefront%20TMG/">

    <link rel="alternate" type="application/rss+xml" title="" href="http://172.16.7.177:4000/feed.xml">
</head>

    <body>
        <div class="wrapper">
            <aside class="user-profile fixed" role="complementary">
    <div class="burger">
        <input class="trigger hidden" id="toggleBurger" type="checkbox" />
        <label for="toggleBurger">
            <span>Navigation</span>
        </label>
    </div>

    <div class="compact-header">
        <a class="avatar" href="http://172.16.7.177:4000"><img alt="Avatar" src="/assets/img/headshot.jpg" /></a>
        <div class="my-info">
            <strong class="my-name">Chris's Blog</strong>
            <span class="my-job-title">It's called thinking...  go with it!</span>
        </div>
    </div>

    
        
        <div class="mainmenu">
            <a href="http://172.16.7.177:4000" >Home</a>
            
                
            
                
            
                
                    <a href="http://172.16.7.177:4000/contact/" >Contact</a>
                
            
                
                    <a href="http://172.16.7.177:4000/about/" >About</a>
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
        </div>
        
    
    
    <div>
    	<img src="/assets/img/mvp.png" style="width:181px;height:74px;">
    </div>

    <p class="about-me"> </p>
    
    <ul class="socials">
        <li><a href="https://twitter.com/chrisgoosen" target="_blank"><svg title="twitter" width="16" height="16" ><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li><li><a href="https://www.linkedin.com/in/ctgoosen/" target="_blank"><svg title="linkedin" width="16" height="16" ><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#linkedin-icon"></use></svg></a></li><li><a href="https://github.com/cgoosen" target="_blank"><svg title="github" width="16" height="16" ><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#github-icon"></use></svg></a></li>

        
            <li><a href="/contact" target="_blank"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#email-icon"></use></svg></a></li>
        

        
         <li><a href="http://feeds.cgoosen.com/cgoosen"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#rss-icon"></use></svg></a></li>
        
    </ul>
</aside>


            <main class="the-content" role="main">
                <div class="search" role="search">
    <div>
        <div class="show-results-count">0 Results</div>
        <div class="search-holder">
            <input type="text" id="search-input" placeholder="search for..." />
        </div>
    </div>
    <ul id="results-container" class="results-container"></ul>
</div>


                <h1>Posts From Category: Forefront TMG</h1>


<article class="post" role="article" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="post-header">
        <ul>
            <li><time datetime="2013-07-23T07:41:13-05:00" itemprop="datePublished">23 Jul, 2013</time></li>
            
        </ul>
        <h2 itemprop="name headline"><a href="http://172.16.7.177:4000/2013/07/reverse-proxy-for-exchange-server-2013-using-iis-arr">Reverse Proxy for Exchange Server 2013 using IIS ARR</a></h2>
    </header>

    <div class="post-content">
        <p>Microsoft Application Request Routing (ARR) is a proxy-based routing module for IIS that forwards HTTP requests to content servers based on HTTP headers, server variables, and load balance algorithms. After my recent posts on reverse proxy servers and Exchange Server I received a few emails about using ARR as a reverse proxy for Exchange Server. The Exchange Team recently released some guidance on how to achieve this on their blog for those of you who are interested in this setup, <a href="http://blogs.technet.com/b/exchange/archive/2013/07/19/reverse-proxy-for-exchange-server-2013-using-iis-arr-part-1.aspx" target="_blank">here is a link to the post.</a></p>


        
    </div>

    <footer class="post-footer">
        <div class="share">Share
            <ul class="social-networks">
                <li class="share-facebook"><a href="https://www.facebook.com/sharer.php?s=100&p[title]=Reverse Proxy for Exchange Server 2013 using IIS ARR&p[summary]=Microsoft Application Request Routing (ARR) is a proxy-based routing module for IIS that forwards HTTP requests to content servers based ...&p[url]=http://172.16.7.177:4000/2013/07/reverse-proxy-for-exchange-server-2013-using-iis-arr" class="s_facebook" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#facebook-icon"></use></svg></a></a></li>
                <li class="share-twitter"><a href="http://twitter.com/share?url=http://172.16.7.177:4000/2013/07/reverse-proxy-for-exchange-server-2013-using-iis-arr&text=Microsoft Application Request Routing (ARR) is a proxy-based routing module for IIS that forwards HTTP requests to content servers based ...&hashtags=" rel="noreferrer" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li>
            </ul>
        </div>
        
        <div class="tags">
            <ul>
                
            </ul>
        </div>
        
    </footer>
</article>

<article class="post" role="article" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="post-header">
        <ul>
            <li><time datetime="2013-07-19T07:09:00-05:00" itemprop="datePublished">19 Jul, 2013</time></li>
            
        </ul>
        <h2 itemprop="name headline"><a href="http://172.16.7.177:4000/2013/07/exchange-server-and-the-reverse-proxy-part-2">Exchange Server and the Reverse Proxy - Part 2</a></h2>
    </header>

    <div class="post-content">
        <p>In March this year I wrote a post entitled &ldquo;<a href="http://www.cgoosen.com/2013/03/exchange-server-and-the-reverse-proxy/" target="_blank">Exchange Server and the Reverse Proxy</a>&rdquo;. I had many similar conversations with peers and customers about the topic, and at the time my intention was twofold:</p>
<ol>
<li>Question the &lsquo;old school&rsquo; notion that Exchange services published to the internet are only secure if a reverse proxy is used;
<li>Provide a high-level list of potentially suitable solutions for customers planning new deployments who felt they still needed a reverse proxy.</li>
</ol>
<p>I&rsquo;ve received many comments and emails about that post and have been planning to put together this follow-up for some time now so it was a happy coincidence when the ever entertaining (and deceptively brilliant!) Greg Taylor <a href="http://blogs.technet.com/b/exchange/archive/2013/07/17/life-in-a-post-tmg-world-is-it-as-scary-as-you-think.aspx" target="_blank">recently posted about the same topic on the Exchange Team blog</a>. I&rsquo;m sure he won&rsquo;t mind me &lsquo;borrowing&rsquo; some of this content, it is not my intention to take anything out of context so feel free to read <a href="http://blogs.technet.com/b/exchange/archive/2013/07/17/life-in-a-post-tmg-world-is-it-as-scary-as-you-think.aspx" target="_blank">this entire post here</a>. A couple of things that really stand out in his post are:</p>
<blockquote><p><em>&ldquo;Here are some interesting Exchange-related facts to help further cement the idea I&rsquo;m eventually going to get to.</em></p>
<ol>
<li><em>We do not require traffic to be authenticated prior to hitting services in front of Exchange Online.</em>
<li><em>We do not do any form of pre-authentication of services in front of our corporate, on-premises messaging deployments either.</em>
<li><em>We have spent an awfully large amount of time as a company working on securing our code, writing secure code, testing our code for security, and understanding the threats that exist to our code. This is why we feel confident enough to do #1 and #2.</em>
<li><em>We have come to learn that adding layers of security often adds little additional security, but certainly lots of complexity.</em>
<li><em>We have invested in getting our policies right and monitoring our systems.&rdquo;</em></li>
</ol>
</blockquote>
<blockquote><p><em>&ldquo;Do I think everyone should throw out that TMG box they have today and go firewall commando? No. not at all. I think they should evaluate what it does for them, and, if they need it going forward. If they do that, and decide they still want pre-auth, then find something that can do it, when the time to replace TMG comes. </em>
<p><em>You could consider it a sliding scale, of choice. Something like this perhaps;&rdquo;</em>
<p align="center"><a href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-31-06-metablogapi/2045.TMGScale_5F00_7671E17B.jpg"><img title="TMGScale" border="0" alt="TMGScale" src="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-31-06-metablogapi/8311.TMGScale_5F00_thumb_5F00_464A96B8.jpg" width="811" height="478"></a></p>
</blockquote>
<p>The recent release of <a href="http://www.microsoft.com/en-us/server-cloud/windows-server/windows-server-2012-r2.aspx" target="_blank">Windows Server 2012 R2</a> Preview brings with it the new <a href="http://technet.microsoft.com/en-us/library/dn280944.aspx" target="_blank">Web Application Proxy role.</a> Web Application Proxy is a new Remote Access role service in Windows Server 2012 R2 Preview that provides reverse proxy functionality for web applications inside your corporate network to allow users on any device to access them from outside the corporate network. Web Application Proxy pre-authenticates access to web applications using Active Directory Federation Services (AD FS), and also functions as an AD FS proxy. My esteemed colleague <a href="https://twitter.com/MarcTerblanche" target="_blank">Marc Terblanche</a> has put together a couple of great posts on the Kloud Solutions blog about the Web Application Proxy role, check them out here:</p>
<ul>
<li><a href="http://blog.kloud.com.au/2013/07/03/windows-2012-r2-preview-web-application-proxy-exchange-2013-publishing-tests/" target="_blank">Windows 2012 R2 Preview Web Application Proxy &ndash; Exchange 2013 Publishing Tests</a></li>
<li><a href="http://blog.kloud.com.au/2013/07/15/publish-lync-2013-with-2012-r2-preview-web-application-proxy/" target="_blank">Publish Lync 2013 with 2012 R2 Preview Web Application Proxy</a></li>
</ul>
<p>I also wanted to post an update on the Apache/mod_proxy solution I mentioned in my previous post. Free time (aka lab time) has become somewhat limited lately so I haven&rsquo;t been able iron out all the issues with the solution yet, but I recently came across an open source project that looks very promising. The guys at <a href="http://www.vultureproject.org/" target="_blank">Vulture</a> seem to have created exactly what I was trying to do in a much more elegant way. They&rsquo;ve put together a web application firewall using open source components like Apache and mod_security and have even added a configuration web gui to it. Vulture does pre-authentication using a number of authentication providers and also provides other features like load balancing. I have not tested it myself (yet!) but if this interests you, check it out here: <a href="http://www.vultureproject.org/">http://www.vultureproject.org/</a> &ndash; The documentation is in French but seems to translate reasonably well..</p>


        
    </div>

    <footer class="post-footer">
        <div class="share">Share
            <ul class="social-networks">
                <li class="share-facebook"><a href="https://www.facebook.com/sharer.php?s=100&p[title]=Exchange Server and the Reverse Proxy - Part 2&p[summary]=In March this year I wrote a post entitled &ldquo;Exchange Server and the Reverse Proxy&rdquo;. I had many similar conversations with pee...&p[url]=http://172.16.7.177:4000/2013/07/exchange-server-and-the-reverse-proxy-part-2" class="s_facebook" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#facebook-icon"></use></svg></a></a></li>
                <li class="share-twitter"><a href="http://twitter.com/share?url=http://172.16.7.177:4000/2013/07/exchange-server-and-the-reverse-proxy-part-2&text=In March this year I wrote a post entitled &ldquo;Exchange Server and the Reverse Proxy&rdquo;. I had many similar conversations with pee...&hashtags=" rel="noreferrer" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li>
            </ul>
        </div>
        
        <div class="tags">
            <ul>
                
            </ul>
        </div>
        
    </footer>
</article>

<article class="post" role="article" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="post-header">
        <ul>
            <li><time datetime="2013-03-27T09:52:32-05:00" itemprop="datePublished">27 Mar, 2013</time></li>
            
        </ul>
        <h2 itemprop="name headline"><a href="http://172.16.7.177:4000/2013/03/exchange-server-and-the-reverse-proxy">Exchange Server and the Reverse Proxy</a></h2>
    </header>

    <div class="post-content">
        <p>Ever since <a href="http://blogs.technet.com/b/server-cloud/archive/2012/09/12/important-changes-to-forefront-product-roadmaps.aspx" target="_blank">Microsoft announced</a> that Forefront Threat Management Gateway (TMG) 2010 will be discontinued, I have had many customers ask me &ldquo;What should we use as a reverse proxy for Exchange?&rdquo;. This question has sparked many heated debates among colleagues and customers alike. To be fair, this announcement may have come as a huge shock to many people, but I think deep down many of us expected it to happen sooner or later.. TMG was a great product and really became the de facto standard for reverse proxying Exchange (and Lync, etc) and thinking back to all the Exchange deployments I have been involved with over the years, it is fair to say that most of them made use of ISA/TMG as a reverse proxy in some way. It worked well, but sadly all good things come to an end.</p>
<p>So, lets get back to the question.. &ldquo;What should we use as a reverse proxy for Exchange?&rdquo; I&rsquo;ve been thinking about this for a while and I don&rsquo;t believe there is a magical silver bullet solution that will work for everyone and I urge my customers to think it through and make an informed decision. Do you even need a reverse proxy for Exchange? This is where things get heated.. but hear me out.. there are those who have been talking about the death of the DMZ for some time now. I remember attending a Tech-Ed session back in 2008 where <a href="http://channel9.msdn.com/Events/TechEd/Europe/2008/SEC309" target="_blank">Steve Riley talked about this</a> and Deb Shinder has also <a href="http://www.windowsecurity.com/articles-tutorials/misc_network_security/Has-Day-Death-DMZ-Finally-Arrived.html" target="_blank">blogged about this topic in the past.</a> I&rsquo;m not saying get rid of your firewall, but what I am saying is that perhaps you no longer need to use a reverse proxy to secure connections to your Exchange servers and this is something that should be thought about. My first response to the &ldquo;What should we use as a reverse proxy for Exchange?&rdquo; question is &ldquo;Do you still need a reverse proxy?&rdquo; and 99% of the time the answer I get back is &ldquo;Yes, because it is insecure not to&rdquo;. Perhaps it used to be, but is that statement still true? Every environment is different and every organisation has different needs and requirements. My intention with this post is to help you ask the right questions and make an informed decision.</p>
<p>One of the great things about being a consultant is that I get to work with many different types of customers and see many different types of environments and typically the decision to implement a reverse proxy is driven by one or both of the following factors:</p>
<ol>
<li><strong>Application Hardening</strong> - The concept of application hardening has been around for some time now and there is a lot of information floating around about it. The question we need to ask is: does Exchange (the CAS role in particular) need to be hardened? The reality is that times have changed and both Windows Server and Exchange have matured and are hardened by default. Exchange CAS was designed to be internet facing so there really is no need for a reverse proxy in order to secure it anymore. Sure, using a reverse proxy is useful if you wish to implement third party two factor authentication or have other very specific requirements, but will your Exchange implementation be less secure without one? probably not.
<li><strong>Security Policy - </strong>Security policy is much more complex and as you would expect, these policies come in many flavours! One thing most of them have in common is that they restrict traffic from passing through an entire zone or prevent services on the internal network from being accessed directly from the internet, i.e traffic cannot pass directly through the DMZ to the internal network, and must first terminate in the DMZ. In the past, the solution was to implement ISA/TMG as a reverse proxy in the DMZ. We already know that Exchange does not need any further hardening, so technically there is no need for this, but while technology matures relatively quickly security policies rarely keep up so it is fairly common to have this type of out-dated policy that dictates the use of a reverse proxy. Sometimes the remnants of this type of security policy are still visible long after the policy has evolved &ndash; I did some work with a customer recently who had a policy like this in the past and over time as their network grew they made decisions based on this policy that have resulted in a few technical constraints that are now causing some headaches. Typically, these security policies are similar to the diagram below:</li>
</ol>
<p align="center"><a href="http://www.cgoosen.com/wp-content/uploads/2013/03/Blog-Diagrams.png"><img title="Blog Diagrams" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="Blog Diagrams" src="http://www.cgoosen.com/wp-content/uploads/2013/03/Blog-Diagrams_thumb.png" width="742" height="346"></a></p>
<p>There is something else to consider and that is performance. Often due to the mission critical nature of DMZ infrastructure and its various dependencies, this infrastructure is not upgraded or refreshed as regularly as other infrastructure so you end up building on infrastructure that was never intended to deal with the load that is now being placed on it. A classic example of this is an environment I saw a while back &ndash; this particular organisation was in the process of refreshing their messaging platform and had just made a significant investment in a highly available Exchange environment only to go and use the ageing 32-bit only ISA 2006 infrastructure in their DMZ as a reverse proxy because connections to Exchange needed to be &ldquo;secured&rdquo;.</p>
<p>So what&rsquo;s answer then? Well.. I think it is important to first understand what your requirements are. Are you currently using TMG? why change? Mainstream support for TMG will <a href="http://support.microsoft.com/lifecycle/search/default.aspx?sort=PN&amp;alpha=Forefront+Threat+Management+Gateway+2010&amp;Filter=FilterNO" target="_blank">continue into 2015 with extended support through 2020</a>. Are you looking to implement a reverse proxy because you think it will make Exchange more secure? If so, perhaps you need to rethink your approach. Are you looking for a TMG replacement because your security policy dictates the use of a proxy server and you really have no choice in the matter? Here are three options:</p>
<ol>
<li><strong>F5 BIG-IP Access Policy Manager (APM)</strong>&nbsp; - Many organisations have already invested in BIG-IP LTM devices to load balance Exchange. It makes sense to leverage this infrastructure, you&rsquo;ll have the added benefit of infrastructure consolidation if you move the reverse proxy functionality to your BIG-IP devices. <a href="http://www.f5.com/products/big-ip/big-ip-access-policy-manager/overview/" target="_blank">More info here</a>
<li><strong>KEMP LoadMaster Edge Security Pack (ESP) - </strong>I have always been a big fan of the KEMP LoadMaster devices and KEMP is currently working on their Edge Security Pack which will help provide some TMG functionality and compliment their already excellent offering. These devices already provide excellent value for money and my understanding is that the ESP will be a free upgrade for most customers. ESP is not publically available yet but I think it is worth looking at. <a href="http://www.kemptechnologies.com/en/tmg-edge-security-authentication.html" target="_blank">More info here</a>
<li><strong>Apache HTTP Server with mod_proxy - </strong>No, your eyes are not deceiving you, it is possible to use apache as a reverse proxy. I am not making any claims about the supportability of the solution or saying that it is an enterprise ready option, and just because it is possible to do it does not mean you should. I have seen many attempts at this solution in the past so I am currently working on a post that will provide a guide on how to go about setting it all up as well as explain the limitations and pitfalls of the solution. I hope to post more about it soon.</li>
</ol>
<p>I&rsquo;m sure there are many other equally suitable solutions, but my intention was to mention some of the ones I have worked with or tested. Each of these also have different pricing and scalability options so they will appeal to a wide range of different organisations.</p>


        
    </div>

    <footer class="post-footer">
        <div class="share">Share
            <ul class="social-networks">
                <li class="share-facebook"><a href="https://www.facebook.com/sharer.php?s=100&p[title]=Exchange Server and the Reverse Proxy&p[summary]=Ever since Microsoft announced that Forefront Threat Management Gateway (TMG) 2010 will be discontinued, I have had many customers ask me...&p[url]=http://172.16.7.177:4000/2013/03/exchange-server-and-the-reverse-proxy" class="s_facebook" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#facebook-icon"></use></svg></a></a></li>
                <li class="share-twitter"><a href="http://twitter.com/share?url=http://172.16.7.177:4000/2013/03/exchange-server-and-the-reverse-proxy&text=Ever since Microsoft announced that Forefront Threat Management Gateway (TMG) 2010 will be discontinued, I have had many customers ask me...&hashtags=" rel="noreferrer" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li>
            </ul>
        </div>
        
        <div class="tags">
            <ul>
                
            </ul>
        </div>
        
    </footer>
</article>

<article class="post" role="article" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="post-header">
        <ul>
            <li><time datetime="2012-06-22T09:51:37-05:00" itemprop="datePublished">22 Jun, 2012</time></li>
            
        </ul>
        <h2 itemprop="name headline"><a href="http://172.16.7.177:4000/2012/06/exchange-hybrid-multi-namespace-autodiscover-configuration">Exchange Hybrid Multi-namespace Autodiscover Configuration</a></h2>
    </header>

    <div class="post-content">
        <p>I came across an interesting issue when using the Exchange Hybrid Configuration Wizard in a multi-namespace environment recently. Autodiscover was configured and working correctly for Outlook and EAS clients but the wizard would not complete successfully and would generate the following error: &ldquo;Federation information could not be received from the external organization&hellip;&rdquo; as seen below:</p>
<p align="center"><a href="http://www.cgoosen.com/wp-content/uploads/2012/06/autodiscover.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-width: 0px;" title="autodiscover" src="http://www.cgoosen.com/wp-content/uploads/2012/06/autodiscover_thumb.png" alt="autodiscover" width="568" height="495" border="0" /></a></p>
<p>After some investigation, I discovered that this problem was related to Autodiscover. Typically in an on-premises Exchange 2010 deployment, there are a number of different ways to configure Autodiscover when using multiple namespaces. These are:</p>
<p><strong><span style="text-decoration: underline;">Option 1 - Single SSL Certificate that is valid for all DNS names (SAN Certificate)</span></strong><br />
<strong>Pros:</strong></p>
<ul>
<li>Requires only one certificate.</li>
<li>Requires only 1 public IP.</li>
</ul>
<p><strong>Cons:</strong></p>
<ul>
<li>Cost of additional DNS names in the SAN certificate could be expensive.</li>
</ul>
<p><strong><span style="text-decoration: underline;">Option 2 - Single-name SSL Certificate with DNS SRV Lookup</span></strong><br />
<strong>Pros:</strong></p>
<ul>
<li>Requires only 1 public IP.</li>
<li>Requires 1 single-name SSL certificate.</li>
</ul>
<p><strong>Cons:</strong></p>
<ul>
<li>Not all DNS hosting providers support DNS SRV records.</li>
<li>Outlook users may be prompted.</li>
<li>Outlook 2007 required client-side hotfix.</li>
</ul>
<p><strong><span style="text-decoration: underline;">Option 3 - Single-name SSL Certificate with HTTP redirect</span></strong><br />
<strong>Pros:</strong></p>
<ul>
<li>Requires 1 single-name SSL certificate.</li>
</ul>
<p><strong>Cons:</strong></p>
<ul>
<li>Requires 2 public IPs</li>
<li>Requires a second IIS site or ISA/TMG</li>
</ul>
<p>While these will all work and have their pros and cons, I would usually always use &lsquo;option 1&rsquo; listed above unless there is a good reason not to. In this particular instance, the Autodiscover was configured using &lsquo;option 3&rsquo; and even though Autodiscover worked fine for clients, the Hybrid Configuration Wizard did not seem to like this configuration.</p>
<p>The Office 365 documentation does not go into a great amount of detail about multi-domain Autodiscover configuration and says: &ldquo;Configure the Autodiscover public DNS records for your existing SMTP domains to point to an on-premises Exchange 2010 SP2 Client Access server&rdquo; which is technically what had been done. The reason this caused a problem is because unlike Outlook or EAS clients, Office 365 does not use the Autodiscover discovery process and instead makes a direct connection to <strong>https://autodiscover.domain.com/autodiscover/autodiscover.svc/wssecurity </strong>for each domain being used and does not obey the web redirect that had previously been configured.</p>
<p>In order to solve this problem, we purchased a new SAN certificate and reconfigured Autodiscover as described in &lsquo;option 1&rsquo;. In short, this is the only way to configure Autodiscover if you plan to implement an Exchange Hybrid Deployment. Additionally, if you are not using split DNS and have an internal DNS zone that is different to your external DNS (eg. domain.local), you need to ensure that the relevant external Autodiscover records are resolvable internally as well.</p>
<p>As a side note, if you are using ISA/TMG to publish EWS/Autodiscover, you need to create a separate rule without authentication delegation for the following paths:</p>
<ul>
<li>/ews/mrsproxy.svc</li>
<li>/ews/exchange.asmx/wssecurity</li>
<li>/autodiscover/autodiscover.svc/wssecurity</li>
<li>/autodiscover/autodiscover.svc</li>
</ul>


        
    </div>

    <footer class="post-footer">
        <div class="share">Share
            <ul class="social-networks">
                <li class="share-facebook"><a href="https://www.facebook.com/sharer.php?s=100&p[title]=Exchange Hybrid Multi-namespace Autodiscover Configuration&p[summary]=I came across an interesting issue when using the Exchange Hybrid Configuration Wizard in a multi-namespace environment recently. Autodis...&p[url]=http://172.16.7.177:4000/2012/06/exchange-hybrid-multi-namespace-autodiscover-configuration" class="s_facebook" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#facebook-icon"></use></svg></a></a></li>
                <li class="share-twitter"><a href="http://twitter.com/share?url=http://172.16.7.177:4000/2012/06/exchange-hybrid-multi-namespace-autodiscover-configuration&text=I came across an interesting issue when using the Exchange Hybrid Configuration Wizard in a multi-namespace environment recently. Autodis...&hashtags=" rel="noreferrer" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li>
            </ul>
        </div>
        
        <div class="tags">
            <ul>
                
            </ul>
        </div>
        
    </footer>
</article>

<article class="post" role="article" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="post-header">
        <ul>
            <li><time datetime="2010-10-11T10:06:42-05:00" itemprop="datePublished">11 Oct, 2010</time></li>
            
        </ul>
        <h2 itemprop="name headline"><a href="http://172.16.7.177:4000/2010/10/forefront-tmg-error-2146233088">Forefront TMG error : %%-2146233088</a></h2>
    </header>

    <div class="post-content">
        <p>Earlier this year I post a 6 part post entitled <a href="http://www.cgoosen.com/2010/05/securing-exchange-2010-with-forefront-threat-management-gateway-tmg-2010-part-1-the-introduction/" target="_blank">&ldquo;Securing Exchange 2010 with Forefront Threat Management Gateway (TMG) 2010&rdquo;</a> which covered colocating Exchange 2010 Edge and Forefront TMG 2010 on the same server to create a a single, secure point of entry for all mail related services.</p>
<p>When Exchange 2010 SP1 <a href="http://www.cgoosen.com/2010/08/exchange-2010-sp1-is-here/" target="_blank">was released</a> in late August many people started to report seeing the following error in their event log:</p>
<p><em>&ldquo;Microsoft Forefront TMG Managed Control service fails to start and the event viewer will contain a message that the service terminated with the following error : %%-2146233088&rdquo;</em></p>
<p>The reason for this is that SP1 removed some of the existing cmdlets, in particular <em>get-antispamupdates </em>which is used by TMG when spam filtering functionality is enabled.</p>
<p>The forefront team <a href="http://blogs.technet.com/b/isablog/archive/2010/09/20/software-update-1-for-microsoft-forefront-threat-management-gateway-tmg-2010-service-pack-1-now-available-for-download.aspx" target="_blank">recently announced</a> the release of Software Update 1 for Forefront TMG 2010 SP1. This update resolves the issue.</p>
<p>Download Software Update 1 for Forefront TMG 2010 SP1 <a href="http://www.microsoft.com/downloads/en/details.aspx?FamilyID=695d0709-0d8b-45ee-afdb-727c4428ca4d" target="_blank">here</a></p>


        
    </div>

    <footer class="post-footer">
        <div class="share">Share
            <ul class="social-networks">
                <li class="share-facebook"><a href="https://www.facebook.com/sharer.php?s=100&p[title]=Forefront TMG error : %%-2146233088&p[summary]=Earlier this year I post a 6 part post entitled &ldquo;Securing Exchange 2010 with Forefront Threat Management Gateway (TMG) 2010&rdquo; ...&p[url]=http://172.16.7.177:4000/2010/10/forefront-tmg-error-2146233088" class="s_facebook" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#facebook-icon"></use></svg></a></a></li>
                <li class="share-twitter"><a href="http://twitter.com/share?url=http://172.16.7.177:4000/2010/10/forefront-tmg-error-2146233088&text=Earlier this year I post a 6 part post entitled &ldquo;Securing Exchange 2010 with Forefront Threat Management Gateway (TMG) 2010&rdquo; ...&hashtags=" rel="noreferrer" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li>
            </ul>
        </div>
        
        <div class="tags">
            <ul>
                
            </ul>
        </div>
        
    </footer>
</article>

<article class="post" role="article" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="post-header">
        <ul>
            <li><time datetime="2010-06-02T08:00:00-05:00" itemprop="datePublished">2 Jun, 2010</time></li>
            
        </ul>
        <h2 itemprop="name headline"><a href="http://172.16.7.177:4000/2010/06/securing-exchange-2010-with-forefront-threat-management-gateway-tmg-2010-part-6-publishing-outlook-web-app">Securing Exchange 2010 with Forefront Threat Management Gateway (TMG) 2010, Part 6 - Publishing Outlook Web App</a></h2>
    </header>

    <div class="post-content">
        <p>In the first 5 parts of this series, I went through all the steps required to successfully install Forefront Protection 2010 for Exchange Server and Forefront Threat Management Gateway (TMG) 2010 on the same server as your Exchange Server Edge Transport role. I also looked at some basic configuration so we should now be able to send and receive email.</p>
<p>What about external access? TMG 2010 can also securely publish all your Exchange Server related services such as Outlook Web App (OWA), Outlook Anywhere and ActiveSync (EAS).</p>
<p>In this final part of the series I&rsquo;ll look at publishing OWA to the internet. While my focus is mainly on OWA, Outlook Anywhere and EAS should also work after very little or no additional configuration. I&rsquo;ll start by creating a new certificate request and then submitting it to certificate authority and then install the issued certificate. I&rsquo;ll then go over how to correctly export the issued certificate and import it on the TMG server. I&rsquo;ll then conclude the series by creating a new &ldquo;Exchange Web Client Access Publishing Rule&rdquo;.</p>
<p>A few notes before I begin.. When working with certificates, there are two options, I have opted to use my own Enterprise Root CA which has been installed on my domain controller. You are of course welcome to purchase a certificate from a third-party CA, if you decide that this is a better option for you, the basic configuration steps below will not differ all that much, the only difference will be in how you submit the request to the CA. I highly recommend purchasing a UC Certificate for this, please see the following <a href="http://support.microsoft.com/kb/929395" target="_blank">Microsoft TechNet</a> article for more information.</p>
<p>This post also assumes that your domain controllers already accept LDAP connections over SSL. To enable this, you need to install a server certificate on each of your domain controllers. The following <a href="http://support.microsoft.com/kb/321051" target="_blank">Microsoft TechNet</a> article may provide some guidance if you need further assistance with this.</p>
<p>The first step is to confirm out OWA configuration, this is done by opening the Exchange Management Console, expand &ldquo;Server Configuration&rdquo;, click &ldquo;Client Access&rdquo; and then right-click &ldquo;owa (Default Web Site)&rdquo; and select &ldquo;Properties&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image37.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image3_thumb.png" border="0" alt="image" width="504" height="584" /></a></p>
<p>It is also important to change the authentication settings by clicking on the &ldquo;Authentication&rdquo; tab. We need to disable forms based authentication as TMG will be providing this feature. If you keep Exchange forms based authentication enabled your users will be prompted to log into OWA twice.</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image61.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image6_thumb1.png" border="0" alt="image" width="504" height="581" /></a></p>
<p>We now need to create a certificate request for the certificate that will be used to OWA. This can of course be done from the Exchange Management Shell by making use of the <em>New-ExchangeCertifate </em>cmdlet or by making use of the new wizard included in the Exchange Management Console. To access the wizard, click &ldquo;Server Configuration&rdquo;, select your CAS server and click &ldquo;New Exchange Certificate&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image91.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image9_thumb.png" border="0" alt="image" width="204" height="215" /></a></p>
<p>&ldquo;Enter a friendly name for the certificate&rdquo;, I usually use the external FQDN here. Click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image121.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image12_thumb1.png" border="0" alt="image" width="504" height="442" /></a></p>
<p>If you are using a wildcard certificate, you can enter the root domain name here, I have elected not to use a wildcard certificate. Click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image151.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image15_thumb1.png" border="0" alt="image" width="504" height="437" /></a></p>
<p>Next, select your required configuration. Enter your configuration and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image181.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image18_thumb1.png" border="0" alt="image" width="504" height="442" /></a></p>
<p>Review your certificate domains, I usually enter the server name without a suffix as well, but this is not necessarily required. Ensure that you have your internal, external and both autodiscover names listed and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image211.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image21_thumb.png" border="0" alt="image" width="504" height="442" /></a></p>
<p>Enter your organization and location details and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image241.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image24_thumb1.png" border="0" alt="image" width="504" height="439" /></a></p>
<p>Review your certificate configuration summary and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image272.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image27_thumb2.png" border="0" alt="image" width="504" height="439" /></a></p>
<p>Once complete, click &ldquo;Finish&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image301.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image30_thumb1.png" border="0" alt="image" width="504" height="439" /></a></p>
<p>For those looking to use the Exchange Management Shell to complete this request, the command would look something like this:</p>
<p><em>New-ExchangeCertificate -FriendlyName 'dogfood.cgoosen.com' &ndash;GenerateRequest -PrivateKeyExportable $true -KeySize '2048' -SubjectName 'C=AU,S="NSW",L="Sydney",O="cgoosen.com",OU="test lab",CN=dogfood.cgoosen.com' &ndash;DomainName 'tlex01.testlab.local','dogfood.cgoosen.com','autodiscover.testlab.local','autodiscover.dogfood.cgoosen.com','tlex01' -Server 'TLEX01'</em></p>
<p>Now that we have completed out certificate request, it is time to submit this request to a CA. I&rsquo;ll be using my Enterprise Root CA which is installed on my domain controller, so I&rsquo;ll just submit the request opening <a href="https://tldc01.testlab.local/CertSrv">https://tldc01.testlab.local/CertSrv</a> Click &ldquo;Request a certificate&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image40.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image_thumb15.png" border="0" alt="image" width="504" height="237" /></a></p>
<p>Then click on &ldquo;advanced certificate request&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image333.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image33_thumb3.png" border="0" alt="image" width="504" height="229" /></a></p>
<p>Since we have already created the certificate request, select &ldquo;Submit a certificate request by using a base-64-encoded CMC or PKCS#10 file, or submit a renewal request by using a base-64-encoded PKCS#7 file&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image362.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image36_thumb2.png" border="0" alt="image" width="504" height="112" /></a></p>
<p>Paste the certificate request in the box provided, select the &ldquo;Web Server&rdquo; template and click &ldquo;Submit&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image391.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image39_thumb1.png" border="0" alt="image" width="504" height="279" /></a></p>
<p>Click &ldquo;Yes&rdquo; to acknowledge the &ldquo;Web Access Confirmation&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image42.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image42_thumb.png" border="0" alt="image" width="354" height="205" /></a></p>
<p>Next download only the &ldquo;DER encoded&rdquo; certificate.</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image451.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image45_thumb1.png" border="0" alt="image" width="354" height="172" /></a></p>
<p>Now that we have our new certificate, it&rsquo;s time to install it. Once again, click &ldquo;Server Configuration&rdquo; and select your new certificate. Click &ldquo;Complete Pending Request&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image511.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image51_thumb1.png" border="0" alt="image" width="504" height="96" /></a></p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image481.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image48_thumb1.png" border="0" alt="image" width="204" height="109" /></a></p>
<p>Select your new certificate and click &ldquo;Complete&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image541.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image54_thumb1.png" border="0" alt="image" width="504" height="444" /></a></p>
<p>Once completed, click &ldquo;Finish&rdquo;. You have now installed your new certificate.</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image571.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image57_thumb1.png" border="0" alt="image" width="504" height="439" /></a></p>
<p>We now need to assign services to the certificate, click &ldquo;Server Configuration&rdquo; and select your new certificate. Click &ldquo;Assign Services to Certificate&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image60.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image60_thumb.png" border="0" alt="image" width="204" height="164" /></a></p>
<p>Select your CAS server and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image631.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image63_thumb1.png" border="0" alt="image" width="504" height="439" /></a></p>
<p>Ensure that you have selected &ldquo;Internet Information Services&rdquo; and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image661.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image66_thumb1.png" border="0" alt="image" width="504" height="442" /></a></p>
<p>Review the configuration summary and click &ldquo;Assign&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image691.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image69_thumb1.png" border="0" alt="image" width="504" height="442" /></a></p>
<p>Once completed, click &ldquo;Finish&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image72.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image72_thumb.png" border="0" alt="image" width="504" height="442" /></a></p>
<p>Now that we&rsquo;ve installed the new certificate and assigned services to it, lets give it a quick test internally. My internal URL is <a href="https://tlex01.testlab.local/owa">https://tlex01.testlab.local/owa</a></p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image751.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image75_thumb1.png" border="0" alt="image" width="504" height="206" /></a></p>
<p>Before we can import the certificate on the TMG server, you need to export the certificate along with its private key from the CAS server. Open the &ldquo;Certificates&rdquo; MMC and make sure you are viewing the &ldquo;Local Computer&rdquo;. We need to export 2 certificates. The first is the Enterprise Root CA certificate located in the &ldquo;Trusted Root Certificate Authorities&rdquo; store.</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image781.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image78_thumb1.png" border="0" alt="image" width="504" height="152" /></a></p>
<p>The second certificate is the new exchange certificate we just installed, it should be located in the &ldquo;Personal&rdquo; store.</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image811.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image81_thumb1.png" border="0" alt="image" width="504" height="146" /></a></p>
<p>Lets start with the Enterprise Root CA certificate, right-click the certificate and click &ldquo;Export&rdquo;. Click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image84.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image84_thumb.png" border="0" alt="image" width="504" height="454" /></a></p>
<p>Select &ldquo;DER encoded binary X.509 (.CER)&rdquo; and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image87.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image87_thumb.png" border="0" alt="image" width="504" height="456" /></a></p>
<p>Give it a meaningful and name be sure to note down the location and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image901.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image90_thumb1.png" border="0" alt="image" width="504" height="454" /></a></p>
<p>Review the settings and click &ldquo;Finish&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image931.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image93_thumb1.png" border="0" alt="image" width="504" height="454" /></a></p>
<p>Once completed successfully, click &ldquo;Ok&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image96.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image96_thumb.png" border="0" alt="image" width="204" height="141" /></a></p>
<p>Next we export the exchange certificate along with its private key. right-click the certificate and click &ldquo;Export&rdquo;. Click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image841.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image84_thumb1.png" border="0" alt="image" width="504" height="454" /></a></p>
<p>Ensure that you have selected &ldquo;Yes, export the private key&rdquo; and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image99.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image99_thumb.png" border="0" alt="image" width="504" height="454" /></a></p>
<p>Ensure that you have selected &ldquo;Export all extended properties&rdquo; and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image105.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image105_thumb.png" border="0" alt="image" width="504" height="456" /></a></p>
<p>You need to protect the private key by using a password, be sure to remember what password you enter here and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image108.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image108_thumb.png" border="0" alt="image" width="504" height="454" /></a></p>
<p>Give it a meaningful and name be sure to note down the location and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image111.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image111_thumb.png" border="0" alt="image" width="504" height="458" /></a></p>
<p>Review the settings and click &ldquo;Finish&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image114.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image114_thumb.png" border="0" alt="image" width="504" height="454" /></a></p>
<p>Once completed successfully, click &ldquo;Ok&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image961.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image96_thumb1.png" border="0" alt="image" width="204" height="141" /></a></p>
<p>Once you have those 2 certificates, (ca_cert.cer and cas_cert.pfx if you followed my naming convention) copy them to your TMG server. The log onto the TMG server and open the &ldquo;Certificates&rdquo; MMC and make sure you are viewing the &ldquo;Local Computer&rdquo;. We now repeat the previous process in reverse.</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image117.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image117_thumb.png" border="0" alt="image" width="504" height="135" /></a></p>
<p>First we import the Enterprise Root CA certificate, expand the &ldquo;Trusted Root Certificate Authorities&rdquo; store, right-click &ldquo;Certificates&rdquo; and select &ldquo;Import&rdquo;. Click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image120.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image120_thumb.png" border="0" alt="image" width="504" height="454" /></a></p>
<p>Locate the certificate and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image123.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image123_thumb.png" border="0" alt="image" width="504" height="454" /></a></p>
<p>You will notice that it will already have the correct location specified, do not change this, just click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image126.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image126_thumb.png" border="0" alt="image" width="504" height="456" /></a></p>
<p>Review the settings and click &ldquo;Finish&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image129.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image129_thumb.png" border="0" alt="image" width="504" height="456" /></a></p>
<p>Once completed successfully, click &ldquo;Ok&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image132.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image132_thumb.png" border="0" alt="image" width="204" height="133" /></a></p>
<p>We then import the exchange certificate. Expand the &ldquo;Personal&rdquo; store right-click &ldquo;Certificates&rdquo; and select &ldquo;Import&rdquo;. Click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image1201.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image120_thumb1.png" border="0" alt="image" width="504" height="454" /></a></p>
<p>Locate the certificate and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image135.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image135_thumb.png" border="0" alt="image" width="504" height="456" /></a></p>
<p>Enter the private key password (you do remember it, right?) Ensure that you have selected &ldquo;Include all extended properties&rdquo; and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image138.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image138_thumb.png" border="0" alt="image" width="504" height="454" /></a></p>
<p>The correct location should already be specified, do not change this, just click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image141.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image141_thumb.png" border="0" alt="image" width="504" height="454" /></a></p>
<p>Review the settings and click &ldquo;Finish&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image144.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image144_thumb.png" border="0" alt="image" width="504" height="454" /></a></p>
<p>Once completed successfully, click &ldquo;Ok&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image1321.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image132_thumb1.png" border="0" alt="image" width="204" height="133" /></a></p>
<p>Once this is done, should should be able to double-click the exchange certificate and check the status. Both certificates should be &ldquo;Ok&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image147.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image147_thumb.png" border="0" alt="image" width="354" height="435" /></a></p>
<p>The final step in the process is to create a &ldquo;Exchange Web Client Access Publishing Rule&rdquo;. Open the TMG Management Console, right-click &ldquo;Firewall Policy&rdquo;, select &ldquo;New&rdquo; and then select &ldquo;Exchange Web Client Access Publishing Rule&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image150.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image150_thumb.png" border="0" alt="image" width="504" height="256" /></a></p>
<p>Give your rule a meaningful name and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image153.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image153_thumb.png" border="0" alt="image" width="504" height="475" /></a></p>
<p>Select your Exchange version and select &ldquo;Outlook Web Access&rdquo;, then click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image156.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image156_thumb.png" border="0" alt="image" width="504" height="475" /></a></p>
<p>Select your publishing type and then click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image159.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image159_thumb.png" border="0" alt="image" width="504" height="475" /></a></p>
<p>Since we will be using SSL, select that option and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image162.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image162_thumb.png" border="0" alt="image" width="504" height="477" /></a></p>
<p>Enter your internal site name, only enter the FQDN, there is no need to add HTTP/S or /OWA. Click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image165.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image165_thumb.png" border="0" alt="image" width="504" height="475" /></a></p>
<p>Enter your public name here, again only the FQDN. Click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image168.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image168_thumb.png" border="0" alt="image" width="504" height="475" /></a></p>
<p>Select your web listener, since I don&rsquo;t already have one, I am going to create a new one by clicking &ldquo;New&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image171.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image171_thumb.png" border="0" alt="image" width="504" height="475" /></a></p>
<p>Enter a meaningful name and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image174.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image174_thumb.png" border="0" alt="image" width="504" height="473" /></a></p>
<p>We will be using SSL and want to require SSL connections from all clients. Click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image177.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image177_thumb.png" border="0" alt="image" width="504" height="475" /></a></p>
<p>Select your listener IP address, this should be your external network address. Click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image180.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image180_thumb.png" border="0" alt="image" width="504" height="475" /></a></p>
<p>Click &ldquo;Select Certificate&rdquo; and then select the exchange certificate we installed in the previously. Click &ldquo;Select&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image183.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image183_thumb.png" border="0" alt="image" width="504" height="429" /></a></p>
<p>Click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image186.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image186_thumb.png" border="0" alt="image" width="504" height="474" /></a></p>
<p>Next we look at authentication settings, since our server is not a part of the domain, we are unable to use &ldquo;Windows&rdquo; authentication. Make sure &ldquo;HTML Form Authentication&rdquo; is selected, select &ldquo;LDAP (Active Directory)&rdquo; and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image189.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image189_thumb.png" border="0" alt="image" width="504" height="475" /></a></p>
<p>I won&rsquo;t be making use of SSO, make your selection and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image192.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image192_thumb.png" border="0" alt="image" width="504" height="473" /></a></p>
<p>We need to add at least one LDAP server for user authentication, add your domain controllers here, type your domain name and I highly recommend that you make use of LDAP over SSL. Click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image198.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image198_thumb.png" border="0" alt="image" width="504" height="473" /></a></p>
<p>Review your web listener configuration and click &ldquo;Finish&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image195.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image195_thumb.png" border="0" alt="image" width="504" height="477" /></a></p>
<p>Select the web listener you just created and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image201.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image201_thumb.png" border="0" alt="image" width="504" height="473" /></a></p>
<p>Select &ldquo;Basic Authentication&rdquo; and then click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image204.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image204_thumb.png" border="0" alt="image" width="504" height="474" /></a></p>
<p>This rule will apply to &ldquo;All Authenticated Users&rdquo;, click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image207.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image207_thumb.png" border="0" alt="image" width="504" height="475" /></a></p>
<p>Review your configuration and then click &ldquo;Finish&rdquo; to create the rule.</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image210.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image210_thumb.png" border="0" alt="image" width="504" height="475" /></a></p>
<p>Once the rule has been created, we need to apply it to TMG, click &ldquo;Apply&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image213.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image213_thumb.png" border="0" alt="image" width="504" height="123" /></a></p>
<p>You should now see your rule listed..</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image216.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image216_thumb.png" border="0" alt="image" width="504" height="108" /></a></p>
<p>Now for the fun part, lets test our configuration. If you visit your external URL, mine is <a href="https://dogfood.cgoosen.com/owa">https://dogfood.cgoosen.com/owa</a> you should be presented with a OWA login form. Notice the &ldquo;Secured by Microsoft Forefront Threat Management Gateway&rdquo; banner at the bottom.</p>
<p>Enter your user name in the format &ldquo;Domain\user name&rdquo; and your password and click &ldquo;Log On&rdquo; If you have any certificate alerts, you may need to install your Root CA certificate to the &ldquo;Trusted Root Certification Authorities&rdquo; store on your workstation. If you are using an Enterprise Root CA, it uses Group Policy to propagate its certificate to the &ldquo;Trusted Root Certification Authorities&rdquo; store for all users and computers in the domain.</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image219.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image219_thumb.png" border="0" alt="image" width="504" height="466" /></a></p>
<p>If everything has been correctly configured, you should be presented with your inbox.</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image2221.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image222_thumb.png" border="0" alt="image" width="504" height="145" /></a></p>
<p>To summarise, in this final part of the series I created a new certificate request and then submitted it to certificate authority. Once I had downloaded the issued certificate, I installed it on my exchange CAS server and assigned services to it. I then exported the issued certificate and imported it on the TMG server. To complete the process, I created a new &ldquo;Exchange Web Client Access Publishing Rule&rdquo;.</p>
<p>In this 6 part series, I went through the process of installing Exchange Server Edge, Forefront Protection 2010 for Exchange Server and TMG 2010 on the same server. Consolidating these services greatly reduces management complexity and overhead.</p>


        
    </div>

    <footer class="post-footer">
        <div class="share">Share
            <ul class="social-networks">
                <li class="share-facebook"><a href="https://www.facebook.com/sharer.php?s=100&p[title]=Securing Exchange 2010 with Forefront Threat Management Gateway (TMG) 2010, Part 6 - Publishing Outlook Web App&p[summary]=In the first 5 parts of this series, I went through all the steps required to successfully install Forefront Protection 2010 for Exchange...&p[url]=http://172.16.7.177:4000/2010/06/securing-exchange-2010-with-forefront-threat-management-gateway-tmg-2010-part-6-publishing-outlook-web-app" class="s_facebook" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#facebook-icon"></use></svg></a></a></li>
                <li class="share-twitter"><a href="http://twitter.com/share?url=http://172.16.7.177:4000/2010/06/securing-exchange-2010-with-forefront-threat-management-gateway-tmg-2010-part-6-publishing-outlook-web-app&text=In the first 5 parts of this series, I went through all the steps required to successfully install Forefront Protection 2010 for Exchange...&hashtags=" rel="noreferrer" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li>
            </ul>
        </div>
        
        <div class="tags">
            <ul>
                
            </ul>
        </div>
        
    </footer>
</article>

<article class="post" role="article" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="post-header">
        <ul>
            <li><time datetime="2010-06-01T01:45:00-05:00" itemprop="datePublished">1 Jun, 2010</time></li>
            
        </ul>
        <h2 itemprop="name headline"><a href="http://172.16.7.177:4000/2010/06/securing-exchange-2010-with-forefront-threat-management-gateway-tmg-2010-part-5-putting-it-all-together">Securing Exchange 2010 with Forefront Threat Management Gateway (TMG) 2010, Part 5 - Putting it all together</a></h2>
    </header>

    <div class="post-content">
        <p>We finally have our consolidated Exchange Server Edge and TMG 2010 server installed, but what now? How do we take advantage of all the great new features? In this part of the series, I&rsquo;ll configure our E-Mail Policy, create a new Edge Subscription and then configure Antivirus and File Filters</p>
<p>Firstly, we&rsquo;ll configure our E-Mail Policy. If you open the TMG Management Console, select &ldquo;E-Mail Policy&rdquo; and then select &ldquo;Configure E-Mail Policy&rdquo; from the tasks pane.</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image5.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image_thumb4.png" border="0" alt="image" width="504" height="200" /></a></p>
<p>On the &ldquo;Welcome to the E-Mail Policy Wizard&rdquo; screen, click &ldquo;Next&rdquo; to continue</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image41.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image4_thumb.png" border="0" alt="image" width="504" height="444" /></a></p>
<p>On the &ldquo;Internal Mail Server Configuration&rdquo; screen, add all the Exchange hub servers that you want to forward incoming mail to. You also need to add your accepted domains. Then click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image711.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image711_thumb.png" border="0" alt="image" width="504" height="446" /></a></p>
<p>For the &ldquo;Internal E-Mail Listener&rdquo; choose the Internal network. You can also specify which IP to listen on if multiple IPs are available. Click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image10.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image10_thumb.png" border="0" alt="image" width="504" height="444" /></a></p>
<p>For the &ldquo;External E-Mail Listener&rdquo; choose to listen on the External network and specify the FQDN that will be presented in HELO and EHLO commands.</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image13111.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image13111_thumb.png" border="0" alt="image" width="504" height="444" /></a></p>
<p>Enable spam filtering, virus and content filtering. You also have the option to enable EdgeSync Traffic, you should enable this here as it will create the relevant System Policy to allow port 50636 for communication with the Exchange hub transport server.</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image16.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image16_thumb.png" border="0" alt="image" width="504" height="444" /></a></p>
<p>Click &ldquo;Finish&rdquo; to complete the e-mail policy wizard</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image19.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image19_thumb.png" border="0" alt="image" width="504" height="444" /></a></p>
<p>TMG will prompt you to create a System Policy, click &ldquo;Yes&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image2211.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image2211_thumb.png" border="0" alt="image" width="354" height="164" /></a></p>
<p>Once done, click &ldquo;Apply&rdquo; to apply the new E-Mail Policy</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image251.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image251_thumb.png" border="0" alt="image" width="504" height="123" /></a></p>
<p>Next, we setup a new edge subscription, From the TMG Management console, navigate to &ldquo;E-Mail Policy&rdquo; and in the &ldquo;Tasks&rdquo; plane, click &ldquo;Generate Edge Subscription Files&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image281.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image281_thumb.png" border="0" alt="image" width="504" height="239" /></a></p>
<p>Make a note of where you save this file. Once complete, copy the edge subscription file to your Hub Transport server.</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image3111.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image3111_thumb.png" border="0" alt="image" width="354" height="126" /></a></p>
<p>Log on to your Hub Transport server and open the Exchange Management Console, then expand &ldquo;Organization Configuration&rdquo; and click on &ldquo;Hub Transport&rdquo;. Click &ldquo;New Edge Subscription under the &ldquo;Actions&rdquo; menu.</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image341.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image341_thumb.png" border="0" alt="image" width="504" height="210" /></a></p>
<p>Select the appropriate AD site and locate the edge subscription file copied from your TMG server. Click &ldquo;New&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image371.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image371_thumb.png" border="0" alt="image" width="504" height="439" /></a></p>
<p>Once the wizard completes successfully, click &ldquo;Finish&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image401.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image401_thumb.png" border="0" alt="image" width="504" height="439" /></a></p>
<p>Expand &ldquo;Organization Configuration&rdquo;, click on &ldquo;Hub Transport&rdquo; and select the &ldquo;Edge Subscriptions&rdquo; tab. You should now see your edge subscription listed there.</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image46.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image46_thumb.png" border="0" alt="image" width="504" height="108" /></a></p>
<p>On your Hub Transport server, ensure that the &ldquo;Microsoft Exchange EdgeSync&rdquo; service is set to automatically start.</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image131.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image13_thumb1.png" border="0" alt="image" width="504" height="567" /></a></p>
<p>On the Hub Transport server, open the Exchange Management Shell and start edge synchronization by issuing the following cmdlet</p>
<p><em>Start-EdgeSynchronization</em></p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image11.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image11_thumb.png" border="0" alt="image" width="504" height="331" /></a></p>
<p>After a few minutes, you should be able to verify that your edge synchronization is working by opening the &ldquo;Exchange Management Shell&rdquo; and issuing the following cmdlet:</p>
<p><em>Get-SendConnector</em></p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image71.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image71_thumb.png" border="0" alt="image" width="504" height="144" /></a></p>
<p>Next, We need to verify the authentication settings on the Receive Connectors.</p>
<p>On the Hub Transport server, open the Exchange Management Console and expand to "Server Configuration", click on "Hub Transport", right click on the "Default Receive Connector" and select Properties. On the Authentication tab, verify that TLS and Exchange Server authentication are selected.</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image1611.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image1611_thumb.png" border="0" alt="image" width="504" height="565" /></a></p>
<p>On the TMG server, open the TMG Management console and navigate to "E-Mail Policy", right click on the "Internal_Mail_Servers" route and select Properties. On the Listener tab, click "Authentication Settings" and verify that only TLS and Exchange Server Authentication are selected.</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image191.png"><img class="aligncenter" style="display: inline; border: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image191_thumb.png" border="0" alt="image" width="354" height="255" /></a></p>
<p>Lastly, we can configure Antivirus scanning and file filtering settings. In this example I will enable a 3 antivirus engines and configure file filtering to block .EXE files.</p>
<p>On the TMG server, open the TMG Management console, click &ldquo;E-Mail Policy, then select the &ldquo;Virus and Content Filtering&rdquo; tab,</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image8.png"><img class="aligncenter" style="display: inline; border: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image_thumb5.png" border="0" alt="image" width="504" height="196" /></a></p>
<p>Click &ldquo;Select AV Engines&rdquo; on the Tasks Pane. Select one or more engines from the list. The click &ldquo;OK&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image222.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image22_thumb2.png" border="0" alt="image" width="504" height="560" /></a></p>
<p>Next, click the &ldquo;Enabled&rdquo; link below &ldquo;File Filtering&rdquo;. On the File Filters&rdquo; tab, click &ldquo;Add&rdquo; and then on the General tab give it a meaningful name. You can apply the filter to inbound and/or outbound messages.</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image25.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image25_thumb.png" border="0" alt="image" width="504" height="560" /></a></p>
<p>On the File Types tab select Microsoft Windows Executable. Click &ldquo;Apply&rdquo;</p>
<p><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image28.png"><img style="display: block; float: none; margin-left: auto; margin-right: auto; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image28_thumb.png" border="0" alt="image" width="504" height="560" /></a></p>
<p>Confirm that the filter has been added and click &ldquo;OK&rdquo;</p>
<p><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image9.png"></a></p>
<p><a href="file:///D:/Users/T812609/AppData/Local/Temp/WindowsLiveWriter-429641856/supfiles179D955/image121.png"></a></p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image14.png"><img class="aligncenter" style="display: inline; border: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image_thumb6.png" border="0" alt="image" width="504" height="554" /></a></p>
<p>Once done, click &ldquo;Apply&rdquo; to apply the settings</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image251.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image251_thumb.png" border="0" alt="image" width="504" height="123" /></a></p>
<p>To summarise, in this part of the series I configured my E-Mail Policy/ I then created and verified a new Edge Subscription. I finished off by configuring Antivirus and creating a File Filter to block .EXE files.</p>
<p>In the next and final part of this series, I&rsquo;ll look at how to securely publish Outlook Web App.</p>


        
    </div>

    <footer class="post-footer">
        <div class="share">Share
            <ul class="social-networks">
                <li class="share-facebook"><a href="https://www.facebook.com/sharer.php?s=100&p[title]=Securing Exchange 2010 with Forefront Threat Management Gateway (TMG) 2010, Part 5 - Putting it all together&p[summary]=We finally have our consolidated Exchange Server Edge and TMG 2010 server installed, but what now? How do we take advantage of all the gr...&p[url]=http://172.16.7.177:4000/2010/06/securing-exchange-2010-with-forefront-threat-management-gateway-tmg-2010-part-5-putting-it-all-together" class="s_facebook" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#facebook-icon"></use></svg></a></a></li>
                <li class="share-twitter"><a href="http://twitter.com/share?url=http://172.16.7.177:4000/2010/06/securing-exchange-2010-with-forefront-threat-management-gateway-tmg-2010-part-5-putting-it-all-together&text=We finally have our consolidated Exchange Server Edge and TMG 2010 server installed, but what now? How do we take advantage of all the gr...&hashtags=" rel="noreferrer" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li>
            </ul>
        </div>
        
        <div class="tags">
            <ul>
                
            </ul>
        </div>
        
    </footer>
</article>

<article class="post" role="article" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="post-header">
        <ul>
            <li><time datetime="2010-05-28T03:48:00-05:00" itemprop="datePublished">28 May, 2010</time></li>
            
        </ul>
        <h2 itemprop="name headline"><a href="http://172.16.7.177:4000/2010/05/securing-exchange-2010-with-forefront-threat-management-gateway-tmg-2010-part-4-installing-forefront-threat-management-gateway">Securing Exchange 2010 with Forefront Threat Management Gateway (TMG) 2010, Part 4 - Installing Forefront Threat Management Gateway</a></h2>
    </header>

    <div class="post-content">
        <p>Here we are, Part 4 of the series. To recap what I have done thus far.. I&rsquo;ve installed the Exchange Server Edge role followed by Forefront Protection 2010 for Exchange Server.</p>
<p>In this part I install TMG 2010 and perform some basic configuration. The minimum system requirements for TMG 2010 can be found on <a href="http://technet.microsoft.com/en-us/library/dd896981.aspx" target="_blank">Microsoft TechNet</a>.</p>
<p>To get started, insert your Forefront Threat Management Gateway 2010 installation media and then select &ldquo;Run Preparation Tool&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image4.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image_thumb3.png" border="0" alt="image" width="504" height="358" /></a></p>
<p>This launches the &ldquo;Forefront TMG Preparation Tool&rdquo;, read through the notes on the welcome screen and click &ldquo;Next&rdquo;. Read and accept the License Agreement and click &ldquo;Next&rdquo;</p>
<p>Depending on your environment, select the appropriate Installation Type. I won&rsquo;t be installing a TMG array so I selected &ldquo;Forefront TMG services and Management&rdquo;. Then click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image12.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image12_thumb.png" border="0" alt="image" width="504" height="352" /></a></p>
<p>Once all the prerequisite features have been installed, click &ldquo;Finish&rdquo; to launch the TMG 2010 installation wizard.</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image15.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image15_thumb.png" border="0" alt="image" width="504" height="352" /></a></p>
<p>Click &ldquo;Next&rdquo; on the welcome screen. Read and accept the License Agreement and click &ldquo;Next&rdquo;</p>
<p>Next you will be presented with the &ldquo;Customer Information&rdquo; page with the Product Serial Number. Once you have entered the appropriate details, click &ldquo;Next&rdquo; and verify the installation path. Change this as appropriate and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image24.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image24_thumb.png" border="0" alt="image" width="504" height="379" /></a></p>
<p>Next we need to define our internal network ranges. Be sure to include all of them there, mine are fairly simple and are all included in the range 172.0.0.0-172.0.0.255.</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image271.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image27_thumb1.png" border="0" alt="image" width="504" height="376" /></a></p>
<p>During the installation, some services will be restarted. Acknowledge this warning by clicking &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image30.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image30_thumb.png" border="0" alt="image" width="504" height="379" /></a></p>
<p>Click &ldquo;Install&rdquo; to begin the installation.</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image332.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image33_thumb2.png" border="0" alt="image" width="504" height="379" /></a></p>
<p>Once the installation has completed successfully, click &ldquo;Finish&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image361.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image36_thumb1.png" border="0" alt="image" width="504" height="383" /></a></p>
<p>Congratulations, you now have TMG 2010 installed. Lets look at some basic configuration. The first time you launch the TMG Management Console, you&rsquo;ll be presented with the &ldquo;Getting Started Wizard&rdquo; The first step is to &ldquo;Configure network settings&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image39.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image39_thumb.png" border="0" alt="image" width="504" height="452" /></a></p>
<p>Click &ldquo;Next&rdquo; to continue and then select the appropriate network template, you&rsquo;ll want to select &ldquo;Edge Firewall&rdquo; here. It should be noted that the &ldquo;Single network adaptor&rdquo; template has many limitations and will not work in our scenario. <a href="http://technet.microsoft.com/en-us/library/cc995236.aspx" target="_blank">Click here to read more about single network adapter limitations</a>. Click &ldquo;Next&rdquo; to continue</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image45.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image45_thumb.png" border="0" alt="image" width="504" height="437" /></a></p>
<p>Ensure that your LAN or &ldquo;Internal&rdquo; network settings are configured correctly and click &ldquo;Next&rdquo; *note the absence of a &ldquo;Default Gateway&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image48.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image48_thumb.png" border="0" alt="image" width="504" height="440" /></a></p>
<p>Then, ensure that your Internet or &ldquo;External&rdquo; network settings are configured correctly and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image51.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image51_thumb.png" border="0" alt="image" width="504" height="443" /></a></p>
<p>Click &ldquo;Finish&rdquo; to complete the network setup wizard.</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image54.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image54_thumb.png" border="0" alt="image" width="504" height="440" /></a></p>
<p>The next step is to &ldquo;Configure system settings&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image57.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image57_thumb.png" border="0" alt="image" width="504" height="452" /></a></p>
<p>Click &ldquo;Next&rdquo; to continue and then confirm the &ldquo;Host Identification&rdquo; settings, note once again that this server is a member of a workgroup and is not part of the domain. Click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image63.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image63_thumb.png" border="0" alt="image" width="504" height="439" /></a></p>
<p>Click &ldquo;Finish&rdquo; to complete the system configuration wizard</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image66.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image66_thumb.png" border="0" alt="image" width="504" height="438" /></a></p>
<p>The final step is to &ldquo;Define deployment options&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image69.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image69_thumb.png" border="0" alt="image" width="504" height="454" /></a></p>
<p>Click &ldquo;Next&rdquo; to continue and on the &ldquo;Microsoft Update Setup&rdquo; screen, select the appropriate setting and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image75.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image75_thumb.png" border="0" alt="image" width="504" height="443" /></a></p>
<p>Activate the relevant licenses and features and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image78.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image78_thumb.png" border="0" alt="image" width="504" height="443" /></a></p>
<p>On the &ldquo;NIS Signature Update Settings&rdquo; screen, select the appropriate setting and click &ldquo;Next&rdquo; if in doubt, just leave the defaults</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image81.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image81_thumb.png" border="0" alt="image" width="504" height="442" /></a></p>
<p>Would you like to join the &ldquo;Customer Experience Improvement Program&rdquo;? make your selection and click &ldquo;Next&rdquo; and then decide if you would like to participate in the &ldquo;Microsoft Telemetry Reporting Service&rdquo;, make your selection and click &ldquo;Next&rdquo;</p>
<p>Click &ldquo;Finish&rdquo; to complete the deployment wizard</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image90.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image90_thumb.png" border="0" alt="image" width="504" height="441" /></a></p>
<p>You have now completed the &ldquo;Getting Started Wizard&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image93.png"><img class="aligncenter" style="display: inline; border-width: 0px;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image93_thumb.png" border="0" alt="image" width="504" height="454" /></a></p>
<p>To summarise, in this part of the series I installed TMG 2010 and then proceeded to perform some basic configuration. In the next part of the series, I&rsquo;ll configure our email policy and create a new Edge Subscription</p>


        
    </div>

    <footer class="post-footer">
        <div class="share">Share
            <ul class="social-networks">
                <li class="share-facebook"><a href="https://www.facebook.com/sharer.php?s=100&p[title]=Securing Exchange 2010 with Forefront Threat Management Gateway (TMG) 2010, Part 4 - Installing Forefront Threat Management Gateway&p[summary]=Here we are, Part 4 of the series. To recap what I have done thus far.. I&rsquo;ve installed the Exchange Server Edge role followed by Fo...&p[url]=http://172.16.7.177:4000/2010/05/securing-exchange-2010-with-forefront-threat-management-gateway-tmg-2010-part-4-installing-forefront-threat-management-gateway" class="s_facebook" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#facebook-icon"></use></svg></a></a></li>
                <li class="share-twitter"><a href="http://twitter.com/share?url=http://172.16.7.177:4000/2010/05/securing-exchange-2010-with-forefront-threat-management-gateway-tmg-2010-part-4-installing-forefront-threat-management-gateway&text=Here we are, Part 4 of the series. To recap what I have done thus far.. I&rsquo;ve installed the Exchange Server Edge role followed by Fo...&hashtags=" rel="noreferrer" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li>
            </ul>
        </div>
        
        <div class="tags">
            <ul>
                
            </ul>
        </div>
        
    </footer>
</article>

<article class="post" role="article" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="post-header">
        <ul>
            <li><time datetime="2010-05-25T13:39:00-05:00" itemprop="datePublished">25 May, 2010</time></li>
            
        </ul>
        <h2 itemprop="name headline"><a href="http://172.16.7.177:4000/2010/05/securing-exchange-2010-with-forefront-threat-management-gateway-tmg-2010-part-3-installing-forefront-protection-for-exchange-server">Securing Exchange 2010 with Forefront Threat Management Gateway (TMG) 2010, Part 3 - Installing Forefront Protection for Exchange Server</a></h2>
    </header>

    <div class="post-content">
        <p>Welcome to Part 3! In the pervious part of the series I looked at the process of preparing a Windows Server 2008 R2 server for installation. I then installed the Exchange Server Edge Transport Transport role.</p>
<p>In Part 3 of the series I&rsquo;ll install Forefront Protection 2010 for Exchange Server, the installation is fairly quick and painless so it should not take too long! I recommend checking out the minimum system requirements on <a href="http://technet.microsoft.com/en-au/library/cc482970.aspx" target="_blank">Microsoft TechNet</a>.</p>
<p>To get started, insert your Forefront Threat Management Gateway 2010 installation media and then select &ldquo;Install Microsoft Forefront Protection 2010 for Exchange Server.</p>
<p><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image3.png"><img style="display: block; margin-left: auto; margin-right: auto; border: 0pt none;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image_thumb2.png" border="0" alt="image" width="500" height="359" /></a></p>
<p>The first step is to read and accept the License Agreement and click &ldquo;Next&rdquo;. &ldquo;During the installation, it may be necessary to stop and start the following services..&rdquo; read and accept this message by clicking &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image6.png"><img class="aligncenter" style="display: inline; border: 0pt none;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image6_thumb.png" border="0" alt="image" width="500" height="406" /></a></p>
<p>Select the appropriate installation paths and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image13.png"><img class="aligncenter" style="display: inline; border: 0pt none;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image13_thumb.png" border="0" alt="image" width="500" height="404" /></a></p>
<p>Enter any proxy server information (if any) and click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image18.png"><img class="aligncenter" style="display: inline; border: 0pt none;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image18_thumb.png" border="0" alt="image" width="500" height="404" /></a></p>
<p>Decide if you would like to enable Antispam now or later, these settings can be changed again once installed. Click &ldquo;Next&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image221.png"><img class="aligncenter" style="display: inline; border: 0pt none;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image22_thumb1.png" border="0" alt="image" width="500" height="404" /></a></p>
<p>Decide if you would like to enable Microsoft Update and click &ldquo;Next&rdquo; *note: I have selected to not enable Microsoft Update at this time, depending on your environment, your selection may or may not be the same. It is always recommended to keep your servers up to date.</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image27.png"><img class="aligncenter" style="display: inline; border: 0pt none;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image27_thumb.png" border="0" alt="image" width="500" height="404" /></a></p>
<p>Would you like to join the &ldquo;Customer Experience Improvement Program?&rdquo; decide and then click &ldquo;Next&rdquo;. Once you have confirmed your settings and click &ldquo;Next&rdquo; to begin the installation</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image331.png"><img class="aligncenter" style="display: inline; border: 0pt none;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image33_thumb1.png" border="0" alt="image" width="500" height="406" /></a></p>
<p>Once the installation has completed successfully, click &ldquo;Finish&rdquo;</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image36.png"><img class="aligncenter" style="display: inline; border: 0pt none;" title="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image36_thumb.png" border="0" alt="image" width="500" height="404" /></a></p>
<p>To summarise, in this part of the series I installed Forefront Protection 2010 for Exchange Server on the same server that already has the Exchange Edge Transport role installed from Part 2.</p>
<p>In the next part of the series I&rsquo;ll install Forefront Threat Management Gateway 2010 on the same server.</p>


        
    </div>

    <footer class="post-footer">
        <div class="share">Share
            <ul class="social-networks">
                <li class="share-facebook"><a href="https://www.facebook.com/sharer.php?s=100&p[title]=Securing Exchange 2010 with Forefront Threat Management Gateway (TMG) 2010, Part 3 - Installing Forefront Protection for Exchange Server&p[summary]=Welcome to Part 3! In the pervious part of the series I looked at the process of preparing a Windows Server 2008 R2 server for installati...&p[url]=http://172.16.7.177:4000/2010/05/securing-exchange-2010-with-forefront-threat-management-gateway-tmg-2010-part-3-installing-forefront-protection-for-exchange-server" class="s_facebook" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#facebook-icon"></use></svg></a></a></li>
                <li class="share-twitter"><a href="http://twitter.com/share?url=http://172.16.7.177:4000/2010/05/securing-exchange-2010-with-forefront-threat-management-gateway-tmg-2010-part-3-installing-forefront-protection-for-exchange-server&text=Welcome to Part 3! In the pervious part of the series I looked at the process of preparing a Windows Server 2008 R2 server for installati...&hashtags=" rel="noreferrer" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li>
            </ul>
        </div>
        
        <div class="tags">
            <ul>
                
            </ul>
        </div>
        
    </footer>
</article>

<article class="post" role="article" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="post-header">
        <ul>
            <li><time datetime="2010-05-20T13:16:00-05:00" itemprop="datePublished">20 May, 2010</time></li>
            
        </ul>
        <h2 itemprop="name headline"><a href="http://172.16.7.177:4000/2010/05/securing-exchange-2010-with-forefront-threat-management-gateway-tmg-2010-part-2-installing-exchange-server-edge">Securing Exchange 2010 with Forefront Threat Management Gateway (TMG) 2010, Part 2 - Installing Exchange Server Edge</a></h2>
    </header>

    <div class="post-content">
        <p>In Part 1 of the series I talked about Forefront Threat Management Gateway (TMG) 2010 and how it allows administrators to consolidate their perimeter infrastructure into a single, secure point of entry for email and other messaging related services.</p>
<p>In this part of the series, it&rsquo;s time to start getting our hands dirty so to speak and start the installation process. Microsoft recommends the following installation order:</p>
<ol>
<li>Install Active Directory Lightweight Directory Services (AD LDS). </li>
<li>Install the Exchange Server Edge Transport Transport role. </li>
<li>Install Forefront Protection 2010 for Exchange Server. </li>
<li>Install TMG 2010 </li>
</ol>
<p>In Part 2, we will start by installing Exchange Server Edge. For more information, on the minimum system requirements, see <a href="http://technet.microsoft.com/en-us/library/dd896981.aspx" target="_blank">Microsoft TechNet</a></p>
<p>To get started, I have already installed Windows Server 2008 R2. </p>
<p><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image.png"><img style="border-right-width: 0px; display: block; float: none; border-top-width: 0px; border-bottom-width: 0px; margin-left: auto; border-left-width: 0px; margin-right: auto" title="image" border="0" alt="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image_thumb.png" width="504" height="167" /></a></p>
<p>It is important to ensure that you have a Primary DNS suffix set, to set this, </p>
<ol>
<li>Right-click My Computer, and then click Properties. The System Properties dialog box will appear. </li>
<li>Click the Computer Name tab. </li>
<li>Click Change. The Computer Name Changes dialog box will appear. </li>
<li>Click More. The DNS Suffix and NetBIOS Computer Name dialog box will appear. </li>
<li>Enter the appropriate DNS suffix for the domain. </li>
<li>Select the Change primary DNS suffix when domain membership changes check box. </li>
<li>Click OK to save the changes, and then click OK to exit the Computer Name Changes dialog box. </li>
<li>Click OK to close the System Properties dialog box, and then restart the computer for the change to take effect. </li>
</ol>
<p align="center"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image29.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image29_thumb.png" width="354" height="206" /></a>&#160;</p>
<p>The first step is to install Active Directory Lightweight Directory Services (AD LDS), I have elected to do this via the &ldquo;Add Roles Wizard&rdquo; in &ldquo;Server Manager&rdquo;. If you do not already have .NET Framework 3.5.1 installed, it will prompt you to install this feature as well.</p>
<p align="center"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image2.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image2_thumb.png" width="504" height="244" /></a>&#160;</p>
<p align="left"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image7.png"><img style="border-right-width: 0px; display: block; float: none; border-top-width: 0px; border-bottom-width: 0px; margin-left: auto; border-left-width: 0px; margin-right: auto" title="image" border="0" alt="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image7_thumb.png" width="504" height="131" /></a> </p>
<p align="left">Once this part of the installation has completed, it is time to install the Exchange Server Edge Transport Role. Once you launch Exchange Server 2010 setup, you can click Step 3 and choose your Exchange language option, I&rsquo;m going to be installing only languages on the DVD. Then click &ldquo;Step 4: Install Microsoft Exchange&rdquo;</p>
<p align="center"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image1.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image_thumb1.png" width="504" height="379" /></a> </p>
<p align="left">Read the introduction window of the setup wizard and click &ldquo;Next&rdquo;. Read and accept the License Agreement and click &ldquo;Next&rdquo; again. Make your selection on the &ldquo;Error Reporting&rdquo; window and Click &ldquo;Next&rdquo;. Select &ldquo;Custom Exchange Server Installation&rdquo; on the &ldquo;Installation Type&rdquo; window, verify the installation path and click &ldquo;Next&rdquo;</p>
<p align="center"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image17.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image17_thumb.png" width="504" height="437" /></a> </p>
<p align="left">On the &ldquo;Server Role Selection&rdquo; window, select &ldquo;Edge Transport Role&rdquo;</p>
<p align="center"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image22.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image22_thumb.png" width="504" height="439" /></a> </p>
<p align="left">Read about the &ldquo;Customer Experience Improvement Program&rdquo; and make your selection about joining. Then click &ldquo;Next&rdquo;&#160; Verify that all Readiness Checks are successful and click &ldquo;Install&rdquo; to proceed with the installation.</p>
<p align="center"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image33.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image33_thumb.png" width="504" height="438" /></a> </p>
<p>Once the installation process completes successfully, click &ldquo;Finish&rdquo;</p></p></p></p>
<p align="center"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/image38.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://www.cgoosen.com/wp-content/uploads/2010/05/image38_thumb.png" width="504" height="438" /></a></p>
<p align="left">To summarise, in this part of the series I prepared a Windows Server 2008 R2 server by firstly ensuring that it had a Primary DNS suffix set, and installed Active Directory Lightweight Directory Services (AD LDS) and .NET Framework 3.5.1. I then proceeded to install the Exchange Server Edge Transport Role.</p>
<p align="left">In Part 3 I&rsquo;ll install Forefront Protection 2010 for Exchange Server.</p>


        
    </div>

    <footer class="post-footer">
        <div class="share">Share
            <ul class="social-networks">
                <li class="share-facebook"><a href="https://www.facebook.com/sharer.php?s=100&p[title]=Securing Exchange 2010 with Forefront Threat Management Gateway (TMG) 2010, Part 2 - Installing Exchange Server Edge&p[summary]=In Part 1 of the series I talked about Forefront Threat Management Gateway (TMG) 2010 and how it allows administrators to consolidate the...&p[url]=http://172.16.7.177:4000/2010/05/securing-exchange-2010-with-forefront-threat-management-gateway-tmg-2010-part-2-installing-exchange-server-edge" class="s_facebook" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#facebook-icon"></use></svg></a></a></li>
                <li class="share-twitter"><a href="http://twitter.com/share?url=http://172.16.7.177:4000/2010/05/securing-exchange-2010-with-forefront-threat-management-gateway-tmg-2010-part-2-installing-exchange-server-edge&text=In Part 1 of the series I talked about Forefront Threat Management Gateway (TMG) 2010 and how it allows administrators to consolidate the...&hashtags=" rel="noreferrer" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li>
            </ul>
        </div>
        
        <div class="tags">
            <ul>
                
            </ul>
        </div>
        
    </footer>
</article>

<article class="post" role="article" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="post-header">
        <ul>
            <li><time datetime="2010-05-18T13:14:30-05:00" itemprop="datePublished">18 May, 2010</time></li>
            
        </ul>
        <h2 itemprop="name headline"><a href="http://172.16.7.177:4000/2010/05/securing-exchange-2010-with-forefront-threat-management-gateway-tmg-2010-part-1-the-introduction">Securing Exchange 2010 with Forefront Threat Management Gateway (TMG) 2010, Part 1 &ndash; The Introduction</a></h2>
    </header>

    <div class="post-content">
        <p>November 2009 was an exciting time.. not only did I turn another year older, but, Microsoft launched both Exchange Server 2010 and Forefront Threat Management Gateway (TMG) 2010. Both of these products were eagerly awaited and while the new features and great benefits of Exchange Server 2010 have already been (and will continue to be!) discussed, I am excited to talk about how TMG 2010 now allows administrators to consolidate their perimeter infrastructure into a single, secure point of entry for email and other messaging related services.</p>
<p>What is Forefront Threat Management Gateway (TMG) 2010? TMG is essentially the next generation of ISA server (we&rsquo;ve all come to know and love ISA 2006 since it&rsquo;s release in late 2006) but with a few fantastic changes. The first of these is that, as with Exchange Server, it is 64bit only. Other new features include URL Filtering, Web antivirus/anti-malware protection and many more.</p>
<p>I mentioned earlier in the introduction that TMG 2010 allows administrators to consolidate their perimeter infrastructure into a single, secure point of entry, this is done by combining with a couple of other great technologies. It is now possible to install Exchange Edge, Forefront Protection for Exchange Server (FPES) and TMG 2010 on the same server. Management of the Exchange Server Edge, FPES&#160; and TMG 2010 services are all integrated into the TMG Management console greatly reducing management complexity and overhead.</p>
<p>In this 6 part series, I&rsquo;ll go through the process of installing Exchange Server Edge, FPES and TMG 2010 on the same server. The series will consist of the following posts:</p>
<ul>
<li>Part 1 &ndash; The Introduction </li>
<li>Part 2 &ndash; Installing Exchange Server Edge </li>
<li>Part 3 &ndash; Installing Forefront Protection 2010 for Exchange Server </li>
<li>Part 4 &ndash; Installing Forefront Threat Management Gateway 2010 </li>
<li>Part 5 &ndash; Putting it all together </li>
<li>Part 6 &ndash; Publishing Outlook Web App </li>
</ul>
<p align="left">This series is intended to be a detailed &ldquo;how to&rdquo; so I&rsquo;ll make use of a lot of screen shots of each of the steps of the process. There are many areas (especially when configuring Exchange Server) where making use of the Powershell or Exchange Management Shell (EMS) may be quicker, but I have opted to use the MMC throughout.</p>
<p>Here is a brief overview of the environment I&rsquo;ll use throughout this series, the environment is my lab environment. Here is a high level diagram of the environment, I&rsquo;ll discuss each server in a little more detail below:</p>
<p align="center"><a href="http://www.cgoosen.com/wp-content/uploads/2010/05/lab.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="lab" border="0" alt="lab" src="http://www.cgoosen.com/wp-content/uploads/2010/05/lab_thumb.png" width="504" height="335" /></a> </p>
<p align="left"><strong>tltmg01.testlab.local:</strong> Windows 2008 R2 x64 with 2 NICS (Internal &amp; External) &ndash; This is the Forefront TMG 2010 server with Exchange Server 2010 Edge and Forefront Protection 2010 for Exchange Server installed.</p>
<p align="left"><strong>tlex01.testlab.local:</strong> Windows 2008 R2 x64 &ndash; This is the Exchange 2010 Hub Transport and Client Access server.</p>
<p align="left"><strong>tlex02.testlab.local:</strong> Windows 2008 R2 x64 &ndash; This is the Exchange 2010 Mailbox server</p>
<p align="left"><strong>tldc01.testlab.local:</strong> Windows 2008 x64 &ndash; This is a Domain Controller and Global Catalog. This server also acts as a DNS server and is the Enterprise Root Certificate Authority.</p>
<p align="left">Some things to look out for.. there are a few important things to look out for when deploying this solution for the first time, there are:</p>
<ul>
<li>
<div align="left"><strong>Time Sync</strong> &ndash; make sure the time on your Exchange servers and TMG/Exchange Edge is perfectly in sync</div>
</li>
<li>
<div align="left"><strong>DNS</strong> &ndash; Mis-configuring DNS is a very common mistake in ISA/TMG deployments. There are many schools of thought here, but regardless of which one you follow, it is important to note that DNS entries are not NIC specific so make sure you assign a DNS server to either the internal OR external NIC. Your TMG/Exchange Edge server must be able to resolve names internally either through DNS or host entries</div>
</li>
<li>
<div align="left"><strong>Workgroup</strong> &ndash; Since we will be installing Exchange Server Edge, our TMG server will NOT be a domain member. It is important to put sufficient thought into how you will configure authentication for both reverse and forward proxy since AD authentication will not work</div>
</li>
<li>
<div align="left"><strong>Primary DNS suffix</strong> &ndash; The TMG/Exchange Edge will need it&rsquo;s Primary DNS suffix manually set as it will not be a part of the domain</div>
</li>
</ul>


        
    </div>

    <footer class="post-footer">
        <div class="share">Share
            <ul class="social-networks">
                <li class="share-facebook"><a href="https://www.facebook.com/sharer.php?s=100&p[title]=Securing Exchange 2010 with Forefront Threat Management Gateway (TMG) 2010, Part 1 &ndash; The Introduction&p[summary]=November 2009 was an exciting time.. not only did I turn another year older, but, Microsoft launched both Exchange Server 2010 and Forefr...&p[url]=http://172.16.7.177:4000/2010/05/securing-exchange-2010-with-forefront-threat-management-gateway-tmg-2010-part-1-the-introduction" class="s_facebook" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#facebook-icon"></use></svg></a></a></li>
                <li class="share-twitter"><a href="http://twitter.com/share?url=http://172.16.7.177:4000/2010/05/securing-exchange-2010-with-forefront-threat-management-gateway-tmg-2010-part-1-the-introduction&text=November 2009 was an exciting time.. not only did I turn another year older, but, Microsoft launched both Exchange Server 2010 and Forefr...&hashtags=" rel="noreferrer" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li>
            </ul>
        </div>
        
        <div class="tags">
            <ul>
                
            </ul>
        </div>
        
    </footer>
</article>

<article class="post" role="article" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="post-header">
        <ul>
            <li><time datetime="2009-09-10T13:24:04-05:00" itemprop="datePublished">10 Sep, 2009</time></li>
            
        </ul>
        <h2 itemprop="name headline"><a href="http://172.16.7.177:4000/2009/09/tech-ed-2009-update-forefront-tmg">Tech-ed 2009 update: Forefront TMG</a></h2>
    </header>

    <div class="post-content">
        <p>Today I attended the SEC208 session with Jamie Sharp which really provided a great overview of Microsoft Forefront Threat Management Gateway (TMG). If you use and like ISA server, you&rsquo;ll love TMG.</p>
<p>Some of the great new things we can look forward to are web filtering, URL filtering and it also has built in Exchange Edge Server functionality which means if you have an Exchange Edge Server role deployed and also use ISA server, you can now consolidate these into a single server. Another cool thing is, like Exchange Server 2010, TMG will only be available in 64bit.</p>
<p>TMG is currently available as beta3, <a href="http://www.microsoft.com/DOWNLOADS/details.aspx?FamilyID=e05aecbc-d0eb-4e0f-a5db-8f236995bccd&amp;displaylang=en" target="_blank">click here to download it</a>. It is expected to be RTM towards the end of the year.</p>


        
    </div>

    <footer class="post-footer">
        <div class="share">Share
            <ul class="social-networks">
                <li class="share-facebook"><a href="https://www.facebook.com/sharer.php?s=100&p[title]=Tech-ed 2009 update: Forefront TMG&p[summary]=Today I attended the SEC208 session with Jamie Sharp which really provided a great overview of Microsoft Forefront Threat Management Gate...&p[url]=http://172.16.7.177:4000/2009/09/tech-ed-2009-update-forefront-tmg" class="s_facebook" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#facebook-icon"></use></svg></a></a></li>
                <li class="share-twitter"><a href="http://twitter.com/share?url=http://172.16.7.177:4000/2009/09/tech-ed-2009-update-forefront-tmg&text=Today I attended the SEC208 session with Jamie Sharp which really provided a great overview of Microsoft Forefront Threat Management Gate...&hashtags=" rel="noreferrer" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li>
            </ul>
        </div>
        
        <div class="tags">
            <ul>
                
            </ul>
        </div>
        
    </footer>
</article>

            </main>
        </div>

        <script src="http://172.16.7.177:4000/assets/js/jquery-1.12.2.min.js"></script>
<script src="http://172.16.7.177:4000/assets/js/backtotop.js"></script>
<script src="http://172.16.7.177:4000/assets/js/lunr.min.js"></script>
<script src="http://172.16.7.177:4000/assets/js/lunr-feed.js"></script>
<script src="http://172.16.7.177:4000/assets/js/jquery.fitvids.js"></script>
<script src="http://172.16.7.177:4000/assets/js/svg4everybody.min.js"></script>
<script src="http://172.16.7.177:4000/assets/js/scripts.js"></script>


    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-XXXXXXX-2', 'auto');
        ga('send', 'pageview');
    </script>

        <style>
.lightbox {width: 100%; height: 100%; position: fixed; top: 0; left: 0; background: rgba(0,0,0,0.85); z-index: 9999999; line-height: 0; cursor: pointer;}
.lightbox .img {
	position: relative; 
	top: 50%;
	left: 50%;
	-ms-transform: translateX(-50%) translateY(-50%);
	-webkit-transform: translate(-50%,-50%);
	transform: translate(-50%,-50%);
	max-width: 100%;
	max-height: 100%;
}
.lightbox .img img {opacity: 0; pointer-events: none; width: auto;}
@media screen and (min-width: 1200px) {
    .lightbox .img {
		max-width: 1200px;
    }
}
@media screen and (min-height: 1200px) {
    .lightbox img {
		max-height: 1200px;
	}
}
.lightbox span {display: block; position: fixed; bottom: 13px; height: 1.5em; line-height: 1.4em; width: 100%; text-align: center; color: white; text-shadow:
    -1px -1px 0 #000,
    1px -1px 0 #000,
    -1px 1px 0 #000,
    1px 1px 0 #000;  
}






.lightbox .videoWrapperContainer {
	position: relative; 
	top: 50%;
	left: 50%;
	-ms-transform: translateX(-50%) translateY(-50%);
	-webkit-transform: translate(-50%,-50%);
	transform: translate(-50%,-50%);
	max-width: 900px;
	max-height: 100%;
}
.lightbox .videoWrapperContainer .videoWrapper {
	height: 0;
	line-height: 0;
	margin: 0;
	padding: 0;
	position: relative;
	padding-bottom: 56.333%; /* custom */
	background: black;
} 
.lightbox .videoWrapper iframe {
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	border: 0;
	display: block;
}   
.lightbox #prev, .lightbox #next {height: 50px; line-height: 36px; display: none; margin-top: -25px; position: fixed; top: 50%; padding: 0 15px; cursor: pointer; text-decoration: none; z-index: 99; color: white; font-size: 60px;}
.lightbox.gallery #prev, .lightbox.gallery #next {display: block;}
.lightbox #prev {left: 0;}
.lightbox #next {right: 0;}
.lightbox #close {height: 50px; width: 50px; position: fixed; cursor: pointer; text-decoration: none; z-index: 99; right: 0; top: 0;}
.lightbox #close:after, .lightbox #close:before {position: absolute; margin-top: 22px; margin-left: 14px; content: ""; height: 3px; background: white; width: 23px;
-webkit-transform-origin: 50% 50%;
-moz-transform-origin: 50% 50%;
-o-transform-origin: 50% 50%;
transform-origin: 50% 50%;
/* Safari */
-webkit-transform: rotate(-45deg);
/* Firefox */
-moz-transform: rotate(-45deg);
/* IE */
-ms-transform: rotate(-45deg);
/* Opera */
-o-transform: rotate(-45deg);
}
.lightbox #close:after {
/* Safari */
-webkit-transform: rotate(45deg);
/* Firefox */
-moz-transform: rotate(45deg);
/* IE */
-ms-transform: rotate(45deg);
/* Opera */
-o-transform: rotate(45deg);
}
.lightbox, .lightbox * {
    -webkit-user-select: none;  
    -moz-user-select: none;    
    -ms-user-select: none;      
    user-select: none;
}
</style>
		
<script>
function is_youtubelink(url) {
  var p = /^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/;
  return (url.match(p)) ? RegExp.$1 : false;
}
function is_imagelink(url) {
	var p = /([a-z\-_0-9\/\:\.]*\.(jpg|jpeg|png|gif))/i;
	return (url.match(p)) ? true : false;
}
function is_vimeolink(url,el) {
	var id = false;
	$.ajax({
	  url: 'https://vimeo.com/api/oembed.json?url='+url,
	  async: true,
	  success: function(response) {
		if(response.video_id) {
		  id = response.video_id;
		  $(el).addClass('lightbox-vimeo').attr('data-id',id);
		}
	  }
	});
}

$(document).ready(function() {
	//add classes to links to be able to initiate lightboxes
	$("a").each(function(){
		var url = $(this).attr('href');
		if(url) {
			if(url.indexOf('vimeo') !== -1 && !$(this).hasClass('no-lightbox')) is_vimeolink(url,$(this));
			if(is_youtubelink(url) && !$(this).hasClass('no-lightbox')) $(this).addClass('lightbox-youtube').attr('data-id',is_youtubelink(url));
			if(is_imagelink(url) && !$(this).hasClass('no-lightbox')) {
				$(this).addClass('lightbox-image');
				var href = $(this).attr('href');
				var filename = href.split('/').pop();
				var split = filename.split(".");
				var name = split[0];
				$(this).attr('title',name);
			}
		}
	});
	//remove the clicked lightbox
	$("body").on("click", ".lightbox", function(event){
		if($(this).hasClass('gallery')) {
			$(this).remove();
			if($(event.target).attr('id')=='next') {
				//next item
				if($("a.gallery.current").nextAll("a.gallery:first").length) $("a.gallery.current").nextAll("a.gallery:first").click();
				else $("a.gallery.current").parent().find("a.gallery").first().click();
			}
			else if ($(event.target).attr('id')=='prev') {
				//prev item
				if($("a.gallery.current").prevAll("a.gallery:first").length) $("a.gallery.current").prevAll("a.gallery:first").click();
				else $("a.gallery.current").parent().find("a.gallery").last().click();
			}
			else {
				$("a.gallery").removeClass('gallery');
			}
		}
		else $(this).remove();
	});
	//prevent image from being draggable (for swipe)
	$("body").on('dragstart', ".lightbox img", function(event) { event.preventDefault(); });
	//add the youtube lightbox on click
	$("a.lightbox-youtube").click(function(event){
		event.preventDefault();
		$('<div class="lightbox"><a id="close"></a><a id="next">&rsaquo;</a><a id="prev">&lsaquo;</a><div class="videoWrapperContainer"><div class="videoWrapper"><iframe src="https://www.youtube.com/embed/'+$(this).attr('data-id')+'?autoplay=1&showinfo=0&rel=0"></iframe></div></div></div>').appendTo('body');
	});
	//add the image lightbox on click
	$("a.lightbox-image").click(function(event){
		event.preventDefault();
		$('<div class="lightbox"><a id="close"></a><a id="next">&rsaquo;</a><a id="prev">&lsaquo;</a><div class="img" style="background: url('+$(this).attr('href')+') center center / contain no-repeat;" title="'+$(this).attr('title')+'" ><img src="'+$(this).attr('href')+'" alt="'+$(this).attr('title')+'" /></div><span>'+$(this).attr('title')+'</span></div>').appendTo('body');
	});
	//add the vimeo lightbox on click
	$("body").on("click", "a.lightbox-vimeo", function(event){
		event.preventDefault();
		$('<div class="lightbox"><a id="close"></a><a id="next">&rsaquo;</a><a id="prev">&lsaquo;</a><div class="videoWrapperContainer"><div class="videoWrapper"><iframe src="https://player.vimeo.com/video/'+$(this).attr('data-id')+'/?autoplay=1&byline=0&title=0&portrait=0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div></div></div>').appendTo('body');
	});

	$("body").on("click", "a[class*='lightbox-']", function(){
		var link_elements = $(this).parent().find("a[class*='lightbox-']");
		$(link_elements).removeClass('current');
		for (var i=0; i<link_elements.length; i++) {
			if($(this).attr('href') == $(link_elements[i]).attr('href')) {
				$(link_elements[i]).addClass('current');
			}
		}
		if(link_elements.length>1) {
			$('.lightbox').addClass('gallery');
			$(link_elements).addClass('gallery');
		}
	});

	
});

$(document).keydown(function(e) {
    switch(e.which) {
        case 37: // left
        $("#prev").click();
        break;
        case 39: // right
        $("#next").click();
        break;
	case 27: // esc
        $("#close").click();
        break;
        default: return; // exit this handler for other keys
    }
    e.preventDefault(); // prevent the default action (scroll / move caret)
});

  /*===========================
  Swipe-it v1.4.1
  An event listener for swiping gestures with vanilla js.
  https://github.com/tri613/swipe-it#readme
 
  @Create 2016/09/22
  @Update 2017/08/11
  @Author Trina Lu
  ===========================*/
  "use strict";var _slicedToArray=function(){function n(n,t){var e=[],i=!0,o=!1,r=void 0;try{for(var u,c=n[Symbol.iterator]();!(i=(u=c.next()).done)&&(e.push(u.value),!t||e.length!==t);i=!0);}catch(n){o=!0,r=n}finally{try{!i&&c.return&&c.return()}finally{if(o)throw r}}return e}return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return n(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();!function(n,t,e){function i(n){function e(){o("touchstart",m,w),o("touchmove",d,w),o("touchend",p,w),E.mouseEvent&&o("mousedown",s,w)}function i(){y=!1,D=!1,A=!1,b=!1,a=!1}function s(n){a=this,y=n.clientX,D=n.clientY,o("mousemove",l,v),o("mouseup",h,v)}function l(n){n.preventDefault(),y&&D&&(A=n.clientX,b=n.clientY)}function h(n){r("mousemove",l,v),r("mouseup",h,v),p(n)}function m(n){a=this,y=n.touches[0].clientX,D=n.touches[0].clientY}function d(n){A=n.touches[0].clientX,b=n.touches[0].clientY}function p(n){if(y&&D&&A&&b){var t=y-A,e=D-b,o=[t,e].map(Math.abs),r=_slicedToArray(o,2),c=r[0],s=r[1],v=E.minDistance;if(c>v){var f=y<A?"swipeRight":"swipeLeft";u(f,a,{distance:t,start:y,end:A})}if(s>v){var l=D>b?"swipeUp":"swipeDown";u(l,a,{distance:e,start:D,end:b})}(c>v||s>v)&&u("swipe",a)}i()}var E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},w=c(t.querySelectorAll(n)),y=void 0,D=void 0,A=void 0,b=void 0;E.mouseEvent=void 0===E.mouseEvent?f.mouseEvent:E.mouseEvent,E.minDistance=void 0===E.minDistance?f.minDistance:E.minDistance,i(),e(),this.on=function(n,t){return o(n,t,w),this}}function o(n,t,e){s(e).forEach(function(e){return e.addEventListener(n,t)})}function r(n,t,e){s(e).forEach(function(e){return e.removeEventListener(n,t)})}function u(n,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=t.createEvent("Event");o.initEvent(n,!0,!0),o.swipe=i,s(e).forEach(function(n){return n.dispatchEvent(o)})}function c(n){for(var t=[],e=0;e<n.length;e++)t.push(n[e]);return t}function s(n){return Array.isArray(n)?n:[n]}var a=!1,v=[n],f={mouseEvent:!0,minDistance:30};n[e]=i}(window,document,"SwipeIt");

var mySwipeIt = new SwipeIt('body');
mySwipeIt.on('swipeLeft',function(e){
	//check if lightbox is present
	if($('.lightbox').length >  0 ) {
		$("#next").click();
	}
}).on('swipeRight',function(e){
	//check if lightbox is present
	if($('.lightbox').length >  0 ) {
		$("#prev").click();
	}
});
</script>

    </body>
</html>