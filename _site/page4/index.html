<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title> Chris&#39;s Blog &mdash; It&#39;s called thinking...  go with it! </title>
    <meta property="og:title" content=" Chris&#39;s Blog &mdash; It&#39;s called thinking...  go with it! " />
    <meta name="twitter:title" content=" Chris&#39;s Blog &mdash; It&#39;s called thinking...  go with it! " />

    <meta name="description" content="">
    <meta name="description" property="og:description" content="" />
    <meta name="twitter:description" content="" />

    <meta name="twitter:card" content="summary_large_image" />
    
    <meta name="twitter:site" content="@chrisgoosen" />
    
    <meta property="og:url" content="http://172.16.7.177:4000/page4/" />

    <meta property="og:image" content="" />
    <meta name="twitter:image" content="" />

    <meta name="author" content="Chris's Blog" />

    <meta name="copyright" content="Copyright by Chris's Blog. All Rights Reserved." />

    <style>
        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 300;
            src: local('Roboto Light'), local('Roboto-Light'), url(https://fonts.gstatic.com/s/roboto/v15/Hgo13k-tfSpn0qi1SFdUfVtXRa8TVwTICgirnJhmVJw.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 400;
            src: local('Roboto'), local('Roboto-Regular'), url(https://fonts.gstatic.com/s/roboto/v15/CWB0XYA8bzo0kSThX0UTuA.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 700;
            src: local('Roboto Bold'), local('Roboto-Bold'), url(https://fonts.gstatic.com/s/roboto/v15/d-6IYplOFocCacKzxwXSOFtXRa8TVwTICgirnJhmVJw.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 900;
            src: local('Roboto Black'), local('Roboto-Black'), url(https://fonts.gstatic.com/s/roboto/v15/mnpfi9pxYH-Go5UiibESIltXRa8TVwTICgirnJhmVJw.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 300;
            src: local('Roboto Light Italic'), local('Roboto-LightItalic'), url(https://fonts.gstatic.com/s/roboto/v15/7m8l7TlFO-S3VkhHuR0at44P5ICox8Kq3LLUNMylGO4.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 400;
            src: local('Roboto Italic'), local('Roboto-Italic'), url(https://fonts.gstatic.com/s/roboto/v15/vPcynSL0qHq_6dX7lKVByfesZW2xOQ-xsNqO47m55DA.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 700;
            src: local('Roboto Bold Italic'), local('Roboto-BoldItalic'), url(https://fonts.gstatic.com/s/roboto/v15/t6Nd4cfPRhZP44Q5QAjcC44P5ICox8Kq3LLUNMylGO4.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }

        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 900;
            src: local('Roboto Black Italic'), local('Roboto-BlackItalic'), url(https://fonts.gstatic.com/s/roboto/v15/bmC0pGMXrhphrZJmniIZpY4P5ICox8Kq3LLUNMylGO4.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
        }
    </style>
    
    <link href="/favicon.ico" rel="shortcut icon" type="image/x-icon" />
    
    <link rel="stylesheet" href="http://172.16.7.177:4000/assets/css/main.css">

    <link rel="canonical" href="http://172.16.7.177:4000/page4/">

    <link rel="alternate" type="application/rss+xml" title="" href="http://172.16.7.177:4000/feed.xml">
</head>

    <body>
        <div class="wrapper">
            <aside class="user-profile fixed" role="complementary">
    <div class="burger">
        <input class="trigger hidden" id="toggleBurger" type="checkbox" />
        <label for="toggleBurger">
            <span>Navigation</span>
        </label>
    </div>

    <div class="compact-header">
        <a class="avatar" href="http://172.16.7.177:4000"><img alt="Avatar" src="/assets/img/headshot.jpg" /></a>
        <div class="my-info">
            <strong class="my-name">Chris's Blog</strong>
            <span class="my-job-title">It's called thinking...  go with it!</span>
        </div>
    </div>

    
        
        <div class="mainmenu">
            <a href="http://172.16.7.177:4000" >Home</a>
            
                
            
                
            
                
                    <a href="http://172.16.7.177:4000/contact/" >Contact</a>
                
            
                
                    <a href="http://172.16.7.177:4000/about/" >About</a>
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
        </div>
        
    
    
    <div>
    	<img src="/assets/img/mvp.png" style="width:181px;height:74px;">
    </div>

    <p class="about-me"> </p>
    
    <ul class="socials">
        <li><a href="https://twitter.com/chrisgoosen" target="_blank"><svg title="twitter" width="16" height="16" ><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li><li><a href="https://www.linkedin.com/in/ctgoosen/" target="_blank"><svg title="linkedin" width="16" height="16" ><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#linkedin-icon"></use></svg></a></li><li><a href="https://github.com/cgoosen" target="_blank"><svg title="github" width="16" height="16" ><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#github-icon"></use></svg></a></li>

        
            <li><a href="/contact" target="_blank"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#email-icon"></use></svg></a></li>
        

        
         <li><a href="http://feeds.cgoosen.com/cgoosen"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#rss-icon"></use></svg></a></li>
        
    </ul>
</aside>


            <main class="the-content" role="main">
                <div class="search" role="search">
    <div>
        <div class="show-results-count">0 Results</div>
        <div class="search-holder">
            <input type="text" id="search-input" placeholder="search for..." />
        </div>
    </div>
    <ul id="results-container" class="results-container"></ul>
</div>


                
<article class="post" role="article" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="post-header">
        <ul>
            <li><time datetime="2017-02-28T12:54:52-06:00" itemprop="datePublished">28 Feb, 2017</time></li>
            
        </ul>
        <h2 itemprop="name headline"><a href="http://172.16.7.177:4000/2017/02/single-sign-on-with-azure-ad-connect">Single Sign On with Azure AD Connect</a></h2>
    </header>

    <div class="post-content">
        <p>Ever since the launch of Office 365 (and BPOS before that) there has been a desire to make accessing these services as seamless as possible. Single Sign On (SSO) has long been high on the requirements list for many organizations and while it has been possible for some time now to provide a near seamless login experience, it has historically come at a cost in the form of additional infrastructure - usually deployed on-premises and at the very least carrying some sort of administrative burden. I&rsquo;m not against identity federation, I think it definitely has it&rsquo;s place and most of the customers I work with already have some federation solution deployed so it makes a lot of sense leveraging it for Office 365 as well, but there are always those organizations who don&rsquo;t already have a solution in place or those smaller environments where it doesn&rsquo;t make a whole lot of sense to implement a highly-available AD FS deployment.</p>
<p>Password Sync has long been the best compromise, offering a &ldquo;Same Sign On&rdquo; experience where users are able to use their existing AD credentials to access Office 365 services. The <a href="https://blogs.technet.microsoft.com/enterprisemobility/2016/12/07/introducing-azuread-pass-through-authentication-and-seamless-single-sign-on/" target="_blank">recent announcement of Pass-Through Authentication and Single Sign-on</a> means that things are about to get a whole lot better!</p>
<p>I wanted to put together a quick post and run through how easy it is to setup Single Sign On and review the user experience when it is used with Password Sync. Single Sign On can also be enabled with the new Pass-through authentication option, but that&rsquo;s a story for another post!</p>
<p>Before getting started, it is important to understand the client requirements. The client should:</p>
<ul>
<li>be using a domain-joined machine
<li>be using Windows and a supported browser (Edge is <u>not</u> supported)
<li>have direct access to a domain controller
<li>have the Kerberos end-points defined in the browser&rsquo;s Intranet zone (AD Group Policy is the easiest way to do this)
<ul>
<li>https://autologon.microsoftazuread-sso.com
<li>https://aadg.windows.net.nsatc.net</li>
</ul>
</li>
</ul>
<p align="center"><a href="http://www.cgoosen.com/wp-content/uploads/2017/02/a.png"><img title="a" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="a" src="http://www.cgoosen.com/wp-content/uploads/2017/02/a_thumb.png" width="344" height="308"></a></p>
<p align="left">Once the client requirements have been taken care of, we need to update AAD Connect. At the time of writing, version 1.1.380.0 is the latest version. It looks like these new features were introduced in version 1.1.370.0. If we compare the the &ldquo;User sign-in&rdquo; page to that of an older build you&rsquo;ll notice the addition of a few more features:</p>
<p align="center"><a href="http://www.cgoosen.com/wp-content/uploads/2017/02/2a.png"><img title="2a" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="2a" src="http://www.cgoosen.com/wp-content/uploads/2017/02/2a_thumb.png" width="400" height="282"></a>&nbsp;<a href="http://www.cgoosen.com/wp-content/uploads/2017/02/7.png"><img title="7" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="7" src="http://www.cgoosen.com/wp-content/uploads/2017/02/7_thumb.png" width="400" height="282"></a></p>
<p>To upgrade AAD Connect, follow your regular upgrade procedure. If you don&rsquo;t have any customizations or special considerations, you can just let the wizard perform the upgrade for you:</p>
<p align="center"><a href="http://www.cgoosen.com/wp-content/uploads/2017/02/3.png"><img title="3" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="3" src="http://www.cgoosen.com/wp-content/uploads/2017/02/3_thumb.png" width="400" height="282"></a></p>
<p align="left">Once upgraded, you&rsquo;ll want to run the configuration wizard again and tick the &ldquo;Enable single sign on&rdquo; checkbox on the &ldquo;User sign-in&rdquo; page (shown above) and that is all there is to it!</p>
<p align="left">Let&rsquo;s compare the user experience before and after enabling Single Sign On. Here is the user experience before:</p>
<p align="center"><iframe height="482" src="https://player.vimeo.com/video/206158120" frameborder="0" width="640" allowfullscreen mozallowfullscreen webkitallowfullscreen></iframe></p>
<p align="left">and here is the user experience after implementing Single Sign On with AAD Connect (you&rsquo;ll notice that I do not have to re-enter my password this time):</p>
<p align="center"><iframe height="482" src="https://player.vimeo.com/video/206158265" frameborder="0" width="640" allowfullscreen mozallowfullscreen webkitallowfullscreen></iframe></p>
<p align="left">Note: In the demo videos, I have my home page set in a way that forces my custom branding before any user credentials are entered. You can do this by either creating a web redirect or setting your home page to: <a href="https://login.microsoftonline.com/login.srf?whr=your_domain.com">https://login.microsoftonline.com/login.srf?whr=your_domain.com</a> (replace your_domain.com with your actual domain name!)</p>
<p align="left">There is a lot of great documentation available about Single Sign On on the Microsoft website, I highly recommend that you check it out as well:</p>
<ul>
<li>
<div align="left"><a href="https://docs.microsoft.com/en-us/azure/active-directory/connect/active-directory-aadconnect-sso" target="_blank">What is Single Sign On (SSO)</a></div>
</li>
<li>
<div align="left"><a href="https://docs.microsoft.com/en-us/azure/active-directory/connect/active-directory-aadconnect-version-history" target="_blank">Azure AD Connect: Version release history</a></div>
</li>
</ul>


        
    </div>

    <footer class="post-footer">
        <div class="share">Share
            <ul class="social-networks">
                <li class="share-facebook"><a href="https://www.facebook.com/sharer.php?s=100&p[title]=Single Sign On with Azure AD Connect&p[summary]=Ever since the launch of Office 365 (and BPOS before that) there has been a desire to make accessing these services as seamless as possib...&p[url]=http://172.16.7.177:4000/2017/02/single-sign-on-with-azure-ad-connect" class="s_facebook" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#facebook-icon"></use></svg></a></a></li>
                <li class="share-twitter"><a href="http://twitter.com/share?url=http://172.16.7.177:4000/2017/02/single-sign-on-with-azure-ad-connect&text=Ever since the launch of Office 365 (and BPOS before that) there has been a desire to make accessing these services as seamless as possib...&hashtags=" rel="noreferrer" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li>
            </ul>
        </div>
        
        <div class="tags">
            <ul>
                
            </ul>
        </div>
        
    </footer>
</article>

<article class="post" role="article" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="post-header">
        <ul>
            <li><time datetime="2017-02-07T11:06:14-06:00" itemprop="datePublished">7 Feb, 2017</time></li>
            
        </ul>
        <h2 itemprop="name headline"><a href="http://172.16.7.177:4000/2017/02/configuring-session-timeouts-for-outlook-on-the-web-owa-in-exchange-online">Configuring session timeouts for Outlook on the Web (OWA) in Exchange Online</a></h2>
    </header>

    <div class="post-content">
        <p>In today&rsquo;s browser first, cloud first world, many organizations look at reducing risk by imposing strict session timeout settings on their productivity tools and applications. The idea generally is that if a user is not actively using and application for 10 &ndash;15 mins, they have completed the task they were working on and have forgotten to logoff correctly. This can be especially dangerous when these applications are accessed on shared terminals or public computers. Given that email remains a vitally important business tool for many organizations, reducing the session timeout on Exchange Online (and Exchange 2016) is a fairly common request and it is really simple to do.</p>
<p>By default, session timeout is enabled for OWA (let&rsquo;s just call it that, shall we?) and it set to 6 hours. You can confirm this configuration via PowerShell using the Get-OrganizationConfig cmdlet:</p>
<p>[powershell]Get-OrganizationConfig | FL ActivityBasedAuthenticationTimeout*[/powershell]</p>
<p><a href="http://www.cgoosen.com/wp-content/uploads/2017/01/cap1.png"><img class="aligncenter size-medium wp-image-2456" src="http://www.cgoosen.com/wp-content/uploads/2017/01/cap1-300x65.png" alt="" width="300" height="65" /></a></p>
<p>There are two parameters in particular worth paying attention to:</p>
<ul>
<li>ActivityBasedAuthenticationTimeoutEnabled</li>
<li>ActivityBasedAuthenticationTimeoutInterval</li>
</ul>
<p><em>ActivityBasedAuthenticationTimeoutEnabled </em>is pretty self-explanatory, you will want to keep it enabled if you intended to set the timeout interval. The&nbsp;<em>ActivityBasedAuthenticationTimeoutInterval </em>parameter&nbsp;controls the actual timeout interval in&nbsp;<em>hh</em>:<em>mm</em>:<em>ss</em>&nbsp;format where&nbsp;<em>hh</em>&nbsp;= hours,&nbsp;<em>mm</em>&nbsp;= minutes and&nbsp;<em>ss</em>&nbsp;= seconds. Note that this parameter has a range of 5 min - 8 hrs. Changes can be made using the Set-OrganizationConfig cmdlet, for example to set the timeout interval to 15 mins we'd issue the following cmd:</p>
<p>[powershell]Set-OrganizationConfig -ActivityBasedAuthenticationTimeoutInterval 00:15:00[/powershell]</p>
<p><a href="http://www.cgoosen.com/wp-content/uploads/2017/02/cap2.png"><img class="aligncenter size-medium wp-image-2480" src="http://www.cgoosen.com/wp-content/uploads/2017/02/cap2-300x50.png" alt="" width="300" height="50" /></a></p>
<p>During my testing, it took a really long time (12+ hrs) for this to take effect so don't be alarmed if it doesn't work right away.</p>
<p>For more information on the <a href="https://technet.microsoft.com/en-us/library/aa997443(v=exchg.160).aspx" target="_blank">Set-OrganizationConfig parameters, see TechNet</a>.</p>


        
    </div>

    <footer class="post-footer">
        <div class="share">Share
            <ul class="social-networks">
                <li class="share-facebook"><a href="https://www.facebook.com/sharer.php?s=100&p[title]=Configuring session timeouts for Outlook on the Web (OWA) in Exchange Online&p[summary]=In today&rsquo;s browser first, cloud first world, many organizations look at reducing risk by imposing strict session timeout settings o...&p[url]=http://172.16.7.177:4000/2017/02/configuring-session-timeouts-for-outlook-on-the-web-owa-in-exchange-online" class="s_facebook" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#facebook-icon"></use></svg></a></a></li>
                <li class="share-twitter"><a href="http://twitter.com/share?url=http://172.16.7.177:4000/2017/02/configuring-session-timeouts-for-outlook-on-the-web-owa-in-exchange-online&text=In today&rsquo;s browser first, cloud first world, many organizations look at reducing risk by imposing strict session timeout settings o...&hashtags=" rel="noreferrer" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li>
            </ul>
        </div>
        
        <div class="tags">
            <ul>
                
            </ul>
        </div>
        
    </footer>
</article>

<article class="post" role="article" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="post-header">
        <ul>
            <li><time datetime="2016-11-30T12:00:03-06:00" itemprop="datePublished">30 Nov, 2016</time></li>
            
        </ul>
        <h2 itemprop="name headline"><a href="http://172.16.7.177:4000/2016/11/getting-started-with-aad-conditional-access-location-based-access-rules">Getting started with AAD conditional access - Location based access rules</a></h2>
    </header>

    <div class="post-content">
        <p>Azure Active Directory (AAD) conditional access is something I&rsquo;ve been wanting to post about for a while now. A scenario I come across fairly often is the desire to prevent access or add an additional layer of security to certain Office 365 workloads when the user is connecting from a remote, non-corporate location. In the past, this could be achieved by making use of claims rules and Active Directory Federation Services (AD FS) which meant that it wasn&rsquo;t possible for those organizations not making use of federated identities with Office 365.</p>
<p>AAD conditional access solves this problem and makes it really simple to apply access policies to AAD connected applications. Conditional access does require an AAD premium license (P1). In this post we&rsquo;ll cover a simple location based scenario where we prevent users from accessing Outlook on the web (OWA) from outside of the organization&rsquo;s network. In order to configure conditional access you will require:</p>
<ul>
<ul>
<li>Azure Active Directory premium licensing</li>
<li>Access to the Azure management portal (classic portal)</li>
</ul>
</ul>
<p>Conditional access policies are configured via the classic Azure management portal (http://manage.windowsazure.com). Locate &ldquo;Active Directory&rdquo; on the left-hand side, select your Office 365 directory and click the &ldquo;Applications&rdquo; option.</p>
<p><a href="http://www.cgoosen.com/wp-content/uploads/2016/12/Screen-Shot-2016-11-30-at-3.10.34-PM.png"><img class="aligncenter size-medium wp-image-2170" src="http://www.cgoosen.com/wp-content/uploads/2016/12/Screen-Shot-2016-11-30-at-3.10.34-PM-300x178.png" alt="screen-shot-2016-11-30-at-3-10-34-pm" width="300" height="178" /></a></p>
<p>Next, select the &ldquo;Office 365 Exchange Online&rdquo; application and turn access rules &ldquo;On&rdquo; under the &ldquo;Multi-factor authentication and location based access rules&rdquo; section. You have the option of applying your rules to all users or select groups. You then select the &ldquo;Block access when not at work&rdquo; option. You also have to option to enforce MFA for an application which is useful if you would like to enable MFA only for specific applications or you could require MFA only when users are accessing the application from outside the corporate network.</p>
<p><a href="http://www.cgoosen.com/wp-content/uploads/2016/12/Screen-Shot-2016-11-30-at-3.19.39-PM.png"><img class="aligncenter size-medium wp-image-2171" src="http://www.cgoosen.com/wp-content/uploads/2016/12/Screen-Shot-2016-11-30-at-3.19.39-PM-300x284.png" alt="screen-shot-2016-11-30-at-3-19-39-pm" width="300" height="284" /></a></p>
<p>It is important to ensure that you define your corporate network ranges by clicking link. All connections from locations outside the definted network ranges will be treated as remote.</p>
<p><a href="http://www.cgoosen.com/wp-content/uploads/2016/12/Screen-Shot-2016-11-30-at-3.16.18-PM.png"><img class="aligncenter size-medium wp-image-2172" src="http://www.cgoosen.com/wp-content/uploads/2016/12/Screen-Shot-2016-11-30-at-3.16.18-PM-276x300.png" alt="screen-shot-2016-11-30-at-3-16-18-pm" width="276" height="300" /></a>Once configured, you will notice that users are still able to access the Office 365 portal however, once they click the mail option in the app launcher they will no longer be able to access Outlook on the web unless they are connecting from a approved location.</p>
<p><a href="http://www.cgoosen.com/wp-content/uploads/2016/12/Screen-Shot-2016-11-30-at-3.22.49-PM-1.png"><img class="aligncenter size-medium wp-image-2173" src="http://www.cgoosen.com/wp-content/uploads/2016/12/Screen-Shot-2016-11-30-at-3.22.49-PM-1-300x156.png" alt="screen-shot-2016-11-30-at-3-22-49-pm" width="300" height="156" /></a></p>
<p><a href="http://www.cgoosen.com/wp-content/uploads/2016/12/Screen-Shot-2016-11-30-at-3.23.23-PM.png"><img class="aligncenter size-medium wp-image-2174" src="http://www.cgoosen.com/wp-content/uploads/2016/12/Screen-Shot-2016-11-30-at-3.23.23-PM-300x184.png" alt="screen-shot-2016-11-30-at-3-23-23-pm" width="300" height="184" /></a></p>
<p>This is a very simple example of how to use location based access rules. It is also possible to configure device based access policies which provide an incredible amount of control over which devices can access your applications. I&rsquo;ll cover device based access policies in a future post.</p>
<p>&nbsp;</p>


        
    </div>

    <footer class="post-footer">
        <div class="share">Share
            <ul class="social-networks">
                <li class="share-facebook"><a href="https://www.facebook.com/sharer.php?s=100&p[title]=Getting started with AAD conditional access - Location based access rules&p[summary]=Azure Active Directory (AAD) conditional access is something I&rsquo;ve been wanting to post about for a while now. A scenario I come acr...&p[url]=http://172.16.7.177:4000/2016/11/getting-started-with-aad-conditional-access-location-based-access-rules" class="s_facebook" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#facebook-icon"></use></svg></a></a></li>
                <li class="share-twitter"><a href="http://twitter.com/share?url=http://172.16.7.177:4000/2016/11/getting-started-with-aad-conditional-access-location-based-access-rules&text=Azure Active Directory (AAD) conditional access is something I&rsquo;ve been wanting to post about for a while now. A scenario I come acr...&hashtags=" rel="noreferrer" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li>
            </ul>
        </div>
        
        <div class="tags">
            <ul>
                
            </ul>
        </div>
        
    </footer>
</article>

<article class="post" role="article" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="post-header">
        <ul>
            <li><time datetime="2016-09-25T14:30:58-05:00" itemprop="datePublished">25 Sep, 2016</time></li>
            
        </ul>
        <h2 itemprop="name headline"><a href="http://172.16.7.177:4000/2016/09/welcome-to-ignite-2016">Welcome to Ignite 2016!</a></h2>
    </header>

    <div class="post-content">
        <p>It&rsquo;s here! We&rsquo;ve all had to wait a little longer than usual for our yearly conference fix since Ignite in May last year, but the wait is finally over and here I am on the eve of Ignite 2016 in my hotel room in Atlanta. There are so many great speakers this year so I wanted to put together a short post listing some of them and highlighting some of the great Office 365 and Exchange sessions that I am personally looking forward to attending.</p>
<p>Monday:</p>
<ul>
<li>Take control of your security and compliance with Office 365 (THR1003) - Caroline Shin: 12:30pm - 12:50pm, Microsoft Theater 4</li>
<li>Design global voice deployments with Skype for Business (THR3057) - St&aring;le Hansen: 1:30pm - 1:50pm, MVP Hub Talk 1</li>
<li>Learn how Microsoft IT governs SharePoint Online and Office 365 Groups (THR2031) - David Johnson: 5:40pm - 6:00pm, Microsoft Theater 4</li>
</ul>
<p>Tuesday:</p>
<ul>
<li>Debate the top 10 reasons not to move your Exchange on-premises mailboxes to Exchange Online (BRK2215) - Greg Taylor, Tony Redmond, Steve Conn: 9:00am - 10:15am, B401 &ndash; B402</li>
<li>Experience Scott Schnoll's Exchange tips and tricks (BRK3253) - Scott Schnoll: 10:45am - 12:00pm, B401 &ndash; B402</li>
<li>Meet twin sons of different mothers - Exchange Engineers and Exchange MVPs (BRK2219) - Tony Redmond, Jeff Mealiffe, Andrew Higginbotham, Jeff Guillet, Karim Batthish :12:30pm - 1:45pm, C112</li>
<li>Unplug with the experts on Exchange Server and Exchange Online (BRK2216) - Wendy Wilkes, Greg Taylor, Ross Smith IV, Jeff Mealiffe, Timothy Heeney: 2:15pm - 3:30pm, B401 &ndash; B402</li>
<li>Access intelligence in the Microsoft Graph and API (BRK3199) - Jon Meling, Andreas Eide: 4:00pm - 5:15pm, A311 &ndash; A312</li>
</ul>
<p>Wednesday:</p>
<ul>
<li>Run Microsoft Exchange Hybrid for the long haul (BRK3217) - Timothy Heeney, Nicolas Blank: 9:00am - 10:15am, Georgia Ballroom</li>
<li>Prepare for the future with Windows 10 &amp; Office 365 - better together (THR3061) - Raphael K&ouml;llner: 10:20am - 10:40am, Expo Theater 2</li>
<li>Explore the ultimate field guide to Microsoft Office 365 Groups (BRK3001) - Tony Redmond, Benjamin Niaulin, Amit Gupta: 10:45am - 12:00pm, Georgia Ballroom</li>
<li>Understand the Microsoft Exchange Server 2016 Architecture (BRK3221) - Ross Smith IV, Mike Cooper: 12:30pm - 1:45pm, Georgia Ballroom</li>
<li>Migrate to Exchange Online via Exchange Hybrid (BRK3219) - Michael Van Horenbeeck, Timothy Heeney - 2:15pm - 3:30pm, Thomas Murphy Ballroom 2&amp;3</li>
<li>Design your Exchange infrastructure right (or consider moving to Office 365) (BRK2093) - Adrian Moore, Boris Lokhvitsky, Robert Gillies: 4:00pm - 5:15pm, B312 &ndash; B314</li>
</ul>
<p>Thursday:</p>
<ul>
<li>Deploy Microsoft Exchange Server 2016 (BRK3220) - Jeff Guillet: 9:00am - 10:15am, Sidney Marcus Auditorium</li>
<li>Unplug with the experts on Microsoft Exchange Top Issues (BRK3000) - Nino Bilic, Nasir Ali, Amir Haque, Shawn McGrath, Timothy Heeney, Scott Landry, Gabe Bratton, Angela Taylor: 10:45am - 12:00pm, B401 &ndash; B402</li>
<li>Investigate tools and techniques for Exchange Performance Troubleshooting (BRK3007) - Jeff Mealiffe, Nasir Ali: 12:30pm - 1:45pm, Georgia Ballroom</li>
<li>Automate Exchange deployment with Powershell Desired State Configuration (THR3040) - Ingo Gegenwarth: 2:10pm - 2:30pm, Expo Theater 2</li>
<li>Deploy Microsoft Office 365 Client using Configuration Manager (BRK3002) - Amesh Mansukhani, Doug Davis: 4:30pm - 5:15pm, B211 &ndash; B212</li>
</ul>
<p>There is so much great content this year that conflicts are inevitable. Many sessions are repeated throughout the conference, especially on Friday so be sure to look at the alternate times if you are torn between two sessions that are scheduled at the same time.</p>
<p>Outside of the content, there are a bunch of activities taking place this year. <a href="https://enowsoftware.com/" target="_blank">ENow Software</a> will once again host one of their legendary <a href="http://schedulemymaintenance.com/" target="_blank">&ldquo;Scheduled Maintenance&rdquo; parties</a>,&nbsp; these are usually one of the must-attend events of any conference but are for registered guests only so hopefully you have already registered. <a href="http://www.quadrotech-it.com/" target="_blank">QUADROtech</a> has put an interesting spin on the Pokemon Go craze with their &ldquo;QTmon&rdquo; competition where contestants have the chance to win $2,220 in cash. Tony Redmond has a great <a href="https://thoughtsofanidlemind.com/2016/09/22/qtmon-game-microsoft-ignite/" target="_blank">post about this on his blog here</a>, you can also <a href="http://www.quadrotech-it.com/qtmon/" target="_blank">visit this QUADROtech page for more info</a>.</p>
<p>Enjoy the week!</p>


        
    </div>

    <footer class="post-footer">
        <div class="share">Share
            <ul class="social-networks">
                <li class="share-facebook"><a href="https://www.facebook.com/sharer.php?s=100&p[title]=Welcome to Ignite 2016!&p[summary]=It&rsquo;s here! We&rsquo;ve all had to wait a little longer than usual for our yearly conference fix since Ignite in May last year, but ...&p[url]=http://172.16.7.177:4000/2016/09/welcome-to-ignite-2016" class="s_facebook" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#facebook-icon"></use></svg></a></a></li>
                <li class="share-twitter"><a href="http://twitter.com/share?url=http://172.16.7.177:4000/2016/09/welcome-to-ignite-2016&text=It&rsquo;s here! We&rsquo;ve all had to wait a little longer than usual for our yearly conference fix since Ignite in May last year, but ...&hashtags=" rel="noreferrer" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li>
            </ul>
        </div>
        
        <div class="tags">
            <ul>
                
            </ul>
        </div>
        
    </footer>
</article>

<article class="post" role="article" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="post-header">
        <ul>
            <li><time datetime="2016-08-30T14:20:34-05:00" itemprop="datePublished">30 Aug, 2016</time></li>
            
        </ul>
        <h2 itemprop="name headline"><a href="http://172.16.7.177:4000/2016/08/disabling-modern-attachments-in-outlook-2016">Disabling Modern Attachments in Outlook 2016</a></h2>
    </header>

    <div class="post-content">
        <p>The modern attachments (aka cloudy attachments) feature in Outlook 2016 makes it simple for users to share documents stored in OneDrive for Business or SharePoint with each other as links instead of actually attaching the file and emailing it around. This is a great way to reduce the number of different document versions floating around the organization and helps promote collaboration and co-authoring. Once a cloudy attachment is attached to an email, the user can grant view only or edit permissions to the recipient and Exchange will automatically take care of applying the appropriate permission to the document.</p>
<p align="center"><a href="http://www.cgoosen.com/wp-content/uploads/2016/08/blog1.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-width: 0px;" title="blog1" src="http://www.cgoosen.com/wp-content/uploads/2016/08/blog1_thumb.png" alt="blog1" width="249" height="206" border="0" /></a></p>
<p align="left">This feature is available out of the box for Exchange Online users using Outlook 2016 and can be enabled for on-premises users with mailboxes on Exchange 2016 provided OAuth between Exchange 2016 and Office 365 has been <a href="https://technet.microsoft.com/EN-US/library/mt589761%28v=exchg.150%29.aspx" target="_blank" rel="noopener noreferrer">configured properly and the appropriate prerequisites are in place</a>, but what happens to on-premises customers who do not have Exchange 2016 deployed? The scenario is really interesting in that Outlook will still allow users to send cloudy attachments, but because the backend Exchange environment isn&rsquo;t able to apply the appropriate permission to the document the recipient will be unable to view the attachment:</p>
<p align="center"><a href="http://www.cgoosen.com/wp-content/uploads/2016/08/bog2.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-width: 0px;" title="bog2" src="http://www.cgoosen.com/wp-content/uploads/2016/08/bog2_thumb.png" alt="bog2" width="413" height="234" border="0" /></a></p>
<p align="left">This behavior may confuse users and may not be desirable in some environments and while there is no way to specifically disable modern attachments, there is a workaround that may help achieve similar results. There are two options in Outlook that enable modern attachments:</p>
<ul>
<li>The &ldquo;Browse Web Locations&rdquo; option allows users to select files from OneDrive for Business, SharePoint sites or Groups.</li>
<li>The &ldquo;Recent items&rdquo; list provides a list of recently saved documents and when these documents are saved to OneDrive for Business or SharePoint it will automatically provide the option to attach a cloudy attachment version of the document.</li>
</ul>
<p>Disabling these two options in Outlook will effectively prevent users from being able to send cloudy attachments and change the user experience from this:</p>
<p align="center"><a href="http://www.cgoosen.com/wp-content/uploads/2016/08/default.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-width: 0px;" title="default" src="http://www.cgoosen.com/wp-content/uploads/2016/08/default_thumb.png" alt="default" width="455" height="127" border="0" /></a></p>
<p align="left">To this:</p>
<p align="center"><a href="http://www.cgoosen.com/wp-content/uploads/2016/08/after.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-width: 0px;" title="after" src="http://www.cgoosen.com/wp-content/uploads/2016/08/after_thumb.png" alt="after" width="366" height="122" border="0" /></a></p>
<p align="left">In order to do this, the following registry keys need to be added to the client machine for each user:</p>
<p style="text-align: center;"><a href="https://www.cgoosen.com/wp-content/uploads/2016/08/Screen-Shot-2017-08-21-at-11.43.08-AM.png"><img class="aligncenter size-full wp-image-2963" src="https://www.cgoosen.com/wp-content/uploads/2016/08/Screen-Shot-2017-08-21-at-11.43.08-AM.png" alt="" width="646" height="76" /></a></p>
<p>To simplify this, you can <a href="http://www.cgoosen.com/downloads/DisableModernAttachments.zip" target="_blank" rel="noopener noreferrer">download the registry keys here</a></p>


        
    </div>

    <footer class="post-footer">
        <div class="share">Share
            <ul class="social-networks">
                <li class="share-facebook"><a href="https://www.facebook.com/sharer.php?s=100&p[title]=Disabling Modern Attachments in Outlook 2016&p[summary]=The modern attachments (aka cloudy attachments) feature in Outlook 2016 makes it simple for users to share documents stored in OneDrive f...&p[url]=http://172.16.7.177:4000/2016/08/disabling-modern-attachments-in-outlook-2016" class="s_facebook" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#facebook-icon"></use></svg></a></a></li>
                <li class="share-twitter"><a href="http://twitter.com/share?url=http://172.16.7.177:4000/2016/08/disabling-modern-attachments-in-outlook-2016&text=The modern attachments (aka cloudy attachments) feature in Outlook 2016 makes it simple for users to share documents stored in OneDrive f...&hashtags=" rel="noreferrer" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li>
            </ul>
        </div>
        
        <div class="tags">
            <ul>
                
            </ul>
        </div>
        
    </footer>
</article>

<article class="post" role="article" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="post-header">
        <ul>
            <li><time datetime="2016-07-26T14:23:53-05:00" itemprop="datePublished">26 Jul, 2016</time></li>
            
        </ul>
        <h2 itemprop="name headline"><a href="http://172.16.7.177:4000/2016/07/automating-archive-folder-creation-in-exchange-online-mailboxes">Automating archive folder creation in Exchange Online mailboxes</a></h2>
    </header>

    <div class="post-content">
        <p align="left">If you are using Outlook 2016 on Windows or Mac you will have noticed the recent addition of a one-click &lsquo;Archive&rsquo; button to the ribbon. The addition of the archive button was <a href="https://blogs.office.com/2016/02/25/february-office-365-updates/" target="_blank">announced at the end of February</a>, but seems to have caught a bunch of customers by surprise and there appears to be some confusion about it&rsquo;s intended purpose. If you are unfamiliar with the one-click &lsquo;Archive&rsquo; button, here&rsquo;s what it looks like:</p>
<p align="center"><a href="http://www.cgoosen.com/wp-content/uploads/2016/07/a.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="a" src="http://www.cgoosen.com/wp-content/uploads/2016/07/a_thumb.png" alt="a" width="240" height="140" border="0" /></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <a href="http://www.cgoosen.com/wp-content/uploads/2016/07/b.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="b" src="http://www.cgoosen.com/wp-content/uploads/2016/07/b_thumb.png" alt="b" width="206" height="120" border="0" /></a></p>
<p align="left">The archive button is intended to make archiving email a one-click operation, but this does not archive email to an Online Archive and does not require users to have an Online Archive enabled. Instead, the button will file email to an &lsquo;Archive&rsquo; folder in your existing mailbox. The intention here is that this button provides a single-click way to clean or declutter your inbox of messages that you have already read. It is important to understand the following about the archive button:</p>
<ul>
<li>
<div align="left">The archive button cannot be used to send email messages to the Online Archive.</div>
</li>
<li>
<div align="left">Since the archive folder is a folder in the root of the mailbox, moving email to it will not reduce the overall size of the mailbox.</div>
</li>
</ul>
<p align="left">If a folder called &lsquo;Archive&rsquo; does not already exist in the root of the mailbox, the user will be prompted to create one:</p>
<p align="center"><a href="http://www.cgoosen.com/wp-content/uploads/2016/07/1.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="1" src="http://www.cgoosen.com/wp-content/uploads/2016/07/1_thumb.png" alt="1" width="416" height="112" border="0" /></a></p>
<p align="left">Certain organizations may feel like this creates confusion amongst their user community and would therefore like to automate the create of the &lsquo;Archive&rsquo; folder in their user mailboxes. Fortunately, MVP (and fellow Aussie!) <a href="https://mvp.microsoft.com/en-us/PublicProfile/10145?fullName=Glen%20%20Scales" target="_blank">Glen Scales</a> has a <a href="http://gsexdev.blogspot.com/2015/09/ews-create-mailbox-folder-powershell.html" target="_blank">great solution for creating mailbox folders using PowerShell the EWS managed API.</a> In order to use his module, you will need to download and install the <a href="http://go.microsoft.com/fwlink/?LinkId=255472" target="_blank">EWS managed API from here.</a> Once installed, you will need to connect to <a href="http://www.cgoosen.com/2014/10/script-connect-exo-ps1-connect-to-exchange-online-using-remote-powershell/" target="_blank">Exchange Online via remote PowerShell</a> and import the module. It them becomes a matter of using the Create-Folder cmdlet included in the module. The module has few parameters and a lot of other functionality but we only need the following:</p>
<p>[powershell]<br />
Create-Folder -MailboxName user@domain.com -NewFolderName Archive<br />
[/powershell]</p>
<p align="center"><a href="http://www.cgoosen.com/wp-content/uploads/2016/07/3.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="3" src="http://www.cgoosen.com/wp-content/uploads/2016/07/3_thumb.png" alt="3" width="534" height="167" border="0" /></a></p>
<p>With some minor tweaks to Glen&rsquo;s code, we can easily script this process for multiple (or all) mailboxes:</p>
<p>[powershell]<br />
function Load-EWSManagedAPI{<br />
    param(<br />
    )<br />
 	Begin<br />
	{<br />
		## Load Managed API dll<br />
		###CHECK FOR EWS MANAGED API, IF PRESENT IMPORT THE HIGHEST VERSION EWS DLL, ELSE EXIT<br />
		$EWSDLL = (($(Get-ItemProperty -ErrorAction SilentlyContinue -Path Registry::$(Get-ChildItem -ErrorAction SilentlyContinue -Path 'Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Exchange\Web Services'|Sort-Object Name -Descending| Select-Object -First 1 -ExpandProperty Name)).'Install Directory') + "Microsoft.Exchange.WebServices.dll")<br />
		if (Test-Path $EWSDLL)<br />
		    {<br />
		    Import-Module $EWSDLL<br />
		    }<br />
		else<br />
		    {<br />
		    "$(get-date -format yyyyMMddHHmmss):"<br />
		    "This script requires the EWS Managed API 1.2 or later."<br />
		    "Please download and install the current version of the EWS Managed API from"<br />
		    "http://go.microsoft.com/fwlink/?LinkId=255472"<br />
		    ""<br />
		    "Exiting Script."<br />
		    exit<br />
		    }<br />
  	}<br />
}</p>
<p>function Connect-Exchange{<br />
    param(<br />
    	[Parameter(Position=0, Mandatory=$true)] [string]$MailboxName,<br />
		[Parameter(Position=1, Mandatory=$true)] [System.Management.Automation.PSCredential]$Credentials<br />
    )<br />
 	Begin<br />
		 {<br />
		Load-EWSManagedAPI</p>
<p>		## Set Exchange Version<br />
		$ExchangeVersion = [Microsoft.Exchange.WebServices.Data.ExchangeVersion]::Exchange2010_SP1</p>
<p>		## Create Exchange Service Object<br />
		$service = New-Object Microsoft.Exchange.WebServices.Data.ExchangeService($ExchangeVersion)  </p>
<p>		#Credentials<br />
		$creds = New-Object System.Net.NetworkCredential($Credentials.UserName.ToString(),$Credentials.GetNetworkCredential().password.ToString())<br />
		$service.Credentials = $creds       </p>
<p>		#CAS URL hardcoded for Exchange Online </p>
<p>		$uri=[system.URI] "https://outlook.office365.com/EWS/Exchange.asmx"<br />
		$service.Url = $uri    </p>
<p>        if(!$service.URL){<br />
			throw "Error connecting to EWS"<br />
		}<br />
		else<br />
		{<br />
			return $service<br />
		}<br />
	}<br />
}</p>
<p>function Create-Folder{<br />
    param(<br />
    	[Parameter(Position=0, Mandatory=$true)] [string]$MailboxName,<br />
		[Parameter(Position=1, Mandatory=$true)] [System.Management.Automation.PSCredential]$Credentials,<br />
		[Parameter(Position=2, Mandatory=$true)] [String]$NewFolderName<br />
    )<br />
 	Begin<br />
	 {<br />
		$service = Connect-Exchange -MailboxName $MailboxName -Credentials $Credentials<br />
		$NewFolder = new-object Microsoft.Exchange.WebServices.Data.Folder($service)<br />
		$NewFolder.DisplayName = $NewFolderName<br />
        $NewFolder.FolderClass = "IPF.Note"</p>
<p>        # Bind to the MsgFolderRoot folder<br />
		$folderid= new-object Microsoft.Exchange.WebServices.Data.FolderId([Microsoft.Exchange.WebServices.Data.WellKnownFolderName]::MsgFolderRoot,$MailboxName)<br />
		$EWSParentFolder = [Microsoft.Exchange.WebServices.Data.Folder]::Bind($service,$folderid)</p>
<p>		#Define Folder Veiw Really only want to return one object<br />
		$fvFolderView = new-object Microsoft.Exchange.WebServices.Data.FolderView(1)<br />
		#Define a Search folder that is going to do a search based on the DisplayName of the folder<br />
		$SfSearchFilter = new-object Microsoft.Exchange.WebServices.Data.SearchFilter+IsEqualTo([Microsoft.Exchange.WebServices.Data.FolderSchema]::DisplayName,$NewFolderName)<br />
		#Do the Search<br />
		$findFolderResults = $service.FindFolders($EWSParentFolder.Id,$SfSearchFilter,$fvFolderView)<br />
		if ($findFolderResults.TotalCount -eq 0){<br />
		    Write-host ("Folder Doesn't Exist") -ForegroundColor Yellow<br />
			$NewFolder.Save($EWSParentFolder.Id)<br />
			Write-host ("Folder Created") -ForegroundColor Green<br />
		}<br />
		else{<br />
		    Write-error ("Folder already Exist with that Name")<br />
		}  </p>
<p>	 }<br />
}</p>
<p># Define tenant credentials<br />
$Credentials = Get-Credential</p>
<p># Define mailboxes that need the archive folder created<br />
# Get all mailboxes<br />
$Mailboxes = Get-Mailbox -ResultSize Unlimited | Where-Object {$_.Name -notlike "DiscoverySearchMailbox*"}</p>
<p># Or import a list of mailboxes from .txt<br />
# $Mailboxes = Get-Content C:\Temp\Mailboxes.txt</p>
<p># Create the folder<br />
ForEach ($MailboxName in $Mailboxes) {<br />
    Write-host "Processing $MailboxName" -ForegroundColor Yellow<br />
    Create-Folder -MailboxName $MailboxName.PrimarySmtpAddress -NewFolderName Archive -Credentials $Credentials<br />
    }<br />
[/powershell]</p>
<p align="left">Once the &lsquo;Archive&rsquo; folder has been created, it will become the destination for all messages that are selected when the &lsquo;Archive&rsquo; button is clicked.</p>
<p align="left">A word of caution: If you have a large number of mailboxes, you may run into throttling issues if you attempt to do this on all mailboxes at the same time so it is definitely worth considering a phased rollout in larger environments.</p>
<p align="left">Glen has some great stuff <a href="http://gsexdev.blogspot.com" target="_blank">on his blog so be sure to check it out here</a>.</p>


        
    </div>

    <footer class="post-footer">
        <div class="share">Share
            <ul class="social-networks">
                <li class="share-facebook"><a href="https://www.facebook.com/sharer.php?s=100&p[title]=Automating archive folder creation in Exchange Online mailboxes&p[summary]=If you are using Outlook 2016 on Windows or Mac you will have noticed the recent addition of a one-click &lsquo;Archive&rsquo; button to ...&p[url]=http://172.16.7.177:4000/2016/07/automating-archive-folder-creation-in-exchange-online-mailboxes" class="s_facebook" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#facebook-icon"></use></svg></a></a></li>
                <li class="share-twitter"><a href="http://twitter.com/share?url=http://172.16.7.177:4000/2016/07/automating-archive-folder-creation-in-exchange-online-mailboxes&text=If you are using Outlook 2016 on Windows or Mac you will have noticed the recent addition of a one-click &lsquo;Archive&rsquo; button to ...&hashtags=" rel="noreferrer" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li>
            </ul>
        </div>
        
        <div class="tags">
            <ul>
                
            </ul>
        </div>
        
    </footer>
</article>

<article class="post" role="article" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="post-header">
        <ul>
            <li><time datetime="2016-07-01T13:31:12-05:00" itemprop="datePublished">1 Jul, 2016</time></li>
            
        </ul>
        <h2 itemprop="name headline"><a href="http://172.16.7.177:4000/2016/07/office-servers-and-services-mvp-2016">Office Servers and Services MVP 2016!</a></h2>
    </header>

    <div class="post-content">
        <p>I've been traveling this week and spent a couple of days in Washington D.C were I presented two sessions at a small technology conference for overseas schools (K-12). I had a great time presenting and interacting with attendees from all over the world - my Microsoft focussed sessions definitely stood out at a conference heavily dominated by Google.</p>
<p>The highlight of my week was the email I received this morning from the Microsoft MVP program presenting me with a 2016 MVP award. This is my third MVP award and as always I'm honored to part of the MVP community.&nbsp;I'm very fortunate to have the opportunity to interact with so many folks who I admire and respect as often as I do.</p>
<p><a href="http://www.cgoosen.com/wp-content/uploads/2016/07/msmvplogo.jpg" rel="attachment wp-att-1686"><img class="aligncenter size-full wp-image-1686" src="http://www.cgoosen.com/wp-content/uploads/2016/07/msmvplogo.jpg" alt="msmvplogo" width="650" height="125" /></a></p>


        
    </div>

    <footer class="post-footer">
        <div class="share">Share
            <ul class="social-networks">
                <li class="share-facebook"><a href="https://www.facebook.com/sharer.php?s=100&p[title]=Office Servers and Services MVP 2016!&p[summary]=I've been traveling this week and spent a couple of days in Washington D.C were I presented two sessions at a small technology conference...&p[url]=http://172.16.7.177:4000/2016/07/office-servers-and-services-mvp-2016" class="s_facebook" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#facebook-icon"></use></svg></a></a></li>
                <li class="share-twitter"><a href="http://twitter.com/share?url=http://172.16.7.177:4000/2016/07/office-servers-and-services-mvp-2016&text=I've been traveling this week and spent a couple of days in Washington D.C were I presented two sessions at a small technology conference...&hashtags=" rel="noreferrer" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li>
            </ul>
        </div>
        
        <div class="tags">
            <ul>
                
            </ul>
        </div>
        
    </footer>
</article>

<article class="post" role="article" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="post-header">
        <ul>
            <li><time datetime="2016-06-30T12:46:19-05:00" itemprop="datePublished">30 Jun, 2016</time></li>
            
        </ul>
        <h2 itemprop="name headline"><a href="http://172.16.7.177:4000/2016/06/minor-update-to-my-connect-exo-ps1-script">Minor update to my Connect-EXO.ps1 script</a></h2>
    </header>

    <div class="post-content">
        <p>I've just published an updated version of my Connect-EXO.ps1 script. This version, (version 3.2) includes a very minor fix for those using German language keyboards. This update is the result of testing and feedback from the TechNet community and I wanted to thank all those involved.</p>
<p>I have been planning some big updates to this script and work on version 4.0 will begin soon - watch this space!</p>
<p>The update has been published to the TechNet Gallery,&nbsp;<a href="http://cgoo.se/1srvTiS" target="_blank">it can be downloaded by clicking here&hellip;</a></p>


        
    </div>

    <footer class="post-footer">
        <div class="share">Share
            <ul class="social-networks">
                <li class="share-facebook"><a href="https://www.facebook.com/sharer.php?s=100&p[title]=Minor update to my Connect-EXO.ps1 script&p[summary]=I've just published an updated version of my Connect-EXO.ps1 script. This version, (version 3.2) includes a very minor fix for those usin...&p[url]=http://172.16.7.177:4000/2016/06/minor-update-to-my-connect-exo-ps1-script" class="s_facebook" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#facebook-icon"></use></svg></a></a></li>
                <li class="share-twitter"><a href="http://twitter.com/share?url=http://172.16.7.177:4000/2016/06/minor-update-to-my-connect-exo-ps1-script&text=I've just published an updated version of my Connect-EXO.ps1 script. This version, (version 3.2) includes a very minor fix for those usin...&hashtags=" rel="noreferrer" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li>
            </ul>
        </div>
        
        <div class="tags">
            <ul>
                
            </ul>
        </div>
        
    </footer>
</article>

<article class="post" role="article" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="post-header">
        <ul>
            <li><time datetime="2016-05-31T11:05:03-05:00" itemprop="datePublished">31 May, 2016</time></li>
            
        </ul>
        <h2 itemprop="name headline"><a href="http://172.16.7.177:4000/2016/05/using-a-certificate-to-encrypt-credentials-in-automated-powershell-scripts-an-update">Using a certificate to encrypt credentials in automated PowerShell scripts &ndash; An Update!</a></h2>
    </header>

    <div class="post-content">
        <p><a href="http://www.cgoosen.com/2015/02/using-a-certificate-to-encrypt-credentials-in-automated-powershell-scripts/" target="_blank">Early last year I wrote a post</a> about encrypting script credentials using certificates. At the time, someone (thanks <a href="https://davewyatt.wordpress.com/" target="_blank">Dave Wyatt!</a>) commented on the post suggesting a couple of alternative methods to encrypt and decrypt the data, in particular I was interested in the Protect-CmsMessage and Unprotect-CmsMessage cmdlets included in PowerShell 5.0. Now that PowerShell 5.0 is more widespread I wanted to post a quick update about how these cmdlets can help simplify the process. The process is similar, but there are less steps and it is important to note that the certificate must contain the Data Encipherment or Key Encipherment key usage, and include the Document Encryption Enhanced Key Usage (1.3.6.1.4.1.311.80.1).</p>
<p align="center"><a href="http://www.cgoosen.com/wp-content/uploads/2016/05/Capture.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="Capture" src="http://www.cgoosen.com/wp-content/uploads/2016/05/Capture_thumb.png" alt="Capture" width="426" height="544" border="0" /></a></p>
<p>Let&rsquo;s start by first locating our certificate using the Get-ChildItem cmdlet:</p>
<p>[powershell]$Cert = Get-ChildItem Cert:\LocalMachine\My | Where-Object {$_.Subject -like "CN=PowerShell Automation*"}[/powershell]</p>
<p>Next we encrypt our password using that certificate:</p>
<p>[powershell]$Password = 'MyPassword'<br />
Protect-CmsMessage -To $Cert -Content $Password<br />
[/powershell]</p>
<p align="center"><a href="http://www.cgoosen.com/wp-content/uploads/2016/05/Capture-1.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border: 0px;" title="Capture" src="http://www.cgoosen.com/wp-content/uploads/2016/05/Capture_thumb-1.png" alt="Capture" width="960" height="200" border="0" /></a></p>
<p>You&rsquo;ll notice that the encrypted password is presented a little differently. You will&nbsp;need to include the entire block in your script.</p>
<p>Unencrypting the password in your script basically involves repeating this process in reverse:</p>
<p>[powershell]$Cert = Get-ChildItem Cert:\LocalMachine\My | Where-Object {$_.Subject -like 'CN=PowerShell Automation*'}<br />
$EncryptedPwd = @'<br />
-----BEGIN CMS-----<br />
MIIBqAYJKoZIhvcNAQcDoIIBmTCCAZUCAQAxggFQMIIBTAIBADA0MCAxHjAcBgNVBAMMFVBvd2Vy<br />
U2hlbGwgQXV0b21hdGlvbgIQOEd4fYDturxF77V7lEytlDANBgkqhkiG9w0BAQcwAASCAQB0z92N<br />
HrgQ84JxSV7RYpwSMPJRuSXlgVubOIew8KsYXr/E8kd/wOyT/2NPi3d+4xb67CLUM4infqOrt9Q+<br />
ReAtINvfVB5EPc9wU8yDpdz+WKProT4RJ94nzGH5qW5SK4O1Siu0VSPJZaCNb+CmYNFNNvLu6MN4<br />
pDqOiqZnv+j/rUxhrHX+U3E+eJq5P0gsZUwRaXZoAgGyV6SvZdUsbPYZ+hMPG0DruF/83SK6MOZM<br />
yVnGOmeP8e8/b/Rk2Y24JvDcROwRvK2+uj2Oy3ukw1WS4TxMy2V4lkjTYvwIO+bukjFCCtaR4Q63<br />
C6fx9OArx+uMbPmzkFgmG0w3jFVNnjjMMDwGCSqGSIb3DQEHATAdBglghkgBZQMEASoEEPdMffTC<br />
N+IvYDNFmuWKgZqAELsAZyE9I0POh/j64DNTsLI=<br />
-----END CMS-----<br />
'@<br />
$DecryptedPwd = $EncryptedPwd | Unprotect-CmsMessage -To $Cert | ConvertTo-SecureString -AsPlainText -Force<br />
[/powershell]</p>
<p>You can now use $DecryptedPwd to generate your credentials similar to the following:</p>
<p>[powershell]<br />
$MSOLUsername = 'serviceAcc@tenant.onmicrosoft.com'<br />
$MSOLCredentials = New-Object System.Management.Automation.PSCredential ($MSOLUsername,$DecryptedPwd)<br />
Connect-MSOLService -Credential $MSOLCredentials<br />
[/powershell]</p>


        
    </div>

    <footer class="post-footer">
        <div class="share">Share
            <ul class="social-networks">
                <li class="share-facebook"><a href="https://www.facebook.com/sharer.php?s=100&p[title]=Using a certificate to encrypt credentials in automated PowerShell scripts &ndash; An Update!&p[summary]=Early last year I wrote a post about encrypting script credentials using certificates. At the time, someone (thanks Dave Wyatt!) commente...&p[url]=http://172.16.7.177:4000/2016/05/using-a-certificate-to-encrypt-credentials-in-automated-powershell-scripts-an-update" class="s_facebook" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#facebook-icon"></use></svg></a></a></li>
                <li class="share-twitter"><a href="http://twitter.com/share?url=http://172.16.7.177:4000/2016/05/using-a-certificate-to-encrypt-credentials-in-automated-powershell-scripts-an-update&text=Early last year I wrote a post about encrypting script credentials using certificates. At the time, someone (thanks Dave Wyatt!) commente...&hashtags=" rel="noreferrer" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li>
            </ul>
        </div>
        
        <div class="tags">
            <ul>
                
            </ul>
        </div>
        
    </footer>
</article>

<article class="post" role="article" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="post-header">
        <ul>
            <li><time datetime="2016-04-12T04:31:15-05:00" itemprop="datePublished">12 Apr, 2016</time></li>
            
        </ul>
        <h2 itemprop="name headline"><a href="http://172.16.7.177:4000/2016/04/my-connect-exo-ps1-script-has-been-updated-2">My Connect-EXO.ps1 script has been updated!</a></h2>
    </header>

    <div class="post-content">
        <p>I've just published an updated version of my Connect-EXO.ps1 script. Version 3.1 includes the ability&nbsp;to connect to the&nbsp;Office 365 Security &amp; Compliance Center. Based on the options selected it will connect to either or all&nbsp;services with Exchange Online being the only one selected by default. Here is a screenshot of the new interface:</p>
<p style="text-align: center;"><a href="http://www.cgoosen.com/wp-content/uploads/2014/10/cap1.png" rel="attachment wp-att-1504"><img class="aligncenter wp-image-1504" src="http://www.cgoosen.com/wp-content/uploads/2014/10/cap1.png" alt="GUI" width="454" height="298" /></a></p>
<p style="text-align: left;">The update has been published to the TechNet Gallery, <a href="http://cgoo.se/1srvTiS" target="_blank">it can be downloaded by clicking here&hellip;</a></p>


        
    </div>

    <footer class="post-footer">
        <div class="share">Share
            <ul class="social-networks">
                <li class="share-facebook"><a href="https://www.facebook.com/sharer.php?s=100&p[title]=My Connect-EXO.ps1 script has been updated!&p[summary]=I've just published an updated version of my Connect-EXO.ps1 script. Version 3.1 includes the ability&nbsp;to connect to the&nbsp;Office ...&p[url]=http://172.16.7.177:4000/2016/04/my-connect-exo-ps1-script-has-been-updated-2" class="s_facebook" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#facebook-icon"></use></svg></a></a></li>
                <li class="share-twitter"><a href="http://twitter.com/share?url=http://172.16.7.177:4000/2016/04/my-connect-exo-ps1-script-has-been-updated-2&text=I've just published an updated version of my Connect-EXO.ps1 script. Version 3.1 includes the ability&nbsp;to connect to the&nbsp;Office ...&hashtags=" rel="noreferrer" target="_blank" onclick="window.open(this.href, '','width=700,height=300');return false;"><svg title="" width="16" height="16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://172.16.7.177:4000/assets/svg/social-icons.svg#twitter-icon"></use></svg></a></li>
            </ul>
        </div>
        
        <div class="tags">
            <ul>
                
            </ul>
        </div>
        
    </footer>
</article>




<div class="pagination" role="navigation" aria-label="pagination">
    
        <a href="/page3/" class="previous">&larr; Previous</a>
    

    <span class="page_number">Page 4 of 24</span>

    
        <a href="/page5/" class="next">Next &rarr;</a>
    
</div>

            </main>
        </div>

        <script src="http://172.16.7.177:4000/assets/js/jquery-1.12.2.min.js"></script>
<script src="http://172.16.7.177:4000/assets/js/backtotop.js"></script>
<script src="http://172.16.7.177:4000/assets/js/lunr.min.js"></script>
<script src="http://172.16.7.177:4000/assets/js/lunr-feed.js"></script>
<script src="http://172.16.7.177:4000/assets/js/jquery.fitvids.js"></script>
<script src="http://172.16.7.177:4000/assets/js/svg4everybody.min.js"></script>
<script src="http://172.16.7.177:4000/assets/js/scripts.js"></script>


    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-XXXXXXX-2', 'auto');
        ga('send', 'pageview');
    </script>

        <style>
.lightbox {width: 100%; height: 100%; position: fixed; top: 0; left: 0; background: rgba(0,0,0,0.85); z-index: 9999999; line-height: 0; cursor: pointer;}
.lightbox .img {
	position: relative; 
	top: 50%;
	left: 50%;
	-ms-transform: translateX(-50%) translateY(-50%);
	-webkit-transform: translate(-50%,-50%);
	transform: translate(-50%,-50%);
	max-width: 100%;
	max-height: 100%;
}
.lightbox .img img {opacity: 0; pointer-events: none; width: auto;}
@media screen and (min-width: 1200px) {
    .lightbox .img {
		max-width: 1200px;
    }
}
@media screen and (min-height: 1200px) {
    .lightbox img {
		max-height: 1200px;
	}
}
.lightbox span {display: block; position: fixed; bottom: 13px; height: 1.5em; line-height: 1.4em; width: 100%; text-align: center; color: white; text-shadow:
    -1px -1px 0 #000,
    1px -1px 0 #000,
    -1px 1px 0 #000,
    1px 1px 0 #000;  
}






.lightbox .videoWrapperContainer {
	position: relative; 
	top: 50%;
	left: 50%;
	-ms-transform: translateX(-50%) translateY(-50%);
	-webkit-transform: translate(-50%,-50%);
	transform: translate(-50%,-50%);
	max-width: 900px;
	max-height: 100%;
}
.lightbox .videoWrapperContainer .videoWrapper {
	height: 0;
	line-height: 0;
	margin: 0;
	padding: 0;
	position: relative;
	padding-bottom: 56.333%; /* custom */
	background: black;
} 
.lightbox .videoWrapper iframe {
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	border: 0;
	display: block;
}   
.lightbox #prev, .lightbox #next {height: 50px; line-height: 36px; display: none; margin-top: -25px; position: fixed; top: 50%; padding: 0 15px; cursor: pointer; text-decoration: none; z-index: 99; color: white; font-size: 60px;}
.lightbox.gallery #prev, .lightbox.gallery #next {display: block;}
.lightbox #prev {left: 0;}
.lightbox #next {right: 0;}
.lightbox #close {height: 50px; width: 50px; position: fixed; cursor: pointer; text-decoration: none; z-index: 99; right: 0; top: 0;}
.lightbox #close:after, .lightbox #close:before {position: absolute; margin-top: 22px; margin-left: 14px; content: ""; height: 3px; background: white; width: 23px;
-webkit-transform-origin: 50% 50%;
-moz-transform-origin: 50% 50%;
-o-transform-origin: 50% 50%;
transform-origin: 50% 50%;
/* Safari */
-webkit-transform: rotate(-45deg);
/* Firefox */
-moz-transform: rotate(-45deg);
/* IE */
-ms-transform: rotate(-45deg);
/* Opera */
-o-transform: rotate(-45deg);
}
.lightbox #close:after {
/* Safari */
-webkit-transform: rotate(45deg);
/* Firefox */
-moz-transform: rotate(45deg);
/* IE */
-ms-transform: rotate(45deg);
/* Opera */
-o-transform: rotate(45deg);
}
.lightbox, .lightbox * {
    -webkit-user-select: none;  
    -moz-user-select: none;    
    -ms-user-select: none;      
    user-select: none;
}
</style>
		
<script>
function is_youtubelink(url) {
  var p = /^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/;
  return (url.match(p)) ? RegExp.$1 : false;
}
function is_imagelink(url) {
	var p = /([a-z\-_0-9\/\:\.]*\.(jpg|jpeg|png|gif))/i;
	return (url.match(p)) ? true : false;
}
function is_vimeolink(url,el) {
	var id = false;
	$.ajax({
	  url: 'https://vimeo.com/api/oembed.json?url='+url,
	  async: true,
	  success: function(response) {
		if(response.video_id) {
		  id = response.video_id;
		  $(el).addClass('lightbox-vimeo').attr('data-id',id);
		}
	  }
	});
}

$(document).ready(function() {
	//add classes to links to be able to initiate lightboxes
	$("a").each(function(){
		var url = $(this).attr('href');
		if(url) {
			if(url.indexOf('vimeo') !== -1 && !$(this).hasClass('no-lightbox')) is_vimeolink(url,$(this));
			if(is_youtubelink(url) && !$(this).hasClass('no-lightbox')) $(this).addClass('lightbox-youtube').attr('data-id',is_youtubelink(url));
			if(is_imagelink(url) && !$(this).hasClass('no-lightbox')) {
				$(this).addClass('lightbox-image');
				var href = $(this).attr('href');
				var filename = href.split('/').pop();
				var split = filename.split(".");
				var name = split[0];
				$(this).attr('title',name);
			}
		}
	});
	//remove the clicked lightbox
	$("body").on("click", ".lightbox", function(event){
		if($(this).hasClass('gallery')) {
			$(this).remove();
			if($(event.target).attr('id')=='next') {
				//next item
				if($("a.gallery.current").nextAll("a.gallery:first").length) $("a.gallery.current").nextAll("a.gallery:first").click();
				else $("a.gallery.current").parent().find("a.gallery").first().click();
			}
			else if ($(event.target).attr('id')=='prev') {
				//prev item
				if($("a.gallery.current").prevAll("a.gallery:first").length) $("a.gallery.current").prevAll("a.gallery:first").click();
				else $("a.gallery.current").parent().find("a.gallery").last().click();
			}
			else {
				$("a.gallery").removeClass('gallery');
			}
		}
		else $(this).remove();
	});
	//prevent image from being draggable (for swipe)
	$("body").on('dragstart', ".lightbox img", function(event) { event.preventDefault(); });
	//add the youtube lightbox on click
	$("a.lightbox-youtube").click(function(event){
		event.preventDefault();
		$('<div class="lightbox"><a id="close"></a><a id="next">&rsaquo;</a><a id="prev">&lsaquo;</a><div class="videoWrapperContainer"><div class="videoWrapper"><iframe src="https://www.youtube.com/embed/'+$(this).attr('data-id')+'?autoplay=1&showinfo=0&rel=0"></iframe></div></div></div>').appendTo('body');
	});
	//add the image lightbox on click
	$("a.lightbox-image").click(function(event){
		event.preventDefault();
		$('<div class="lightbox"><a id="close"></a><a id="next">&rsaquo;</a><a id="prev">&lsaquo;</a><div class="img" style="background: url('+$(this).attr('href')+') center center / contain no-repeat;" title="'+$(this).attr('title')+'" ><img src="'+$(this).attr('href')+'" alt="'+$(this).attr('title')+'" /></div><span>'+$(this).attr('title')+'</span></div>').appendTo('body');
	});
	//add the vimeo lightbox on click
	$("body").on("click", "a.lightbox-vimeo", function(event){
		event.preventDefault();
		$('<div class="lightbox"><a id="close"></a><a id="next">&rsaquo;</a><a id="prev">&lsaquo;</a><div class="videoWrapperContainer"><div class="videoWrapper"><iframe src="https://player.vimeo.com/video/'+$(this).attr('data-id')+'/?autoplay=1&byline=0&title=0&portrait=0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div></div></div>').appendTo('body');
	});

	$("body").on("click", "a[class*='lightbox-']", function(){
		var link_elements = $(this).parent().find("a[class*='lightbox-']");
		$(link_elements).removeClass('current');
		for (var i=0; i<link_elements.length; i++) {
			if($(this).attr('href') == $(link_elements[i]).attr('href')) {
				$(link_elements[i]).addClass('current');
			}
		}
		if(link_elements.length>1) {
			$('.lightbox').addClass('gallery');
			$(link_elements).addClass('gallery');
		}
	});

	
});

$(document).keydown(function(e) {
    switch(e.which) {
        case 37: // left
        $("#prev").click();
        break;
        case 39: // right
        $("#next").click();
        break;
	case 27: // esc
        $("#close").click();
        break;
        default: return; // exit this handler for other keys
    }
    e.preventDefault(); // prevent the default action (scroll / move caret)
});

  /*===========================
  Swipe-it v1.4.1
  An event listener for swiping gestures with vanilla js.
  https://github.com/tri613/swipe-it#readme
 
  @Create 2016/09/22
  @Update 2017/08/11
  @Author Trina Lu
  ===========================*/
  "use strict";var _slicedToArray=function(){function n(n,t){var e=[],i=!0,o=!1,r=void 0;try{for(var u,c=n[Symbol.iterator]();!(i=(u=c.next()).done)&&(e.push(u.value),!t||e.length!==t);i=!0);}catch(n){o=!0,r=n}finally{try{!i&&c.return&&c.return()}finally{if(o)throw r}}return e}return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return n(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();!function(n,t,e){function i(n){function e(){o("touchstart",m,w),o("touchmove",d,w),o("touchend",p,w),E.mouseEvent&&o("mousedown",s,w)}function i(){y=!1,D=!1,A=!1,b=!1,a=!1}function s(n){a=this,y=n.clientX,D=n.clientY,o("mousemove",l,v),o("mouseup",h,v)}function l(n){n.preventDefault(),y&&D&&(A=n.clientX,b=n.clientY)}function h(n){r("mousemove",l,v),r("mouseup",h,v),p(n)}function m(n){a=this,y=n.touches[0].clientX,D=n.touches[0].clientY}function d(n){A=n.touches[0].clientX,b=n.touches[0].clientY}function p(n){if(y&&D&&A&&b){var t=y-A,e=D-b,o=[t,e].map(Math.abs),r=_slicedToArray(o,2),c=r[0],s=r[1],v=E.minDistance;if(c>v){var f=y<A?"swipeRight":"swipeLeft";u(f,a,{distance:t,start:y,end:A})}if(s>v){var l=D>b?"swipeUp":"swipeDown";u(l,a,{distance:e,start:D,end:b})}(c>v||s>v)&&u("swipe",a)}i()}var E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},w=c(t.querySelectorAll(n)),y=void 0,D=void 0,A=void 0,b=void 0;E.mouseEvent=void 0===E.mouseEvent?f.mouseEvent:E.mouseEvent,E.minDistance=void 0===E.minDistance?f.minDistance:E.minDistance,i(),e(),this.on=function(n,t){return o(n,t,w),this}}function o(n,t,e){s(e).forEach(function(e){return e.addEventListener(n,t)})}function r(n,t,e){s(e).forEach(function(e){return e.removeEventListener(n,t)})}function u(n,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=t.createEvent("Event");o.initEvent(n,!0,!0),o.swipe=i,s(e).forEach(function(n){return n.dispatchEvent(o)})}function c(n){for(var t=[],e=0;e<n.length;e++)t.push(n[e]);return t}function s(n){return Array.isArray(n)?n:[n]}var a=!1,v=[n],f={mouseEvent:!0,minDistance:30};n[e]=i}(window,document,"SwipeIt");

var mySwipeIt = new SwipeIt('body');
mySwipeIt.on('swipeLeft',function(e){
	//check if lightbox is present
	if($('.lightbox').length >  0 ) {
		$("#next").click();
	}
}).on('swipeRight',function(e){
	//check if lightbox is present
	if($('.lightbox').length >  0 ) {
		$("#prev").click();
	}
});
</script>

    </body>
</html>